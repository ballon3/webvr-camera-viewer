{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","node_modules/browserify/node_modules/process/browser.js","node_modules/freeice/index.js","node_modules/freeice/node_modules/normalice/index.js","node_modules/freeice/stun.json","node_modules/freeice/turn.json","node_modules/page/index.js","node_modules/page/node_modules/path-to-regexp/index.js","node_modules/page/node_modules/path-to-regexp/node_modules/isarray/index.js","node_modules/pyrsmk-toast/src/toast.js","node_modules/rtc-quickconnect/index.js","node_modules/rtc-quickconnect/lib/calls.js","node_modules/rtc-quickconnect/lib/getpeerdata.js","node_modules/rtc-quickconnect/lib/heartbeat.js","node_modules/rtc-quickconnect/node_modules/cog/defaults.js","node_modules/rtc-quickconnect/node_modules/cog/extend.js","node_modules/rtc-quickconnect/node_modules/cog/getable.js","node_modules/rtc-quickconnect/node_modules/cog/jsonparse.js","node_modules/rtc-quickconnect/node_modules/cog/logger.js","node_modules/rtc-quickconnect/node_modules/cog/throttle.js","node_modules/rtc-quickconnect/node_modules/mbus/index.js","node_modules/rtc-quickconnect/node_modules/rtc-core/detect.js","node_modules/rtc-quickconnect/node_modules/rtc-core/genice.js","node_modules/rtc-quickconnect/node_modules/rtc-core/node_modules/detect-browser/browser.js","node_modules/rtc-quickconnect/node_modules/rtc-core/plugin.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/index.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/index.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/cuid/dist/browser-cuid.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/pull-pushable/index.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/pull-pushable/node_modules/pull-stream/index.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/pull-pushable/node_modules/pull-stream/maybe.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/pull-pushable/node_modules/pull-stream/node_modules/pull-core/index.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/pull-pushable/node_modules/pull-stream/sinks.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/pull-pushable/node_modules/pull-stream/sources.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/pull-pushable/node_modules/pull-stream/throughs.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/pull-stream/index.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/pull-stream/maybe.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/pull-stream/node_modules/pull-core/index.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/pull-stream/sinks.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/pull-stream/sources.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/pull-stream/throughs.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/rtc-signal/handlers/announce.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/rtc-signal/prepare.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/rtc-signal/process.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-signaller/node_modules/rtc-signal/signaller.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-switchboard-messenger/index.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-switchboard-messenger/node_modules/messenger-ws/index.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-switchboard-messenger/node_modules/messenger-ws/node_modules/pull-ws/index.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-switchboard-messenger/node_modules/messenger-ws/node_modules/pull-ws/ready.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-switchboard-messenger/node_modules/messenger-ws/node_modules/pull-ws/sink.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-switchboard-messenger/node_modules/messenger-ws/node_modules/pull-ws/source.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-switchboard-messenger/node_modules/messenger-ws/node_modules/ws/lib/browser.js","node_modules/rtc-quickconnect/node_modules/rtc-pluggable-signaller/node_modules/rtc-switchboard-messenger/node_modules/messenger-ws/node_modules/wsurl/index.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/cleanup.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/couple.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/detect.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/generators.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/index.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/monitor.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/node_modules/rtc-taskqueue/index.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/node_modules/rtc-taskqueue/node_modules/priorityqueuejs/index.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/node_modules/rtc-taskqueue/node_modules/rtc-sdp/index.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/node_modules/rtc-taskqueue/node_modules/rtc-sdp/parsers.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/node_modules/rtc-taskqueue/node_modules/rtc-sdpclean/index.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/node_modules/rtc-taskqueue/node_modules/rtc-validator/candidate.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/node_modules/rtc-taskqueue/node_modules/rtc-validator/node_modules/reu/ip.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/node_modules/whisk/equality.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/node_modules/whisk/flatten.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/node_modules/whisk/nub-by.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/node_modules/whisk/nub.js","node_modules/rtc-quickconnect/node_modules/rtc-tools/node_modules/whisk/pluck.js","node_modules/tween.js/index.js","src/app.js","src/classes/LinkShare.js","src/classes/Screen.js","src/classes/VideoControlPanel.js","src/streamer.js","src/templates/main.tpl.html","src/templates/stream.tpl.html","src/templates/view.tpl.html","src/viewer.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjBA;AACA;;;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC3mBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1MA;AACA;AACA;AACA;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AClsBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC1IA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACtJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACpSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;ACxKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACvUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5YA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACnvBA,IAAI,CAAC,GAAI,OAAO,MAAM,KAAK,WAAW,GAAG,MAAM,CAAC,CAAC,GAAG,OAAO,MAAM,KAAK,WAAW,GAAG,MAAM,CAAC,CAAC,GAAG,IAAI,AAAC,CAAA;AACpG,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAA;;;AAG1B,IAAI,KAAK,GAAG,OAAO,CAAC,cAAc,CAAC,CAAA;AACnC,IAAI,WAAW,GAAG,KAAK,CAAA;;AAEvB,IAAI,IAAI,GAAG,OAAO,CAAC,aAAa,CAAC,CAAA;AACjC,IAAI,OAAO,GAAG,OAAO,CAAC,2BAA2B,CAAC,CAAA;;AAElD,IAAI,MAAM,GAAG,OAAO,CAAC,eAAe,CAAC,CAAA;AACrC,IAAI,SAAS,GAAG,OAAO,CAAC,6BAA6B,CAAC,CAAA;;AAEtD,IAAI,OAAO,GAAG,OAAO,CAAC,2B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","file":"app.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","// shim for using process in browser\n\nvar process = module.exports = {};\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = setTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            currentQueue[queueIndex].run();\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    clearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        setTimeout(drainQueue, 0);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\n// TODO(shtylman)\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","/* jshint node: true */\n'use strict';\n\nvar normalice = require('normalice');\n\n/**\n  # freeice\n\n  The `freeice` module is a simple way of getting random STUN or TURN server\n  for your WebRTC application.  The list of servers (just STUN at this stage)\n  were sourced from this [gist](https://gist.github.com/zziuni/3741933).\n\n  ## Example Use\n\n  The following demonstrates how you can use `freeice` with\n  [rtc-quickconnect](https://github.com/rtc-io/rtc-quickconnect):\n\n  <<< examples/quickconnect.js\n\n  As the `freeice` module generates ice servers in a list compliant with the\n  WebRTC spec you will be able to use it with raw `RTCPeerConnection`\n  constructors and other WebRTC libraries.\n\n  ## Hey, don't use my STUN/TURN server!\n\n  If for some reason your free STUN or TURN server ends up in the\n  list of servers ([stun](https://github.com/DamonOehlman/freeice/blob/master/stun.json) or\n  [turn](https://github.com/DamonOehlman/freeice/blob/master/turn.json))\n  that is used in this module, you can feel\n  free to open an issue on this repository and those servers will be removed\n  within 24 hours (or sooner).  This is the quickest and probably the most\n  polite way to have something removed (and provides us some visibility\n  if someone opens a pull request requesting that a server is added).\n\n  ## Please add my server!\n\n  If you have a server that you wish to add to the list, that's awesome! I'm\n  sure I speak on behalf of a whole pile of WebRTC developers who say thanks.\n  To get it into the list, feel free to either open a pull request or if you\n  find that process a bit daunting then just create an issue requesting\n  the addition of the server (make sure you provide all the details, and if\n  you have a Terms of Service then including that in the PR/issue would be\n  awesome).\n\n  ## I know of a free server, can I add it?\n\n  Sure, if you do your homework and make sure it is ok to use (I'm currently\n  in the process of reviewing the terms of those STUN servers included from\n  the original list).  If it's ok to go, then please see the previous entry\n  for how to add it.\n\n  ## Current List of Servers\n\n  * current as at the time of last `README.md` file generation\n\n  ### STUN\n\n  <<< stun.json\n\n  ### TURN\n\n  <<< turn.json\n\n**/\n\nvar freeice = module.exports = function(opts) {\n  // if a list of servers has been provided, then use it instead of defaults\n  var servers = {\n    stun: (opts || {}).stun || require('./stun.json'),\n    turn: (opts || {}).turn || require('./turn.json')\n  };\n\n  var stunCount = (opts || {}).stunCount || 2;\n  var turnCount = (opts || {}).turnCount || 0;\n  var selected;\n\n  function getServers(type, count) {\n    var out = [];\n    var input = [].concat(servers[type]);\n    var idx;\n\n    while (input.length && out.length < count) {\n      idx = (Math.random() * input.length) | 0;\n      out = out.concat(input.splice(idx, 1));\n    }\n\n    return out.map(function(url) {\n      return normalice(type + ':' + url);\n    });\n  }\n\n  // add stun servers\n  selected = [].concat(getServers('stun', stunCount));\n\n  if (turnCount) {\n    selected = selected.concat(getServers('turn', turnCount));\n  }\n\n  return selected;\n};\n","/**\n  # normalice\n\n  Normalize an ice server configuration object (or plain old string) into a format\n  that is usable in all browsers supporting WebRTC.  Primarily this module is designed\n  to help with the transition of the `url` attribute of the configuration object to\n  the `urls` attribute.\n\n  ## Example Usage\n\n  <<< examples/simple.js\n\n**/\n\nvar protocols = [\n  'stun:',\n  'turn:'\n];\n\nmodule.exports = function(input) {\n  var url = (input || {}).url || input;\n  var protocol;\n  var parts;\n  var output = {};\n\n  // if we don't have a string url, then allow the input to passthrough\n  if (typeof url != 'string' && (! (url instanceof String))) {\n    return input;\n  }\n\n  // trim the url string, and convert to an array\n  url = url.trim();\n\n  // if the protocol is not known, then passthrough\n  protocol = protocols[protocols.indexOf(url.slice(0, 5))];\n  if (! protocol) {\n    return input;\n  }\n\n  // now let's attack the remaining url parts\n  url = url.slice(5);\n  parts = url.split('@');\n\n  output.username = input.username;\n  output.credential = input.credential;\n  // if we have an authentication part, then set the credentials\n  if (parts.length > 1) {\n    url = parts[1];\n    parts = parts[0].split(':');\n\n    // add the output credential and username\n    output.username = parts[0];\n    output.credential = (input || {}).credential || parts[1] || '';\n  }\n\n  output.url = protocol + url;\n  output.urls = [ output.url ];\n\n  return output;\n};\n","module.exports=[\n  \"stun.l.google.com:19302\",\n  \"stun1.l.google.com:19302\",\n  \"stun2.l.google.com:19302\",\n  \"stun3.l.google.com:19302\",\n  \"stun4.l.google.com:19302\",\n  \"stun.ekiga.net\",\n  \"stun.ideasip.com\",\n  \"stun.rixtelecom.se\",\n  \"stun.schlund.de\",\n  \"stun.stunprotocol.org:3478\",\n  \"stun.voiparound.com\",\n  \"stun.voipbuster.com\",\n  \"stun.voipstunt.com\",\n  \"stun.voxgratia.org\",\n  \"stun.services.mozilla.com\"\n]\n","module.exports=[]\n","  /* globals require, module */\n\n  'use strict';\n\n  /**\n   * Module dependencies.\n   */\n\n  var pathtoRegexp = require('path-to-regexp');\n\n  /**\n   * Module exports.\n   */\n\n  module.exports = page;\n\n  /**\n   * Detect click event\n   */\n  var clickEvent = ('undefined' !== typeof document) && document.ontouchstart ? 'touchstart' : 'click';\n\n  /**\n   * To work properly with the URL\n   * history.location generated polyfill in https://github.com/devote/HTML5-History-API\n   */\n\n  var location = ('undefined' !== typeof window) && (window.history.location || window.location);\n\n  /**\n   * Perform initial dispatch.\n   */\n\n  var dispatch = true;\n\n\n  /**\n   * Decode URL components (query string, pathname, hash).\n   * Accommodates both regular percent encoding and x-www-form-urlencoded format.\n   */\n  var decodeURLComponents = true;\n\n  /**\n   * Base path.\n   */\n\n  var base = '';\n\n  /**\n   * Running flag.\n   */\n\n  var running;\n\n  /**\n   * HashBang option\n   */\n\n  var hashbang = false;\n\n  /**\n   * Previous context, for capturing\n   * page exit events.\n   */\n\n  var prevContext;\n\n  /**\n   * Register `path` with callback `fn()`,\n   * or route `path`, or redirection,\n   * or `page.start()`.\n   *\n   *   page(fn);\n   *   page('*', fn);\n   *   page('/user/:id', load, user);\n   *   page('/user/' + user.id, { some: 'thing' });\n   *   page('/user/' + user.id);\n   *   page('/from', '/to')\n   *   page();\n   *\n   * @param {String|Function} path\n   * @param {Function} fn...\n   * @api public\n   */\n\n  function page(path, fn) {\n    // <callback>\n    if ('function' === typeof path) {\n      return page('*', path);\n    }\n\n    // route <path> to <callback ...>\n    if ('function' === typeof fn) {\n      var route = new Route(path);\n      for (var i = 1; i < arguments.length; ++i) {\n        page.callbacks.push(route.middleware(arguments[i]));\n      }\n      // show <path> with [state]\n    } else if ('string' === typeof path) {\n      page['string' === typeof fn ? 'redirect' : 'show'](path, fn);\n      // start [options]\n    } else {\n      page.start(path);\n    }\n  }\n\n  /**\n   * Callback functions.\n   */\n\n  page.callbacks = [];\n  page.exits = [];\n\n  /**\n   * Current path being processed\n   * @type {String}\n   */\n  page.current = '';\n\n  /**\n   * Number of pages navigated to.\n   * @type {number}\n   *\n   *     page.len == 0;\n   *     page('/login');\n   *     page.len == 1;\n   */\n\n  page.len = 0;\n\n  /**\n   * Get or set basepath to `path`.\n   *\n   * @param {String} path\n   * @api public\n   */\n\n  page.base = function(path) {\n    if (0 === arguments.length) return base;\n    base = path;\n  };\n\n  /**\n   * Bind with the given `options`.\n   *\n   * Options:\n   *\n   *    - `click` bind to click events [true]\n   *    - `popstate` bind to popstate [true]\n   *    - `dispatch` perform initial dispatch [true]\n   *\n   * @param {Object} options\n   * @api public\n   */\n\n  page.start = function(options) {\n    options = options || {};\n    if (running) return;\n    running = true;\n    if (false === options.dispatch) dispatch = false;\n    if (false === options.decodeURLComponents) decodeURLComponents = false;\n    if (false !== options.popstate) window.addEventListener('popstate', onpopstate, false);\n    if (false !== options.click) {\n      document.addEventListener(clickEvent, onclick, false);\n    }\n    if (true === options.hashbang) hashbang = true;\n    if (!dispatch) return;\n    var url = (hashbang && ~location.hash.indexOf('#!')) ? location.hash.substr(2) + location.search : location.pathname + location.search + location.hash;\n    page.replace(url, null, true, dispatch);\n  };\n\n  /**\n   * Unbind click and popstate event handlers.\n   *\n   * @api public\n   */\n\n  page.stop = function() {\n    if (!running) return;\n    page.current = '';\n    page.len = 0;\n    running = false;\n    document.removeEventListener(clickEvent, onclick, false);\n    window.removeEventListener('popstate', onpopstate, false);\n  };\n\n  /**\n   * Show `path` with optional `state` object.\n   *\n   * @param {String} path\n   * @param {Object} state\n   * @param {Boolean} dispatch\n   * @return {Context}\n   * @api public\n   */\n\n  page.show = function(path, state, dispatch, push) {\n    var ctx = new Context(path, state);\n    page.current = ctx.path;\n    if (false !== dispatch) page.dispatch(ctx);\n    if (false !== ctx.handled && false !== push) ctx.pushState();\n    return ctx;\n  };\n\n  /**\n   * Goes back in the history\n   * Back should always let the current route push state and then go back.\n   *\n   * @param {String} path - fallback path to go back if no more history exists, if undefined defaults to page.base\n   * @param {Object} [state]\n   * @api public\n   */\n\n  page.back = function(path, state) {\n    if (page.len > 0) {\n      // this may need more testing to see if all browsers\n      // wait for the next tick to go back in history\n      history.back();\n      page.len--;\n    } else if (path) {\n      setTimeout(function() {\n        page.show(path, state);\n      });\n    }else{\n      setTimeout(function() {\n        page.show(base, state);\n      });\n    }\n  };\n\n\n  /**\n   * Register route to redirect from one path to other\n   * or just redirect to another route\n   *\n   * @param {String} from - if param 'to' is undefined redirects to 'from'\n   * @param {String} [to]\n   * @api public\n   */\n  page.redirect = function(from, to) {\n    // Define route from a path to another\n    if ('string' === typeof from && 'string' === typeof to) {\n      page(from, function(e) {\n        setTimeout(function() {\n          page.replace(to);\n        }, 0);\n      });\n    }\n\n    // Wait for the push state and replace it with another\n    if ('string' === typeof from && 'undefined' === typeof to) {\n      setTimeout(function() {\n        page.replace(from);\n      }, 0);\n    }\n  };\n\n  /**\n   * Replace `path` with optional `state` object.\n   *\n   * @param {String} path\n   * @param {Object} state\n   * @return {Context}\n   * @api public\n   */\n\n\n  page.replace = function(path, state, init, dispatch) {\n    var ctx = new Context(path, state);\n    page.current = ctx.path;\n    ctx.init = init;\n    ctx.save(); // save before dispatching, which may redirect\n    if (false !== dispatch) page.dispatch(ctx);\n    return ctx;\n  };\n\n  /**\n   * Dispatch the given `ctx`.\n   *\n   * @param {Object} ctx\n   * @api private\n   */\n\n  page.dispatch = function(ctx) {\n    var prev = prevContext,\n      i = 0,\n      j = 0;\n\n    prevContext = ctx;\n\n    function nextExit() {\n      var fn = page.exits[j++];\n      if (!fn) return nextEnter();\n      fn(prev, nextExit);\n    }\n\n    function nextEnter() {\n      var fn = page.callbacks[i++];\n\n      if (ctx.path !== page.current) {\n        ctx.handled = false;\n        return;\n      }\n      if (!fn) return unhandled(ctx);\n      fn(ctx, nextEnter);\n    }\n\n    if (prev) {\n      nextExit();\n    } else {\n      nextEnter();\n    }\n  };\n\n  /**\n   * Unhandled `ctx`. When it's not the initial\n   * popstate then redirect. If you wish to handle\n   * 404s on your own use `page('*', callback)`.\n   *\n   * @param {Context} ctx\n   * @api private\n   */\n\n  function unhandled(ctx) {\n    if (ctx.handled) return;\n    var current;\n\n    if (hashbang) {\n      current = base + location.hash.replace('#!', '');\n    } else {\n      current = location.pathname + location.search;\n    }\n\n    if (current === ctx.canonicalPath) return;\n    page.stop();\n    ctx.handled = false;\n    location.href = ctx.canonicalPath;\n  }\n\n  /**\n   * Register an exit route on `path` with\n   * callback `fn()`, which will be called\n   * on the previous context when a new\n   * page is visited.\n   */\n  page.exit = function(path, fn) {\n    if (typeof path === 'function') {\n      return page.exit('*', path);\n    }\n\n    var route = new Route(path);\n    for (var i = 1; i < arguments.length; ++i) {\n      page.exits.push(route.middleware(arguments[i]));\n    }\n  };\n\n  /**\n   * Remove URL encoding from the given `str`.\n   * Accommodates whitespace in both x-www-form-urlencoded\n   * and regular percent-encoded form.\n   *\n   * @param {str} URL component to decode\n   */\n  function decodeURLEncodedURIComponent(val) {\n    if (typeof val !== 'string') { return val; }\n    return decodeURLComponents ? decodeURIComponent(val.replace(/\\+/g, ' ')) : val;\n  }\n\n  /**\n   * Initialize a new \"request\" `Context`\n   * with the given `path` and optional initial `state`.\n   *\n   * @param {String} path\n   * @param {Object} state\n   * @api public\n   */\n\n  function Context(path, state) {\n    if ('/' === path[0] && 0 !== path.indexOf(base)) path = base + (hashbang ? '#!' : '') + path;\n    var i = path.indexOf('?');\n\n    this.canonicalPath = path;\n    this.path = path.replace(base, '') || '/';\n    if (hashbang) this.path = this.path.replace('#!', '') || '/';\n\n    this.title = document.title;\n    this.state = state || {};\n    this.state.path = path;\n    this.querystring = ~i ? decodeURLEncodedURIComponent(path.slice(i + 1)) : '';\n    this.pathname = decodeURLEncodedURIComponent(~i ? path.slice(0, i) : path);\n    this.params = {};\n\n    // fragment\n    this.hash = '';\n    if (!hashbang) {\n      if (!~this.path.indexOf('#')) return;\n      var parts = this.path.split('#');\n      this.path = parts[0];\n      this.hash = decodeURLEncodedURIComponent(parts[1]) || '';\n      this.querystring = this.querystring.split('#')[0];\n    }\n  }\n\n  /**\n   * Expose `Context`.\n   */\n\n  page.Context = Context;\n\n  /**\n   * Push state.\n   *\n   * @api private\n   */\n\n  Context.prototype.pushState = function() {\n    page.len++;\n    history.pushState(this.state, this.title, hashbang && this.path !== '/' ? '#!' + this.path : this.canonicalPath);\n  };\n\n  /**\n   * Save the context state.\n   *\n   * @api public\n   */\n\n  Context.prototype.save = function() {\n    history.replaceState(this.state, this.title, hashbang && this.path !== '/' ? '#!' + this.path : this.canonicalPath);\n  };\n\n  /**\n   * Initialize `Route` with the given HTTP `path`,\n   * and an array of `callbacks` and `options`.\n   *\n   * Options:\n   *\n   *   - `sensitive`    enable case-sensitive routes\n   *   - `strict`       enable strict matching for trailing slashes\n   *\n   * @param {String} path\n   * @param {Object} options.\n   * @api private\n   */\n\n  function Route(path, options) {\n    options = options || {};\n    this.path = (path === '*') ? '(.*)' : path;\n    this.method = 'GET';\n    this.regexp = pathtoRegexp(this.path,\n      this.keys = [],\n      options.sensitive,\n      options.strict);\n  }\n\n  /**\n   * Expose `Route`.\n   */\n\n  page.Route = Route;\n\n  /**\n   * Return route middleware with\n   * the given callback `fn()`.\n   *\n   * @param {Function} fn\n   * @return {Function}\n   * @api public\n   */\n\n  Route.prototype.middleware = function(fn) {\n    var self = this;\n    return function(ctx, next) {\n      if (self.match(ctx.path, ctx.params)) return fn(ctx, next);\n      next();\n    };\n  };\n\n  /**\n   * Check if this route matches `path`, if so\n   * populate `params`.\n   *\n   * @param {String} path\n   * @param {Object} params\n   * @return {Boolean}\n   * @api private\n   */\n\n  Route.prototype.match = function(path, params) {\n    var keys = this.keys,\n      qsIndex = path.indexOf('?'),\n      pathname = ~qsIndex ? path.slice(0, qsIndex) : path,\n      m = this.regexp.exec(decodeURIComponent(pathname));\n\n    if (!m) return false;\n\n    for (var i = 1, len = m.length; i < len; ++i) {\n      var key = keys[i - 1];\n      var val = decodeURLEncodedURIComponent(m[i]);\n      if (val !== undefined || !(hasOwnProperty.call(params, key.name))) {\n        params[key.name] = val;\n      }\n    }\n\n    return true;\n  };\n\n\n  /**\n   * Handle \"populate\" events.\n   */\n\n  var onpopstate = (function () {\n    var loaded = false;\n    if ('undefined' === typeof window) {\n      return;\n    }\n    if (document.readyState === 'complete') {\n      loaded = true;\n    } else {\n      window.addEventListener('load', function() {\n        setTimeout(function() {\n          loaded = true;\n        }, 0);\n      });\n    }\n    return function onpopstate(e) {\n      if (!loaded) return;\n      if (e.state) {\n        var path = e.state.path;\n        page.replace(path, e.state);\n      } else {\n        page.show(location.pathname + location.hash, undefined, undefined, false);\n      }\n    };\n  })();\n  /**\n   * Handle \"click\" events.\n   */\n\n  function onclick(e) {\n\n    if (1 !== which(e)) return;\n\n    if (e.metaKey || e.ctrlKey || e.shiftKey) return;\n    if (e.defaultPrevented) return;\n\n\n\n    // ensure link\n    var el = e.target;\n    while (el && 'A' !== el.nodeName) el = el.parentNode;\n    if (!el || 'A' !== el.nodeName) return;\n\n\n\n    // Ignore if tag has\n    // 1. \"download\" attribute\n    // 2. rel=\"external\" attribute\n    if (el.hasAttribute('download') || el.getAttribute('rel') === 'external') return;\n\n    // ensure non-hash for the same path\n    var link = el.getAttribute('href');\n    if (!hashbang && el.pathname === location.pathname && (el.hash || '#' === link)) return;\n\n\n\n    // Check for mailto: in the href\n    if (link && link.indexOf('mailto:') > -1) return;\n\n    // check target\n    if (el.target) return;\n\n    // x-origin\n    if (!sameOrigin(el.href)) return;\n\n\n\n    // rebuild path\n    var path = el.pathname + el.search + (el.hash || '');\n\n    // strip leading \"/[drive letter]:\" on NW.js on Windows\n    if (typeof process !== 'undefined' && path.match(/^\\/[a-zA-Z]:\\//)) {\n      path = path.replace(/^\\/[a-zA-Z]:\\//, '/');\n    }\n\n    // same page\n    var orig = path;\n\n    if (path.indexOf(base) === 0) {\n      path = path.substr(base.length);\n    }\n\n    if (hashbang) path = path.replace('#!', '');\n\n    if (base && orig === path) return;\n\n    e.preventDefault();\n    page.show(orig);\n  }\n\n  /**\n   * Event button.\n   */\n\n  function which(e) {\n    e = e || window.event;\n    return null === e.which ? e.button : e.which;\n  }\n\n  /**\n   * Check if `href` is the same origin.\n   */\n\n  function sameOrigin(href) {\n    var origin = location.protocol + '//' + location.hostname;\n    if (location.port) origin += ':' + location.port;\n    return (href && (0 === href.indexOf(origin)));\n  }\n\n  page.sameOrigin = sameOrigin;\n","var isArray = require('isarray');\n\n/**\n * Expose `pathToRegexp`.\n */\nmodule.exports = pathToRegexp;\n\n/**\n * The main path matching regexp utility.\n *\n * @type {RegExp}\n */\nvar PATH_REGEXP = new RegExp([\n  // Match escaped characters that would otherwise appear in future matches.\n  // This allows the user to escape special characters that won't transform.\n  '(\\\\\\\\.)',\n  // Match Express-style parameters and un-named parameters with a prefix\n  // and optional suffixes. Matches appear as:\n  //\n  // \"/:test(\\\\d+)?\" => [\"/\", \"test\", \"\\d+\", undefined, \"?\"]\n  // \"/route(\\\\d+)\" => [undefined, undefined, undefined, \"\\d+\", undefined]\n  '([\\\\/.])?(?:\\\\:(\\\\w+)(?:\\\\(((?:\\\\\\\\.|[^)])*)\\\\))?|\\\\(((?:\\\\\\\\.|[^)])*)\\\\))([+*?])?',\n  // Match regexp special characters that are always escaped.\n  '([.+*?=^!:${}()[\\\\]|\\\\/])'\n].join('|'), 'g');\n\n/**\n * Escape the capturing group by escaping special characters and meaning.\n *\n * @param  {String} group\n * @return {String}\n */\nfunction escapeGroup (group) {\n  return group.replace(/([=!:$\\/()])/g, '\\\\$1');\n}\n\n/**\n * Attach the keys as a property of the regexp.\n *\n * @param  {RegExp} re\n * @param  {Array}  keys\n * @return {RegExp}\n */\nfunction attachKeys (re, keys) {\n  re.keys = keys;\n  return re;\n}\n\n/**\n * Get the flags for a regexp from the options.\n *\n * @param  {Object} options\n * @return {String}\n */\nfunction flags (options) {\n  return options.sensitive ? '' : 'i';\n}\n\n/**\n * Pull out keys from a regexp.\n *\n * @param  {RegExp} path\n * @param  {Array}  keys\n * @return {RegExp}\n */\nfunction regexpToRegexp (path, keys) {\n  // Use a negative lookahead to match only capturing groups.\n  var groups = path.source.match(/\\((?!\\?)/g);\n\n  if (groups) {\n    for (var i = 0; i < groups.length; i++) {\n      keys.push({\n        name:      i,\n        delimiter: null,\n        optional:  false,\n        repeat:    false\n      });\n    }\n  }\n\n  return attachKeys(path, keys);\n}\n\n/**\n * Transform an array into a regexp.\n *\n * @param  {Array}  path\n * @param  {Array}  keys\n * @param  {Object} options\n * @return {RegExp}\n */\nfunction arrayToRegexp (path, keys, options) {\n  var parts = [];\n\n  for (var i = 0; i < path.length; i++) {\n    parts.push(pathToRegexp(path[i], keys, options).source);\n  }\n\n  var regexp = new RegExp('(?:' + parts.join('|') + ')', flags(options));\n  return attachKeys(regexp, keys);\n}\n\n/**\n * Replace the specific tags with regexp strings.\n *\n * @param  {String} path\n * @param  {Array}  keys\n * @return {String}\n */\nfunction replacePath (path, keys) {\n  var index = 0;\n\n  function replace (_, escaped, prefix, key, capture, group, suffix, escape) {\n    if (escaped) {\n      return escaped;\n    }\n\n    if (escape) {\n      return '\\\\' + escape;\n    }\n\n    var repeat   = suffix === '+' || suffix === '*';\n    var optional = suffix === '?' || suffix === '*';\n\n    keys.push({\n      name:      key || index++,\n      delimiter: prefix || '/',\n      optional:  optional,\n      repeat:    repeat\n    });\n\n    prefix = prefix ? ('\\\\' + prefix) : '';\n    capture = escapeGroup(capture || group || '[^' + (prefix || '\\\\/') + ']+?');\n\n    if (repeat) {\n      capture = capture + '(?:' + prefix + capture + ')*';\n    }\n\n    if (optional) {\n      return '(?:' + prefix + '(' + capture + '))?';\n    }\n\n    // Basic parameter support.\n    return prefix + '(' + capture + ')';\n  }\n\n  return path.replace(PATH_REGEXP, replace);\n}\n\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n *\n * @param  {(String|RegExp|Array)} path\n * @param  {Array}                 [keys]\n * @param  {Object}                [options]\n * @return {RegExp}\n */\nfunction pathToRegexp (path, keys, options) {\n  keys = keys || [];\n\n  if (!isArray(keys)) {\n    options = keys;\n    keys = [];\n  } else if (!options) {\n    options = {};\n  }\n\n  if (path instanceof RegExp) {\n    return regexpToRegexp(path, keys, options);\n  }\n\n  if (isArray(path)) {\n    return arrayToRegexp(path, keys, options);\n  }\n\n  var strict = options.strict;\n  var end = options.end !== false;\n  var route = replacePath(path, keys);\n  var endsWithSlash = path.charAt(path.length - 1) === '/';\n\n  // In non-strict mode we allow a slash at the end of match. If the path to\n  // match already ends with a slash, we remove it for consistency. The slash\n  // is valid at the end of a path match, not in the middle. This is important\n  // in non-ending mode, where \"/test/\" shouldn't match \"/test//route\".\n  if (!strict) {\n    route = (endsWithSlash ? route.slice(0, -2) : route) + '(?:\\\\/(?=$))?';\n  }\n\n  if (end) {\n    route += '$';\n  } else {\n    // In non-ending mode, we need the capturing groups to match as much as\n    // possible by using a positive lookahead to the end or next path segment.\n    route += strict && endsWithSlash ? '' : '(?=\\\\/|$)';\n  }\n\n  return attachKeys(new RegExp('^' + route, flags(options)), keys);\n}\n","module.exports = Array.isArray || function (arr) {\n  return Object.prototype.toString.call(arr) == '[object Array]';\n};\n","/*! toast 1.2.4 (https://github.com/pyrsmk/toast) */\r\n\r\n;(function(context,name,definition){\r\n\tif(typeof module!='undefined' && module.exports){\r\n\t\tmodule.exports=definition;\r\n\t}\r\n\telse if(typeof define=='function' && define.amd){\r\n\t\tdefine(definition);\r\n\t}\r\n\telse{\r\n\t\tcontext[name]=definition;\r\n\t}\r\n}(this,'toast',function(){\r\n\r\n\tvar handled_resources={};\r\n\r\n\treturn function(){\r\n\t\tvar doc=document,\r\n\t\t\thead=doc.getElementsByTagName('head')[0],\r\n\t\t\tsetTimeout=this.setTimeout,\r\n\t\t\tcreateElement='createElement',\r\n\t\t\tappendChild='appendChild',\r\n\t\t\tonreadystatechange='onreadystatechange',\r\n\t\t\tstyleSheet='styleSheet',\r\n\t\t\tloading=0,\r\n\t\t\tdecrementLoading=function(){--loading;},\r\n\t\t\ti,\r\n\t\t\t// Load as much resources as we can\r\n\t\t\tloadResources=function(resources,callback,a,b){\r\n\t\t\t\t// Waiting for DOM readiness then load resources\r\n\t\t\t\tif(!head){\r\n\t\t\t\t\tsetTimeout(function(){loadResources(resources);},10);\r\n\t\t\t\t}\r\n\t\t\t\t// Load resources\r\n\t\t\t\telse if(resources.length){\r\n\t\t\t\t\ti=-1;\r\n\t\t\t\t\twhile(a=resources[++i]){\r\n\t\t\t\t\t\t// Simple callback\r\n\t\t\t\t\t\tif((b=typeof a)=='function'){\r\n\t\t\t\t\t\t\tcallback=function(){a();return true;};\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Resource\r\n\t\t\t\t\t\telse if(b=='string'){\r\n\t\t\t\t\t\t\tloadResource(a);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Resource + validation callback\r\n\t\t\t\t\t\telse if(a.pop){\r\n\t\t\t\t\t\t\tloadResource(a[0]);\r\n\t\t\t\t\t\t\tcallback=a[1];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\twatchResources(callback,Array.prototype.slice.call(resources,i+1));\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// Load one resource\r\n\t\t\tloadResource=function(resource,a,b){\r\n\t\t\t\t// Extract resource name\r\n\t\t\t\tb=/(^.+\\.\\w+)(\\?.*)?$/.exec(resource)[1];\r\n\t\t\t\t// Verify if the resource is not already handled\r\n\t\t\t\tif(handled_resources[b]){\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// Load resource\r\n\t\t\t\thandled_resources[b]=1;\r\n\t\t\t\t++loading;\r\n\t\t\t\t// JS\r\n\t\t\t\tif(/\\.js$/.test(b)){\r\n\t\t\t\t\t// Create SCRIPT element\r\n\t\t\t\t\ta=doc[createElement]('script');\r\n\t\t\t\t\ta.src=resource;\r\n\t\t\t\t\thead[appendChild](a);\r\n\t\t\t\t\t// Watching loading state\r\n\t\t\t\t\tif(a[onreadystatechange]===null){\r\n\t\t\t\t\t\t// Trident, Presto\r\n\t\t\t\t\t\ta[onreadystatechange]=watchScript;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\t// Webkit, Gecko (also IE>=9 and Presto)\r\n\t\t\t\t\t\ta.onload=decrementLoading;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// CSS\r\n\t\t\t\telse{\r\n\t\t\t\t\t// Create LINK element\r\n\t\t\t\t\ta=doc[createElement]('link');\r\n\t\t\t\t\ta.rel=styleSheet;\r\n\t\t\t\t\ta.href=resource;\r\n\t\t\t\t\thead[appendChild](a);\r\n\t\t\t\t\t// Watching loading state\r\n\t\t\t\t\twatchStylesheet(a);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// Watch if all resources have been loaded\r\n\t\t\twatchResources=function(callback,resourcesToLoad){\r\n\t\t\t\tif(!loading){\r\n\t\t\t\t\tif(!callback || callback()){\r\n\t\t\t\t\t\tloadResources(resourcesToLoad);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tsetTimeout(function(){watchResources(callback,resourcesToLoad);},10);\r\n\t\t\t},\r\n\t\t\t// Watch if a CSS resource has been loaded\r\n\t\t\twatchStylesheet=function(node){\r\n\t\t\t\tif(node.sheet || node[styleSheet]){\r\n\t\t\t\t\tdecrementLoading();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tsetTimeout(function(){watchStylesheet(node);},10);\r\n\t\t\t},\r\n\t\t\t// Watch if a script has been loaded\r\n\t\t\twatchScript=function(){\r\n\t\t\t\tif(/ded|co/.test(this.readyState)){\r\n\t\t\t\t\tdecrementLoading();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t// Load resources\r\n\t\tloadResources(arguments);\r\n\t};\r\n\r\n}()));\r\n","/* jshint node: true */\n/* global location */\n'use strict';\n\nvar rtc = require('rtc-tools');\nvar mbus = require('mbus');\nvar detectPlugin = require('rtc-core/plugin');\nvar debug = rtc.logger('rtc-quickconnect');\nvar extend = require('cog/extend');\n\n/**\n  # rtc-quickconnect\n\n  This is a high level helper module designed to help you get up\n  an running with WebRTC really, really quickly.  By using this module you\n  are trading off some flexibility, so if you need a more flexible\n  configuration you should drill down into lower level components of the\n  [rtc.io](http://www.rtc.io) suite.  In particular you should check out\n  [rtc](https://github.com/rtc-io/rtc).\n\n  ## Example Usage\n\n  In the simplest case you simply call quickconnect with a single string\n  argument which tells quickconnect which server to use for signaling:\n\n  <<< examples/simple.js\n\n  <<< docs/events.md\n\n  <<< docs/examples.md\n\n  ## Regarding Signalling and a Signalling Server\n\n  Signaling is an important part of setting up a WebRTC connection and for\n  our examples we use our own test instance of the\n  [rtc-switchboard](https://github.com/rtc-io/rtc-switchboard). For your\n  testing and development you are more than welcome to use this also, but\n  just be aware that we use this for our testing so it may go up and down\n  a little.  If you need something more stable, why not consider deploying\n  an instance of the switchboard yourself - it's pretty easy :)\n\n  ## Reference\n\n  ```\n  quickconnect(signalhost, opts?) => rtc-sigaller instance (+ helpers)\n  ```\n\n  ### Valid Quick Connect Options\n\n  The options provided to the `rtc-quickconnect` module function influence the\n  behaviour of some of the underlying components used from the rtc.io suite.\n\n  Listed below are some of the commonly used options:\n\n  - `ns` (default: '')\n\n    An optional namespace for your signalling room.  While quickconnect\n    will generate a unique hash for the room, this can be made to be more\n    unique by providing a namespace.  Using a namespace means two demos\n    that have generated the same hash but use a different namespace will be\n    in different rooms.\n\n  - `room` (default: null) _added 0.6_\n\n    Rather than use the internal hash generation\n    (plus optional namespace) for room name generation, simply use this room\n    name instead.  __NOTE:__ Use of the `room` option takes precendence over\n    `ns`.\n\n  - `debug` (default: false)\n\n  Write rtc.io suite debug output to the browser console.\n\n  - `expectedLocalStreams` (default: not specified) _added 3.0_\n\n    By providing a positive integer value for this option will mean that\n    the created quickconnect instance will wait until the specified number of\n    streams have been added to the quickconnect \"template\" before announcing\n    to the signaling server.\n\n  - `manualJoin` (default: `false`)\n\n    Set this value to `true` if you would prefer to call the `join` function\n    to connecting to the signalling server, rather than having that happen\n    automatically as soon as quickconnect is ready to.\n\n  #### Options for Peer Connection Creation\n\n  Options that are passed onto the\n  [rtc.createConnection](https://github.com/rtc-io/rtc#createconnectionopts-constraints)\n  function:\n\n  - `iceServers`\n\n  This provides a list of ice servers that can be used to help negotiate a\n  connection between peers.\n\n  #### Options for P2P negotiation\n\n  Under the hood, quickconnect uses the\n  [rtc/couple](https://github.com/rtc-io/rtc#rtccouple) logic, and the options\n  passed to quickconnect are also passed onto this function.\n\n**/\nmodule.exports = function(signalhost, opts) {\n  var hash = typeof location != 'undefined' && location.hash.slice(1);\n  var signaller = require('rtc-pluggable-signaller')(extend({\n    signaller: signalhost,\n\n    // use the primus endpoint as a fallback in case we are talking to an\n    // older switchboard instance\n    endpoints: ['/', '/primus']\n  }, opts));\n  var getPeerData = require('./lib/getpeerdata')(signaller.peers);\n\n  // init configurable vars\n  var ns = (opts || {}).ns || '';\n  var room = (opts || {}).room;\n  var debugging = (opts || {}).debug;\n  var allowJoin = !(opts || {}).manualJoin;\n  var profile = {};\n  var announced = false;\n\n  // initialise iceServers to undefined\n  // we will not announce until these have been properly initialised\n  var iceServers;\n\n  // collect the local streams\n  var localStreams = [];\n\n  // create the calls map\n  var calls = signaller.calls = require('./lib/calls')(signaller, opts);\n\n  // create the known data channels registry\n  var channels = {};\n\n  // save the plugins passed to the signaller\n  var plugins = signaller.plugins = (opts || {}).plugins || [];\n  var plugin = detectPlugin(plugins);\n  var pluginReady;\n\n  // check how many local streams have been expected (default: 0)\n  var expectedLocalStreams = parseInt((opts || {}).expectedLocalStreams, 10) || 0;\n  var announceTimer = 0;\n  var updateTimer = 0;\n\n  function checkReadyToAnnounce() {\n    clearTimeout(announceTimer);\n    // if we have already announced do nothing!\n    if (announced) {\n      return;\n    }\n\n    if (! allowJoin) {\n      return;\n    }\n\n    // if we have a plugin but it's not initialized we aren't ready\n    if (plugin && (! pluginReady)) {\n      return;\n    }\n\n    // if we have no iceServers we aren't ready\n    if (! iceServers) {\n      return;\n    }\n\n    // if we are waiting for a set number of streams, then wait until we have\n    // the required number\n    if (expectedLocalStreams && localStreams.length < expectedLocalStreams) {\n      return;\n    }\n\n    // announce ourselves to our new friend\n    announceTimer = setTimeout(function() {\n      var data = extend({ room: room }, profile);\n\n      // announce and emit the local announce event\n      signaller.announce(data);\n      announced = true;\n    }, 0);\n  }\n\n  function connect(id) {\n    var data = getPeerData(id);\n    var pc;\n    var monitor;\n\n    // if the room is not a match, abort\n    if (data.room !== room) {\n      return;\n    }\n\n    // end any call to this id so we know we are starting fresh\n    calls.end(id);\n\n    // create a peer connection\n    // iceServers that have been created using genice taking precendence\n    pc = rtc.createConnection(\n      extend({}, opts, { iceServers: iceServers }),\n      (opts || {}).constraints\n    );\n\n    signaller('peer:connect', data.id, pc, data);\n\n    // add this connection to the calls list\n    calls.create(data.id, pc);\n\n    // add the local streams\n    localStreams.forEach(function(stream) {\n      pc.addStream(stream);\n    });\n\n    // add the data channels\n    // do this differently based on whether the connection is a\n    // master or a slave connection\n    if (signaller.isMaster(data.id)) {\n      debug('is master, creating data channels: ', Object.keys(channels));\n\n      // create the channels\n      Object.keys(channels).forEach(function(label) {\n       gotPeerChannel(pc.createDataChannel(label, channels[label]), pc, data);\n      });\n    }\n    else {\n      pc.ondatachannel = function(evt) {\n        var channel = evt && evt.channel;\n\n        // if we have no channel, abort\n        if (! channel) {\n          return;\n        }\n\n        if (channels[channel.label] !== undefined) {\n          gotPeerChannel(channel, pc, getPeerData(id));\n        }\n      };\n    }\n\n    // couple the connections\n    debug('coupling ' + signaller.id + ' to ' + data.id);\n    monitor = rtc.couple(pc, id, signaller, extend({}, opts, {\n      logger: mbus('pc.' + id, signaller)\n    }));\n\n    signaller('peer:couple', id, pc, data, monitor);\n\n    // once active, trigger the peer connect event\n    monitor.once('connected', calls.start.bind(null, id, pc, data));\n    monitor.once('closed', calls.end.bind(null, id));\n\n    // if we are the master connnection, create the offer\n    // NOTE: this only really for the sake of politeness, as rtc couple\n    // implementation handles the slave attempting to create an offer\n    if (signaller.isMaster(id)) {\n      monitor.createOffer();\n    }\n  }\n\n  function getActiveCall(peerId) {\n    var call = calls.get(peerId);\n\n    if (! call) {\n      throw new Error('No active call for peer: ' + peerId);\n    }\n\n    return call;\n  }\n\n  function gotPeerChannel(channel, pc, data) {\n    var channelMonitor;\n\n    function channelReady() {\n      var call = calls.get(data.id);\n      var args = [ data.id, channel, data, pc ];\n\n      // decouple the channel.onopen listener\n      debug('reporting channel \"' + channel.label + '\" ready, have call: ' + (!!call));\n      clearInterval(channelMonitor);\n      channel.onopen = null;\n\n      // save the channel\n      if (call) {\n        call.channels.set(channel.label, channel);\n      }\n\n      // trigger the %channel.label%:open event\n      debug('triggering channel:opened events for channel: ' + channel.label);\n\n      // emit the plain channel:opened event\n      signaller.apply(signaller, ['channel:opened'].concat(args));\n\n      // emit the channel:opened:%label% eve\n      signaller.apply(\n        signaller,\n        ['channel:opened:' + channel.label].concat(args)\n      );\n    }\n\n    debug('channel ' + channel.label + ' discovered for peer: ' + data.id);\n    if (channel.readyState === 'open') {\n      return channelReady();\n    }\n\n    debug('channel not ready, current state = ' + channel.readyState);\n    channel.onopen = channelReady;\n\n    // monitor the channel open (don't trust the channel open event just yet)\n    channelMonitor = setInterval(function() {\n      debug('checking channel state, current state = ' + channel.readyState);\n      if (channel.readyState === 'open') {\n        channelReady();\n      }\n    }, 500);\n  }\n\n  function initPlugin() {\n    return plugin && plugin.init(opts, function(err) {\n      if (err) {\n        return console.error('Could not initialize plugin: ', err);\n      }\n\n      pluginReady = true;\n      checkReadyToAnnounce();\n    });\n  }\n\n  function handleLocalAnnounce(data) {\n    // if we send an announce with an updated room then update our local room name\n    if (data && typeof data.room != 'undefined') {\n      room = data.room;\n    }\n  }\n\n  function handlePeerFilter(id, data) {\n    // only connect with the peer if we are ready\n    data.allow = data.allow && (localStreams.length >= expectedLocalStreams);\n  }\n\n  function handlePeerUpdate(data) {\n    var id = data && data.id;\n    var activeCall = id && calls.get(id);\n\n    // if we have received an update for a peer that has no active calls,\n    // then pass this onto the announce handler\n    if (id && (! activeCall)) {\n      debug('received peer update from peer ' + id + ', no active calls');\n      signaller.to(id).send('/reconnect');\n      return connect(id);\n    }\n  }\n\n  // if the room is not defined, then generate the room name\n  if (! room) {\n    // if the hash is not assigned, then create a random hash value\n    if (typeof location != 'undefined' && (! hash)) {\n      hash = location.hash = '' + (Math.pow(2, 53) * Math.random());\n    }\n\n    room = ns + '#' + hash;\n  }\n\n  if (debugging) {\n    rtc.logger.enable.apply(rtc.logger, Array.isArray(debug) ? debugging : ['*']);\n  }\n\n  signaller.on('peer:announce', function(data) {\n    connect(data.id);\n  });\n\n  signaller.on('peer:update', handlePeerUpdate);\n\n  signaller.on('message:reconnect', function(sender) {\n    connect(sender.id);\n  });\n\n\n\n  /**\n    ### Quickconnect Broadcast and Data Channel Helper Functions\n\n    The following are functions that are patched into the `rtc-signaller`\n    instance that make working with and creating functional WebRTC applications\n    a lot simpler.\n\n  **/\n\n  /**\n    #### addStream\n\n    ```\n    addStream(stream:MediaStream) => qc\n    ```\n\n    Add the stream to active calls and also save the stream so that it\n    can be added to future calls.\n\n  **/\n  signaller.broadcast = signaller.addStream = function(stream) {\n    localStreams.push(stream);\n\n    // if we have any active calls, then add the stream\n    calls.values().forEach(function(data) {\n      data.pc.addStream(stream);\n    });\n\n    checkReadyToAnnounce();\n    return signaller;\n  };\n\n  /**\n    #### endCalls()\n\n    The `endCalls` function terminates all the active calls that have been\n    created in this quickconnect instance.  Calling `endCalls` does not\n    kill the connection with the signalling server.\n\n  **/\n  signaller.endCalls = function() {\n    calls.keys().forEach(calls.end);\n  };\n\n  /**\n    #### close()\n\n    The `close` function provides a convenient way of closing all associated\n    peer connections.  This function simply uses the `endCalls` function and\n    the underlying `leave` function of the signaller to do a \"full cleanup\"\n    of all connections.\n  **/\n  signaller.close = function() {\n    signaller.endCalls();\n    signaller.leave();\n  };\n\n  /**\n    #### createDataChannel(label, config)\n\n    Request that a data channel with the specified `label` is created on\n    the peer connection.  When the data channel is open and available, an\n    event will be triggered using the label of the data channel.\n\n    For example, if a new data channel was requested using the following\n    call:\n\n    ```js\n    var qc = quickconnect('https://switchboard.rtc.io/').createDataChannel('test');\n    ```\n\n    Then when the data channel is ready for use, a `test:open` event would\n    be emitted by `qc`.\n\n  **/\n  signaller.createDataChannel = function(label, opts) {\n    // create a channel on all existing calls\n    calls.keys().forEach(function(peerId) {\n      var call = calls.get(peerId);\n      var dc;\n\n      // if we are the master connection, create the data channel\n      if (call && call.pc && signaller.isMaster(peerId)) {\n        dc = call.pc.createDataChannel(label, opts);\n        gotPeerChannel(dc, call.pc, getPeerData(peerId));\n      }\n    });\n\n    // save the data channel opts in the local channels dictionary\n    channels[label] = opts || null;\n\n    return signaller;\n  };\n\n  /**\n    #### join()\n\n    The `join` function is used when `manualJoin` is set to true when creating\n    a quickconnect instance.  Call the `join` function once you are ready to\n    join the signalling server and initiate connections with other people.\n\n  **/\n  signaller.join = function() {\n    allowJoin = true;\n    checkReadyToAnnounce();\n  };\n\n  /**\n    #### `get(name)`\n\n    The `get` function returns the property value for the specified property name.\n  **/\n  signaller.get = function(name) {\n    return profile[name];\n  };\n\n  /**\n    #### `getLocalStreams()`\n\n    Return a copy of the local streams that have currently been configured\n  **/\n  signaller.getLocalStreams = function() {\n    return [].concat(localStreams);\n  };\n\n  /**\n    #### reactive()\n\n    Flag that this session will be a reactive connection.\n\n  **/\n  signaller.reactive = function() {\n    // add the reactive flag\n    opts = opts || {};\n    opts.reactive = true;\n\n    // chain\n    return signaller;\n  };\n\n  /**\n    #### removeStream\n\n    ```\n    removeStream(stream:MediaStream)\n    ```\n\n    Remove the specified stream from both the local streams that are to\n    be connected to new peers, and also from any active calls.\n\n  **/\n  signaller.removeStream = function(stream) {\n    var localIndex = localStreams.indexOf(stream);\n\n    // remove the stream from any active calls\n    calls.values().forEach(function(call) {\n      call.pc.removeStream(stream);\n    });\n\n    // remove the stream from the localStreams array\n    if (localIndex >= 0) {\n      localStreams.splice(localIndex, 1);\n    }\n\n    return signaller;\n  };\n\n  /**\n    #### requestChannel\n\n    ```\n    requestChannel(targetId, label, callback)\n    ```\n\n    This is a function that can be used to respond to remote peers supplying\n    a data channel as part of their configuration.  As per the `receiveStream`\n    function this function will either fire the callback immediately if the\n    channel is already available, or once the channel has been discovered on\n    the call.\n\n  **/\n  signaller.requestChannel = function(targetId, label, callback) {\n    var call = getActiveCall(targetId);\n    var channel = call && call.channels.get(label);\n\n    // if we have then channel trigger the callback immediately\n    if (channel) {\n      callback(null, channel);\n      return signaller;\n    }\n\n    // if not, wait for it\n    signaller.once('channel:opened:' + label, function(id, dc) {\n      callback(null, dc);\n    });\n\n    return signaller;\n  };\n\n  /**\n    #### requestStream\n\n    ```\n    requestStream(targetId, idx, callback)\n    ```\n\n    Used to request a remote stream from a quickconnect instance. If the\n    stream is already available in the calls remote streams, then the callback\n    will be triggered immediately, otherwise this function will monitor\n    `stream:added` events and wait for a match.\n\n    In the case that an unknown target is requested, then an exception will\n    be thrown.\n  **/\n  signaller.requestStream = function(targetId, idx, callback) {\n    var call = getActiveCall(targetId);\n    var stream;\n\n    function waitForStream(peerId) {\n      if (peerId !== targetId) {\n        return;\n      }\n\n      // get the stream\n      stream = call.pc.getRemoteStreams()[idx];\n\n      // if we have the stream, then remove the listener and trigger the cb\n      if (stream) {\n        signaller.removeListener('stream:added', waitForStream);\n        callback(null, stream);\n      }\n    }\n\n    // look for the stream in the remote streams of the call\n    stream = call.pc.getRemoteStreams()[idx];\n\n    // if we found the stream then trigger the callback\n    if (stream) {\n      callback(null, stream);\n      return signaller;\n    }\n\n    // otherwise wait for the stream\n    signaller.on('stream:added', waitForStream);\n    return signaller;\n  };\n\n  /**\n    #### profile(data)\n\n    Update the profile data with the attached information, so when\n    the signaller announces it includes this data in addition to any\n    room and id information.\n\n  **/\n  signaller.profile = function(data) {\n    extend(profile, data);\n\n    // if we have already announced, then reannounce our profile to provide\n    // others a `peer:update` event\n    if (announced) {\n      clearTimeout(updateTimer);\n      updateTimer = setTimeout(function() {\n        signaller.announce(profile);\n      }, (opts || {}).updateDelay || 1000);\n    }\n\n    return signaller;\n  };\n\n  /**\n    #### waitForCall\n\n    ```\n    waitForCall(targetId, callback)\n    ```\n\n    Wait for a call from the specified targetId.  If the call is already\n    active the callback will be fired immediately, otherwise we will wait\n    for a `call:started` event that matches the requested `targetId`\n\n  **/\n  signaller.waitForCall = function(targetId, callback) {\n    var call = calls.get(targetId);\n\n    if (call && call.active) {\n      callback(null, call.pc);\n      return signaller;\n    }\n\n    signaller.on('call:started', function handleNewCall(id) {\n      if (id === targetId) {\n        signaller.removeListener('call:started', handleNewCall);\n        callback(null, calls.get(id).pc);\n      }\n    });\n  };\n\n  // if we have an expected number of local streams, then use a filter to\n  // check if we should respond\n  if (expectedLocalStreams) {\n    signaller.on('peer:filter', handlePeerFilter);\n  }\n\n  // respond to local announce messages\n  signaller.on('local:announce', handleLocalAnnounce);\n\n  // handle ping messages\n  signaller.on('message:ping', calls.ping);\n\n  // use genice to find our iceServers\n  require('rtc-core/genice')(opts, function(err, servers) {\n    if (err) {\n      return console.error('could not find iceServers: ', err);\n    }\n\n    iceServers = servers;\n    checkReadyToAnnounce();\n  });\n\n  // if we plugin is active, then initialize it\n  if (plugin) {\n    initPlugin();\n  }\n\n  // pass the signaller on\n  return signaller;\n};\n","var rtc = require('rtc-tools');\nvar debug = rtc.logger('rtc-quickconnect');\nvar cleanup = require('rtc-tools/cleanup');\nvar getable = require('cog/getable');\n\nmodule.exports = function(signaller, opts) {\n  var calls = getable({});\n  var getPeerData = require('./getpeerdata')(signaller.peers);\n  var heartbeat;\n\n  function create(id, pc) {\n    calls.set(id, {\n      active: false,\n      pc: pc,\n      channels: getable({}),\n      streams: [],\n      lastping: Date.now()\n    });\n  }\n\n  function createStreamAddHandler(id) {\n    return function(evt) {\n      debug('peer ' + id + ' added stream');\n      updateRemoteStreams(id);\n      receiveRemoteStream(id)(evt.stream);\n    };\n  }\n\n  function createStreamRemoveHandler(id) {\n    return function(evt) {\n      debug('peer ' + id + ' removed stream');\n      updateRemoteStreams(id);\n      signaller('stream:removed', id, evt.stream);\n    };\n  }\n\n  function end(id) {\n    var call = calls.get(id);\n\n    // if we have no data, then do nothing\n    if (! call) {\n      return;\n    }\n\n    // if we have no data, then return\n    call.channels.keys().forEach(function(label) {\n      var channel = call.channels.get(label);\n      var args = [id, channel, label];\n\n      // emit the plain channel:closed event\n      signaller.apply(signaller, ['channel:closed'].concat(args));\n\n      // emit the labelled version of the event\n      signaller.apply(signaller, ['channel:closed:' + label].concat(args));\n\n      // decouple the events\n      channel.onopen = null;\n    });\n\n    // trigger stream:removed events for each of the remotestreams in the pc\n    call.streams.forEach(function(stream) {\n      signaller('stream:removed', id, stream);\n    });\n\n    // delete the call data\n    calls.delete(id);\n\n    // if we have no more calls, disable the heartbeat\n    if (calls.keys().length === 0) {\n      resetHeartbeat();\n    }\n\n    // trigger the call:ended event\n    signaller('call:ended', id, call.pc);\n\n    // ensure the peer connection is properly cleaned up\n    cleanup(call.pc);\n  }\n\n  function ping(sender) {\n    var call = calls.get(sender && sender.id);\n\n    // set the last ping for the data\n    if (call) {\n      call.lastping = Date.now();\n    }\n  }\n\n  function receiveRemoteStream(id) {\n    return function(stream) {\n      signaller('stream:added', id, stream, getPeerData(id));\n    };\n  }\n\n  function resetHeartbeat() {\n    clearInterval(heartbeat);\n    heartbeat = 0;\n  }\n\n  function start(id, pc, data) {\n    var call = calls.get(id);\n    var streams = [].concat(pc.getRemoteStreams());\n\n    // flag the call as active\n    call.active = true;\n    call.streams = [].concat(pc.getRemoteStreams());\n\n    pc.onaddstream = createStreamAddHandler(id);\n    pc.onremovestream = createStreamRemoveHandler(id);\n\n    debug(signaller.id + ' - ' + id + ' call start: ' + streams.length + ' streams');\n    signaller('call:started', id, pc, data);\n\n    // configure the heartbeat timer\n    heartbeat = heartbeat || require('./heartbeat')(signaller, calls, opts);\n\n    // examine the existing remote streams after a short delay\n    process.nextTick(function() {\n      // iterate through any remote streams\n      streams.forEach(receiveRemoteStream(id));\n    });\n  }\n\n  function updateRemoteStreams(id) {\n    var call = calls.get(id);\n\n    if (call && call.pc) {\n      call.streams = [].concat(call.pc.getRemoteStreams());\n    }\n  }\n\n  calls.create = create;\n  calls.end = end;\n  calls.ping = ping;\n  calls.start = start;\n\n  return calls;\n};\n","module.exports = function(peers) {\n  return function(id) {\n    var peer = peers.get(id);\n    return peer && peer.data;\n  };\n};\n","module.exports = function(signaller, calls, opts) {\n  var heartbeat = (opts || {}).heartbeat || 2500;\n  var heartbeatTimer = 0;\n\n  function send() {\n    var tickInactive = (Date.now() - (heartbeat * 4));\n\n    // iterate through our established calls\n    calls.keys().forEach(function(id) {\n      var call = calls.get(id);\n\n      // if the call ping is too old, end the call\n      if (call.lastping < tickInactive) {\n        signaller('call:expired', id, call.pc);\n        return calls.end(id);\n      }\n\n      // send a ping message\n      signaller.to(id).send('/ping');\n    });\n  }\n\n  if (! heartbeat) {\n    return;\n  }\n\n  return setInterval(send, heartbeat);\n};\n","/* jshint node: true */\n'use strict';\n\n/**\n## cog/defaults\n\n```js\nvar defaults = require('cog/defaults');\n```\n\n### defaults(target, *)\n\nShallow copy object properties from the supplied source objects (*) into\nthe target object, returning the target object once completed.  Do not,\nhowever, overwrite existing keys with new values:\n\n```js\ndefaults({ a: 1, b: 2 }, { c: 3 }, { d: 4 }, { b: 5 }));\n```\n\nSee an example on [requirebin](http://requirebin.com/?gist=6079475).\n**/\nmodule.exports = function(target) {\n  // ensure we have a target\n  target = target || {};\n\n  // iterate through the sources and copy to the target\n  [].slice.call(arguments, 1).forEach(function(source) {\n    if (! source) {\n      return;\n    }\n\n    for (var prop in source) {\n      if (target[prop] === void 0) {\n        target[prop] = source[prop];\n      }\n    }\n  });\n\n  return target;\n};","/* jshint node: true */\n'use strict';\n\n/**\n## cog/extend\n\n```js\nvar extend = require('cog/extend');\n```\n\n### extend(target, *)\n\nShallow copy object properties from the supplied source objects (*) into\nthe target object, returning the target object once completed:\n\n```js\nextend({ a: 1, b: 2 }, { c: 3 }, { d: 4 }, { b: 5 }));\n```\n\nSee an example on [requirebin](http://requirebin.com/?gist=6079475).\n**/\nmodule.exports = function(target) {\n  [].slice.call(arguments, 1).forEach(function(source) {\n    if (! source) {\n      return;\n    }\n\n    for (var prop in source) {\n      target[prop] = source[prop];\n    }\n  });\n\n  return target;\n};","/**\n  ## cog/getable\n\n  Take an object and provide a wrapper that allows you to `get` and\n  `set` values on that object.\n\n**/\nmodule.exports = function(target) {\n  function get(key) {\n    return target[key];\n  }\n\n  function set(key, value) {\n    target[key] = value;\n  }\n\n  function remove(key) {\n    return delete target[key];\n  }\n\n  function keys() {\n    return Object.keys(target);\n  };\n\n  function values() {\n    return Object.keys(target).map(function(key) {\n      return target[key];\n    });\n  };\n\n  if (typeof target != 'object') {\n    return target;\n  }\n\n  return {\n    get: get,\n    set: set,\n    remove: remove,\n    delete: remove,\n    keys: keys,\n    values: values\n  };\n};\n","/* jshint node: true */\n'use strict';\n\n/**\n  ## cog/jsonparse\n\n  ```js\n  var jsonparse = require('cog/jsonparse');\n  ```\n\n  ### jsonparse(input)\n\n  This function will attempt to automatically detect stringified JSON, and\n  when detected will parse into JSON objects.  The function looks for strings\n  that look and smell like stringified JSON, and if found attempts to\n  `JSON.parse` the input into a valid object.\n\n**/\nmodule.exports = function(input) {\n  var isString = typeof input == 'string' || (input instanceof String);\n  var reNumeric = /^\\-?\\d+\\.?\\d*$/;\n  var shouldParse ;\n  var firstChar;\n  var lastChar;\n\n  if ((! isString) || input.length < 2) {\n    if (isString && reNumeric.test(input)) {\n      return parseFloat(input);\n    }\n\n    return input;\n  }\n\n  // check for true or false\n  if (input === 'true' || input === 'false') {\n    return input === 'true';\n  }\n\n  // check for null\n  if (input === 'null') {\n    return null;\n  }\n\n  // get the first and last characters\n  firstChar = input.charAt(0);\n  lastChar = input.charAt(input.length - 1);\n\n  // determine whether we should JSON.parse the input\n  shouldParse =\n    (firstChar == '{' && lastChar == '}') ||\n    (firstChar == '[' && lastChar == ']') ||\n    (firstChar == '\"' && lastChar == '\"');\n\n  if (shouldParse) {\n    try {\n      return JSON.parse(input);\n    }\n    catch (e) {\n      // apparently it wasn't valid json, carry on with regular processing\n    }\n  }\n\n\n  return reNumeric.test(input) ? parseFloat(input) : input;\n};","/* jshint node: true */\n'use strict';\n\n/**\n  ## cog/logger\n\n  ```js\n  var logger = require('cog/logger');\n  ```\n\n  Simple browser logging offering similar functionality to the\n  [debug](https://github.com/visionmedia/debug) module.\n\n  ### Usage\n\n  Create your self a new logging instance and give it a name:\n\n  ```js\n  var debug = logger('phil');\n  ```\n\n  Now do some debugging:\n\n  ```js\n  debug('hello');\n  ```\n\n  At this stage, no log output will be generated because your logger is\n  currently disabled.  Enable it:\n\n  ```js\n  logger.enable('phil');\n  ```\n\n  Now do some more logger:\n\n  ```js\n  debug('Oh this is so much nicer :)');\n  // --> phil: Oh this is some much nicer :)\n  ```\n\n  ### Reference\n**/\n\nvar active = [];\nvar unleashListeners = [];\nvar targets = [ console ];\n\n/**\n  #### logger(name)\n\n  Create a new logging instance.\n**/\nvar logger = module.exports = function(name) {\n  // initial enabled check\n  var enabled = checkActive();\n\n  function checkActive() {\n    return enabled = active.indexOf('*') >= 0 || active.indexOf(name) >= 0;\n  }\n\n  // register the check active with the listeners array\n  unleashListeners[unleashListeners.length] = checkActive;\n\n  // return the actual logging function\n  return function() {\n    var args = [].slice.call(arguments);\n\n    // if we have a string message\n    if (typeof args[0] == 'string' || (args[0] instanceof String)) {\n      args[0] = name + ': ' + args[0];\n    }\n\n    // if not enabled, bail\n    if (! enabled) {\n      return;\n    }\n\n    // log\n    targets.forEach(function(target) {\n      target.log.apply(target, args);\n    });\n  };\n};\n\n/**\n  #### logger.reset()\n\n  Reset logging (remove the default console logger, flag all loggers as\n  inactive, etc, etc.\n**/\nlogger.reset = function() {\n  // reset targets and active states\n  targets = [];\n  active = [];\n\n  return logger.enable();\n};\n\n/**\n  #### logger.to(target)\n\n  Add a logging target.  The logger must have a `log` method attached.\n\n**/\nlogger.to = function(target) {\n  targets = targets.concat(target || []);\n\n  return logger;\n};\n\n/**\n  #### logger.enable(names*)\n\n  Enable logging via the named logging instances.  To enable logging via all\n  instances, you can pass a wildcard:\n\n  ```js\n  logger.enable('*');\n  ```\n\n  __TODO:__ wildcard enablers\n**/\nlogger.enable = function() {\n  // update the active\n  active = active.concat([].slice.call(arguments));\n\n  // trigger the unleash listeners\n  unleashListeners.forEach(function(listener) {\n    listener();\n  });\n\n  return logger;\n};","/* jshint node: true */\n'use strict';\n\n/**\n  ## cog/throttle\n\n  ```js\n  var throttle = require('cog/throttle');\n  ```\n\n  ### throttle(fn, delay, opts)\n\n  A cherry-pickable throttle function.  Used to throttle `fn` to ensure\n  that it can be called at most once every `delay` milliseconds.  Will\n  fire first event immediately, ensuring the next event fired will occur\n  at least `delay` milliseconds after the first, and so on.\n\n**/\nmodule.exports = function(fn, delay, opts) {\n  var lastExec = (opts || {}).leading !== false ? 0 : Date.now();\n  var trailing = (opts || {}).trailing;\n  var timer;\n  var queuedArgs;\n  var queuedScope;\n\n  // trailing defaults to true\n  trailing = trailing || trailing === undefined;\n  \n  function invokeDefered() {\n    fn.apply(queuedScope, queuedArgs || []);\n    lastExec = Date.now();\n  }\n\n  return function() {\n    var tick = Date.now();\n    var elapsed = tick - lastExec;\n\n    // always clear the defered timer\n    clearTimeout(timer);\n\n    if (elapsed < delay) {\n      queuedArgs = [].slice.call(arguments, 0);\n      queuedScope = this;\n\n      return trailing && (timer = setTimeout(invokeDefered, delay - elapsed));\n    }\n\n    // call the function\n    lastExec = tick;\n    fn.apply(this, arguments);\n  };\n};","var reDelim = /[\\.\\:]/;\n\n/**\n  # mbus\n\n  If Node's EventEmitter and Eve were to have a child, it might look something like this.\n  No wildcard support at this stage though...\n\n  ## Example Usage\n\n  <<< docs/usage.md\n\n  ## Reference\n\n  ### `mbus(namespace?, parent?, scope?)`\n\n  Create a new message bus with `namespace` inheriting from the `parent`\n  mbus instance.  If events from this message bus should be triggered with\n  a specific `this` scope, then specify it using the `scope` argument.\n\n**/\n\nvar createBus = module.exports = function(namespace, parent, scope) {\n  var registry = {};\n  var feeds = [];\n\n  function bus(name) {\n    var args = [].slice.call(arguments, 1);\n    var delimited = normalize(name);\n    var handlers = registry[delimited] || [];\n    var results;\n\n    // send through the feeds\n    feeds.forEach(function(feed) {\n      feed({ name: delimited, args: args });\n    });\n\n    // run the registered handlers\n    results = [].concat(handlers).map(function(handler) {\n      return handler.apply(scope || this, args);\n    });\n\n    // run the parent handlers\n    if (bus.parent) {\n      results = results.concat(\n        bus.parent.apply(\n          scope || this,\n          [(namespace ? namespace + '.' : '') + delimited].concat(args)\n        )\n      );\n    }\n\n    return results;\n  }\n\n  /**\n    ### `mbus#clear()`\n\n    Reset the handler registry, which essential deregisters all event listeners.\n\n    _Alias:_ `removeAllListeners`\n  **/\n  function clear(name) {\n    // if we have a name, reset handlers for that handler\n    if (name) {\n      delete registry[normalize(name)];\n    }\n    // otherwise, reset the entire handler registry\n    else {\n      registry = {};\n    }\n  }\n\n  /**\n    ### `mbus#feed(handler)`\n\n    Attach a handler function that will see all events that are sent through\n    this bus in an \"object stream\" format that matches the following format:\n\n    ```\n    { name: 'event.name', args: [ 'event', 'args' ] }\n    ```\n\n    The feed function returns a function that can be called to stop the feed\n    sending data.\n\n  **/\n  function feed(handler) {\n    function stop() {\n      feeds.splice(feeds.indexOf(handler), 1);\n    }\n\n    feeds.push(handler);\n    return stop;\n  }\n\n  function normalize(name) {\n    return (Array.isArray(name) ? name : name.split(reDelim)).join('.');\n  }\n\n  /**\n    ### `mbus#off(name, handler)`\n\n    Deregister an event handler.\n  **/\n  function off(name, handler) {\n    var handlers = registry[normalize(name)] || [];\n    var idx = handlers ? handlers.indexOf(handler._actual || handler) : -1;\n\n    if (idx >= 0) {\n      handlers.splice(idx, 1);\n    }\n  }\n\n  /**\n    ### `mbus#on(name, handler)`\n\n    Register an event handler for the event `name`.\n\n  **/\n  function on(name, handler) {\n    var handlers;\n\n    name = normalize(name);\n    handlers = registry[name];\n\n    if (handlers) {\n      handlers.push(handler);\n    }\n    else {\n      registry[name] = [ handler ];\n    }\n\n    return bus;\n  }\n\n\n  /**\n    ### `mbus#once(name, handler)`\n\n    Register an event handler for the event `name` that will only\n    trigger once (i.e. the handler will be deregistered immediately after\n    being triggered the first time).\n\n  **/\n  function once(name, handler) {\n    function handleEvent() {\n      var result = handler.apply(this, arguments);\n\n      bus.off(name, handleEvent);\n      return result;\n    }\n\n    handler._actual = handleEvent;\n    return on(name, handleEvent);\n  }\n\n  if (typeof namespace == 'function') {\n    parent = namespace;\n    namespace = '';\n  }\n\n  namespace = normalize(namespace || '');\n\n  bus.clear = bus.removeAllListeners = clear;\n  bus.feed = feed;\n  bus.on = bus.addListener = on;\n  bus.once = once;\n  bus.off = bus.removeListener = off;\n  bus.parent = parent || (namespace && createBus());\n\n  return bus;\n};\n","/* jshint node: true */\n/* global window: false */\n/* global navigator: false */\n\n'use strict';\n\nvar browser = require('detect-browser');\n\n/**\n  ### `rtc-core/detect`\n\n  A browser detection helper for accessing prefix-free versions of the various\n  WebRTC types.\n\n  ### Example Usage\n\n  If you wanted to get the native `RTCPeerConnection` prototype in any browser\n  you could do the following:\n\n  ```js\n  var detect = require('rtc-core/detect'); // also available in rtc/detect\n  var RTCPeerConnection = detect('RTCPeerConnection');\n  ```\n\n  This would provide whatever the browser prefixed version of the\n  RTCPeerConnection is available (`webkitRTCPeerConnection`,\n  `mozRTCPeerConnection`, etc).\n**/\nvar detect = module.exports = function(target, opts) {\n  var attach = (opts || {}).attach;\n  var prefixIdx;\n  var prefix;\n  var testName;\n  var hostObject = this || (typeof window != 'undefined' ? window : undefined);\n\n  // initialise to default prefixes\n  // (reverse order as we use a decrementing for loop)\n  var prefixes = ((opts || {}).prefixes || ['ms', 'o', 'moz', 'webkit']).concat('');\n\n  // if we have no host object, then abort\n  if (! hostObject) {\n    return;\n  }\n\n  // iterate through the prefixes and return the class if found in global\n  for (prefixIdx = prefixes.length; prefixIdx--; ) {\n    prefix = prefixes[prefixIdx];\n\n    // construct the test class name\n    // if we have a prefix ensure the target has an uppercase first character\n    // such that a test for getUserMedia would result in a\n    // search for webkitGetUserMedia\n    testName = prefix + (prefix ?\n                            target.charAt(0).toUpperCase() + target.slice(1) :\n                            target);\n\n    if (typeof hostObject[testName] != 'undefined') {\n      // update the last used prefix\n      detect.browser = detect.browser || prefix.toLowerCase();\n\n      if (attach) {\n         hostObject[target] = hostObject[testName];\n      }\n\n      return hostObject[testName];\n    }\n  }\n};\n\n// detect mozilla (yes, this feels dirty)\ndetect.moz = typeof navigator != 'undefined' && !!navigator.mozGetUserMedia;\n\n// set the browser and browser version\ndetect.browser = browser.name;\ndetect.browserVersion = detect.version = browser.version;\n","/**\n  ### `rtc-core/genice`\n\n  Respond appropriately to options that are passed to packages like\n  `rtc-quickconnect` and trigger a `callback` (error first) with iceServer\n  values.\n\n  The function looks for either of the following keys in the options, in\n  the following order or precedence:\n\n  1. `ice` - this can either be an array of ice server values or a generator\n     function (in the same format as this function).  If this key contains a\n     value then any servers specified in the `iceServers` key (2) will be\n     ignored.\n\n  2. `iceServers` - an array of ice server values.\n**/\nmodule.exports = function(opts, callback) {\n  var ice = (opts || {}).ice;\n  var iceServers = (opts || {}).iceServers;\n\n  if (typeof ice == 'function') {\n    return ice(opts, callback);\n  }\n  else if (Array.isArray(ice)) {\n    return callback(null, [].concat(ice));\n  }\n\n  callback(null, [].concat(iceServers || []));\n};\n","var browsers = [\n  [ 'chrome', /Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/ ],\n  [ 'firefox', /Firefox\\/([0-9\\.]+)(?:\\s|$)/ ],\n  [ 'opera', /Opera\\/([0-9\\.]+)(?:\\s|$)/ ],\n  [ 'ie', /Trident\\/7\\.0.*rv\\:([0-9\\.]+)\\).*Gecko$/ ],\n  [ 'ie', /MSIE\\s([0-9\\.]+);.*Trident\\/[4-7].0/ ],\n  [ 'ie', /MSIE\\s(7\\.0)/ ],\n  [ 'bb10', /BB10;\\sTouch.*Version\\/([0-9\\.]+)/ ],\n  [ 'android', /Android\\s([0-9\\.]+)/ ],\n  [ 'ios', /iPad\\;\\sCPU\\sOS\\s([0-9\\._]+)/ ],\n  [ 'ios',  /iPhone\\;\\sCPU\\siPhone\\sOS\\s([0-9\\._]+)/ ],\n  [ 'safari', /Safari\\/([0-9\\._]+)/ ]\n];\n\nvar match = browsers.map(match).filter(isMatch)[0];\nvar parts = match && match[3].split(/[._]/).slice(0,3);\n\nwhile (parts && parts.length < 3) {\n  parts.push('0');\n}\n\n// set the name and version\nexports.name = match && match[0];\nexports.version = parts && parts.join('.');\n\nfunction match(pair) {\n  return pair.concat(pair[1].exec(navigator.userAgent));\n}\n\nfunction isMatch(pair) {\n  return !!pair[2];\n}\n","var detect = require('./detect');\nvar requiredFunctions = [\n  'init'\n];\n\nfunction isSupported(plugin) {\n  return plugin && typeof plugin.supported == 'function' && plugin.supported(detect);\n}\n\nfunction isValid(plugin) {\n  var supportedFunctions = requiredFunctions.filter(function(fn) {\n    return typeof plugin[fn] == 'function';\n  });\n\n  return supportedFunctions.length === requiredFunctions.length;\n}\n\nmodule.exports = function(plugins) {\n  return [].concat(plugins || []).filter(isSupported).filter(isValid)[0];\n}\n","/**\n  # rtc-pluggable-signaller\n\n  By using `rtc-pluggable-signaller` in your code, you provide the ability\n  for your package to customize which signalling client it uses (and\n  thus have significant control) over how signalling operates in your\n  environment.\n\n  ## How it Works\n\n  The pluggable signaller looks in the provided `opts` for a `signaller`\n  attribute.  If the value of this attribute is a string, then it is\n  assumed that you wish to use the default\n  [`rtc-signaller`](https://github.com/rtc-io/rtc-signaller) in your\n  package.  If, however, it is not a string value then it will be passed\n  straight back as the signaller (assuming that you have provided an\n  object that is compliant with the rtc.io signalling API).\n\n**/\nmodule.exports = function(opts) {\n  var signaller = (opts || {}).signaller;\n  var messenger = (opts || {}).messenger || require('rtc-switchboard-messenger');\n\n  if (typeof signaller == 'string' || (signaller instanceof String)) {\n    return require('rtc-signaller')(messenger(signaller, opts), opts);\n  }\n\n  return signaller;\n};\n","/* jshint node: true */\n'use strict';\n\nvar detect = require('rtc-core/detect');\nvar extend = require('cog/extend');\nvar mbus = require('mbus');\nvar getable = require('cog/getable');\nvar uuid = require('cuid');\nvar pull = require('pull-stream');\nvar pushable = require('pull-pushable');\nvar prepare = require('rtc-signal/prepare');\nvar createQueue = require('pull-pushable');\n\n// ready state constants\nvar RS_DISCONNECTED = 0;\nvar RS_CONNECTING = 1;\nvar RS_CONNECTED = 2;\n\n// initialise signaller metadata so we don't have to include the package.json\n// TODO: make this checkable with some kind of prepublish script\nvar metadata = {\n  version: '6.2.1'\n};\n\n/**\n  # rtc-signaller\n\n  The `rtc-signaller` module provides a transportless signalling\n  mechanism for WebRTC.\n\n  ## Purpose\n\n  <<< docs/purpose.md\n\n  ## Getting Started\n\n  While the signaller is capable of communicating by a number of different\n  messengers (i.e. anything that can send and receive messages over a wire)\n  it comes with support for understanding how to connect to an\n  [rtc-switchboard](https://github.com/rtc-io/rtc-switchboard) out of the box.\n\n  The following code sample demonstrates how:\n\n  <<< examples/getting-started.js\n\n  <<< docs/events.md\n\n  <<< docs/signalflow-diagrams.md\n\n  <<< docs/identifying-participants.md\n\n  ## Reference\n\n  The `rtc-signaller` module is designed to be used primarily in a functional\n  way and when called it creates a new signaller that will enable\n  you to communicate with other peers via your messaging network.\n\n  ```js\n  // create a signaller from something that knows how to send messages\n  var signaller = require('rtc-signaller')(messenger);\n  ```\n\n  As demonstrated in the getting started guide, you can also pass through\n  a string value instead of a messenger instance if you simply want to\n  connect to an existing `rtc-switchboard` instance.\n\n**/\nmodule.exports = function(messenger, opts) {\n  var autoconnect = (opts || {}).autoconnect;\n  var reconnect = (opts || {}).reconnect;\n  var queue = createQueue();\n  var connectionCount = 0;\n\n  // create the signaller\n  var signaller = require('rtc-signal/signaller')(opts, bufferMessage);\n\n  var announced = false;\n  var announceTimer = 0;\n  var readyState = RS_DISCONNECTED;\n\n  function bufferMessage(message) {\n    queue.push(message);\n\n    // if we are not connected (and should autoconnect), then attempt connection\n    if (readyState === RS_DISCONNECTED && (autoconnect === undefined || autoconnect)) {\n      connect();\n    }\n  }\n\n  function handleDisconnect() {\n    if (reconnect === undefined || reconnect) {\n      setTimeout(connect, 50);\n    }\n  }\n\n  /**\n    ### `signaller.connect()`\n\n    Manually connect the signaller using the supplied messenger.\n\n    __NOTE:__ This should never have to be called if the default setting\n    for `autoconnect` is used.\n  **/\n  var connect = signaller.connect = function() {\n    // if we are already connecting then do nothing\n    if (readyState === RS_CONNECTING) {\n      return;\n    }\n\n    // initiate the messenger\n    readyState = RS_CONNECTING;\n    messenger(function(err, source, sink) {\n      if (err) {\n        readyState = RS_DISCONNECTED;\n        return signaller('error', err);\n      }\n\n      // increment the connection count\n      connectionCount += 1;\n\n      // flag as connected\n      readyState = RS_CONNECTED;\n\n      // pass messages to the processor\n      pull(\n        source,\n\n        // monitor disconnection\n        pull.through(null, function() {\n          queue = createQueue();\n          readyState = RS_DISCONNECTED;\n          signaller('disconnected');\n        }),\n        pull.drain(signaller._process)\n      );\n\n      // pass the queue to the sink\n      pull(queue, sink);\n\n      // handle disconnection\n      signaller.removeListener('disconnected', handleDisconnect);\n      signaller.on('disconnected', handleDisconnect);\n\n      // trigger the connected event\n      signaller('connected');\n\n      // if this is a reconnection, then reannounce\n      if (announced && connectionCount > 1) {\n        signaller._announce();\n      }\n    });\n  };\n\n  /**\n    ### announce(data?)\n\n    The `announce` function of the signaller will pass an `/announce` message\n    through the messenger network.  When no additional data is supplied to\n    this function then only the id of the signaller is sent to all active\n    members of the messenging network.\n\n    #### Joining Rooms\n\n    To join a room using an announce call you simply provide the name of the\n    room you wish to join as part of the data block that you annouce, for\n    example:\n\n    ```js\n    signaller.announce({ room: 'testroom' });\n    ```\n\n    Signalling servers (such as\n    [rtc-switchboard](https://github.com/rtc-io/rtc-switchboard)) will then\n    place your peer connection into a room with other peers that have also\n    announced in this room.\n\n    Once you have joined a room, the server will only deliver messages that\n    you `send` to other peers within that room.\n\n    #### Providing Additional Announce Data\n\n    There may be instances where you wish to send additional data as part of\n    your announce message in your application.  For instance, maybe you want\n    to send an alias or nick as part of your announce message rather than just\n    use the signaller's generated id.\n\n    If for instance you were writing a simple chat application you could join\n    the `webrtc` room and tell everyone your name with the following announce\n    call:\n\n    ```js\n    signaller.announce({\n      room: 'webrtc',\n      nick: 'Damon'\n    });\n    ```\n\n    #### Announcing Updates\n\n    The signaller is written to distinguish between initial peer announcements\n    and peer data updates (see the docs on the announce handler below). As\n    such it is ok to provide any data updates using the announce method also.\n\n    For instance, I could send a status update as an announce message to flag\n    that I am going offline:\n\n    ```js\n    signaller.announce({ status: 'offline' });\n    ```\n\n  **/\n  signaller.announce = function(data) {\n    announced = true;\n    signaller._update(data);\n    clearTimeout(announceTimer);\n\n    // send the attributes over the network\n    return announceTimer = setTimeout(signaller._announce, (opts || {}).announceDelay || 10);\n  };\n\n  /**\n    ### leave()\n\n    Tell the signalling server we are leaving.  Calling this function is\n    usually not required though as the signalling server should issue correct\n    `/leave` messages when it detects a disconnect event.\n\n  **/\n  signaller.leave = signaller.close = function() {\n    // send the leave signal\n    signaller.send('/leave', { id: signaller.id });\n\n    // stop announcing on reconnect\n    signaller.removeListener('disconnected', handleDisconnect);\n    signaller.removeListener('connected', signaller._announce);\n\n    // end our current queue\n    queue.end();\n\n    // set connected to false\n    readyState = RS_DISCONNECTED;\n  };\n\n  // update the signaller agent\n  signaller._update({ agent: 'signaller@' + metadata.version });\n\n  // autoconnect\n  if (autoconnect === undefined || autoconnect) {\n    connect();\n  }\n\n  return signaller;\n};\n","/**\n * cuid.js\n * Collision-resistant UID generator for browsers and node.\n * Sequential for fast db lookups and recency sorting.\n * Safe for element IDs and server-side lookups.\n *\n * Extracted from CLCTR\n * \n * Copyright (c) Eric Elliott 2012\n * MIT License\n */\n\n/*global window, navigator, document, require, process, module */\n(function (app) {\n  'use strict';\n  var namespace = 'cuid',\n    c = 0,\n    blockSize = 4,\n    base = 36,\n    discreteValues = Math.pow(base, blockSize),\n\n    pad = function pad(num, size) {\n      var s = \"000000000\" + num;\n      return s.substr(s.length-size);\n    },\n\n    randomBlock = function randomBlock() {\n      return pad((Math.random() *\n            discreteValues << 0)\n            .toString(base), blockSize);\n    },\n\n    safeCounter = function () {\n      c = (c < discreteValues) ? c : 0;\n      c++; // this is not subliminal\n      return c - 1;\n    },\n\n    api = function cuid() {\n      // Starting with a lowercase letter makes\n      // it HTML element ID friendly.\n      var letter = 'c', // hard-coded allows for sequential access\n\n        // timestamp\n        // warning: this exposes the exact date and time\n        // that the uid was created.\n        timestamp = (new Date().getTime()).toString(base),\n\n        // Prevent same-machine collisions.\n        counter,\n\n        // A few chars to generate distinct ids for different\n        // clients (so different computers are far less\n        // likely to generate the same id)\n        fingerprint = api.fingerprint(),\n\n        // Grab some more chars from Math.random()\n        random = randomBlock() + randomBlock();\n\n        counter = pad(safeCounter().toString(base), blockSize);\n\n      return  (letter + timestamp + counter + fingerprint + random);\n    };\n\n  api.slug = function slug() {\n    var date = new Date().getTime().toString(36),\n      counter,\n      print = api.fingerprint().slice(0,1) +\n        api.fingerprint().slice(-1),\n      random = randomBlock().slice(-2);\n\n      counter = safeCounter().toString(36).slice(-4);\n\n    return date.slice(-2) + \n      counter + print + random;\n  };\n\n  api.globalCount = function globalCount() {\n    // We want to cache the results of this\n    var cache = (function calc() {\n        var i,\n          count = 0;\n\n        for (i in window) {\n          count++;\n        }\n\n        return count;\n      }());\n\n    api.globalCount = function () { return cache; };\n    return cache;\n  };\n\n  api.fingerprint = function browserPrint() {\n    return pad((navigator.mimeTypes.length +\n      navigator.userAgent.length).toString(36) +\n      api.globalCount().toString(36), 4);\n  };\n\n  // don't change anything from here down.\n  if (app.register) {\n    app.register(namespace, api);\n  } else if (typeof module !== 'undefined') {\n    module.exports = api;\n  } else {\n    app[namespace] = api;\n  }\n\n}(this.applitude || this));\n","var pull = require('pull-stream')\n\nmodule.exports = pull.Source(function (onClose) {\n  var buffer = [], cbs = [], waiting = [], ended\n\n  function drain() {\n    var l\n    while(waiting.length && ((l = buffer.length) || ended)) {\n      var data = buffer.shift()\n      var cb   = cbs.shift()\n      waiting.shift()(l ? null : ended, data)\n      cb && cb(ended === true ? null : ended)\n    }\n  }\n\n  function read (end, cb) {\n    ended = ended || end\n    waiting.push(cb)\n    drain()\n    if(ended)\n      onClose && onClose(ended === true ? null : ended)\n  }\n\n  read.push = function (data, cb) {\n    if(ended)\n      return cb && cb(ended === true ? null : ended)\n    buffer.push(data); cbs.push(cb)\n    drain()\n  }\n\n  read.end = function (end, cb) {\n    if('function' === typeof end)\n      cb = end, end = true\n    ended = ended || end || true;\n    if(cb) cbs.push(cb)\n    drain()\n    if(ended)\n      onClose && onClose(ended === true ? null : ended)\n  }\n\n  return read\n})\n\n","\nvar sources  = require('./sources')\nvar sinks    = require('./sinks')\nvar throughs = require('./throughs')\nvar u        = require('pull-core')\n\nfor(var k in sources)\n  exports[k] = u.Source(sources[k])\n\nfor(var k in throughs)\n  exports[k] = u.Through(throughs[k])\n\nfor(var k in sinks)\n  exports[k] = u.Sink(sinks[k])\n\nvar maybe = require('./maybe')(exports)\n\nfor(var k in maybe)\n  exports[k] = maybe[k]\n\nexports.Duplex  = \nexports.Through = exports.pipeable       = u.Through\nexports.Source  = exports.pipeableSource = u.Source\nexports.Sink    = exports.pipeableSink   = u.Sink\n\n\n","var u = require('pull-core')\nvar prop = u.prop\nvar id   = u.id\nvar maybeSink = u.maybeSink\n\nmodule.exports = function (pull) {\n\n  var exports = {}\n  var drain = pull.drain\n\n  var find = \n  exports.find = function (test, cb) {\n    return maybeSink(function (cb) {\n      var ended = false\n      if(!cb)\n        cb = test, test = id\n      else\n        test = prop(test) || id\n\n      return drain(function (data) {\n        if(test(data)) {\n          ended = true\n          cb(null, data)\n        return false\n        }\n      }, function (err) {\n        if(ended) return //already called back\n        cb(err === true ? null : err, null)\n      })\n\n    }, cb)\n  }\n\n  var reduce = exports.reduce = \n  function (reduce, acc, cb) {\n    \n    return maybeSink(function (cb) {\n      return drain(function (data) {\n        acc = reduce(acc, data)\n      }, function (err) {\n        cb(err, acc)\n      })\n\n    }, cb)\n  }\n\n  var collect = exports.collect = exports.writeArray =\n  function (cb) {\n    return reduce(function (arr, item) {\n      arr.push(item)\n      return arr\n    }, [], cb)\n  }\n\n  return exports\n}\n","exports.id = \nfunction (item) {\n  return item\n}\n\nexports.prop = \nfunction (map) {  \n  if('string' == typeof map) {\n    var key = map\n    return function (data) { return data[key] }\n  }\n  return map\n}\n\nexports.tester = function (test) {\n  if(!test) return exports.id\n  if('object' === typeof test\n    && 'function' === typeof test.test)\n      return test.test.bind(test)\n  return exports.prop(test) || exports.id\n}\n\nexports.addPipe = addPipe\n\nfunction addPipe(read) {\n  if('function' !== typeof read)\n    return read\n\n  read.pipe = read.pipe || function (reader) {\n    if('function' != typeof reader)\n      throw new Error('must pipe to reader')\n    return addPipe(reader(read))\n  }\n  read.type = 'Source'\n  return read\n}\n\nvar Source =\nexports.Source =\nfunction Source (createRead) {\n  function s() {\n    var args = [].slice.call(arguments)\n    return addPipe(createRead.apply(null, args))\n  }\n  s.type = 'Source'\n  return s\n}\n\n\nvar Through =\nexports.Through = \nfunction (createRead) {\n  return function () {\n    var args = [].slice.call(arguments)\n    var piped = []\n    function reader (read) {\n      args.unshift(read)\n      read = createRead.apply(null, args)\n      while(piped.length)\n        read = piped.shift()(read)\n      return read\n      //pipeing to from this reader should compose...\n    }\n    reader.pipe = function (read) {\n      piped.push(read) \n      if(read.type === 'Source')\n        throw new Error('cannot pipe ' + reader.type + ' to Source')\n      reader.type = read.type === 'Sink' ? 'Sink' : 'Through'\n      return reader\n    }\n    reader.type = 'Through'\n    return reader\n  }\n}\n\nvar Sink =\nexports.Sink = \nfunction Sink(createReader) {\n  return function () {\n    var args = [].slice.call(arguments)\n    if(!createReader)\n      throw new Error('must be createReader function')\n    function s (read) {\n      args.unshift(read)\n      return createReader.apply(null, args)\n    }\n    s.type = 'Sink'\n    return s\n  }\n}\n\n\nexports.maybeSink = \nexports.maybeDrain = \nfunction (createSink, cb) {\n  if(!cb)\n    return Through(function (read) {\n      var ended\n      return function (close, cb) {\n        if(close) return read(close, cb)\n        if(ended) return cb(ended)\n\n        createSink(function (err, data) {\n          ended = err || true\n          if(!err) cb(null, data)\n          else     cb(ended)\n        }) (read)\n      }\n    })()\n\n  return Sink(function (read) {\n    return createSink(cb) (read)\n  })()\n}\n\n","var drain = exports.drain = function (read, op, done) {\n\n  ;(function next() {\n    var loop = true, cbed = false\n    while(loop) {\n      cbed = false\n      read(null, function (end, data) {\n        cbed = true\n        if(end) {\n          loop = false\n          done && done(end === true ? null : end)\n        }\n        else if(op && false === op(data)) {\n          loop = false\n          read(true, done || function () {})\n        }\n        else if(!loop){\n          next()\n        }\n      })\n      if(!cbed) {\n        loop = false\n        return\n      }\n    }\n  })()\n}\n\nvar onEnd = exports.onEnd = function (read, done) {\n  return drain(read, null, done)\n}\n\nvar log = exports.log = function (read, done) {\n  return drain(read, function (data) {\n    console.log(data)\n  }, done)\n}\n\n","\nvar keys = exports.keys =\nfunction (object) {\n  return values(Object.keys(object))\n}\n\nvar once = exports.once =\nfunction (value) {\n  return function (abort, cb) {\n    if(abort) return cb(abort)\n    if(value != null) {\n      var _value = value; value = null\n      cb(null, _value)\n    } else\n      cb(true)\n  }\n}\n\nvar values = exports.values = exports.readArray =\nfunction (array) {\n  if(!Array.isArray(array))\n    array = Object.keys(array).map(function (k) {\n      return array[k]\n    })\n  var i = 0\n  return function (end, cb) {\n    if(end)\n      return cb && cb(end)  \n    cb(i >= array.length || null, array[i++])\n  }\n}\n\n\nvar count = exports.count = \nfunction (max) {\n  var i = 0; max = max || Infinity\n  return function (end, cb) {\n    if(end) return cb && cb(end)\n    if(i > max)\n      return cb(true)\n    cb(null, i++)\n  }\n}\n\nvar infinite = exports.infinite = \nfunction (generate) {\n  generate = generate || Math.random\n  return function (end, cb) {\n    if(end) return cb && cb(end)\n    return cb(null, generate())\n  }\n}\n\nvar defer = exports.defer = function () {\n  var _read, cbs = [], _end\n\n  var read = function (end, cb) {\n    if(!_read) {\n      _end = end\n      cbs.push(cb)\n    } \n    else _read(end, cb)\n  }\n  read.resolve = function (read) {\n    if(_read) throw new Error('already resolved')\n    _read = read\n    if(!_read) throw new Error('no read cannot resolve!' + _read)\n    while(cbs.length)\n      _read(_end, cbs.shift())\n  }\n  read.abort = function(err) {\n    read.resolve(function (_, cb) {\n      cb(err || true)\n    })\n  }\n  return read\n}\n\nvar empty = exports.empty = function () {\n  return function (abort, cb) {\n    cb(true)\n  }\n}\n\nvar depthFirst = exports.depthFirst =\nfunction (start, createStream) {\n  var reads = []\n\n  reads.unshift(once(start))\n\n  return function next (end, cb) {\n    if(!reads.length)\n      return cb(true)\n    reads[0](end, function (end, data) {\n      if(end) {\n        //if this stream has ended, go to the next queue\n        reads.shift()\n        return next(null, cb)\n      }\n      reads.unshift(createStream(data))\n      cb(end, data)\n    })\n  }\n}\n//width first is just like depth first,\n//but push each new stream onto the end of the queue\nvar widthFirst = exports.widthFirst = \nfunction (start, createStream) {\n  var reads = []\n\n  reads.push(once(start))\n\n  return function next (end, cb) {\n    if(!reads.length)\n      return cb(true)\n    reads[0](end, function (end, data) {\n      if(end) {\n        reads.shift()\n        return next(null, cb)\n      }\n      reads.push(createStream(data))\n      cb(end, data)\n    })\n  }\n}\n\n//this came out different to the first (strm)\n//attempt at leafFirst, but it's still a valid\n//topological sort.\nvar leafFirst = exports.leafFirst = \nfunction (start, createStream) {\n  var reads = []\n  var output = []\n  reads.push(once(start))\n  \n  return function next (end, cb) {\n    reads[0](end, function (end, data) {\n      if(end) {\n        reads.shift()\n        if(!output.length)\n          return cb(true)\n        return cb(null, output.shift())\n      }\n      reads.unshift(createStream(data))\n      output.unshift(data)\n      next(null, cb)\n    })\n  }\n}\n\n","var u      = require('pull-core')\nvar sources = require('./sources')\nvar sinks = require('./sinks')\n\nvar prop   = u.prop\nvar id     = u.id\nvar tester = u.tester\n\nvar map = exports.map = \nfunction (read, map) {\n  map = prop(map) || id\n  return function (end, cb) {\n    read(end, function (end, data) {\n      var data = !end ? map(data) : null\n      cb(end, data)\n    })\n  }\n}\n\nvar asyncMap = exports.asyncMap =\nfunction (read, map) {\n  if(!map) return read\n  return function (end, cb) {\n    if(end) return read(end, cb) //abort\n    read(null, function (end, data) {\n      if(end) return cb(end, data)\n      map(data, cb)\n    })\n  }\n}\n\nvar paraMap = exports.paraMap =\nfunction (read, map, width) {\n  if(!map) return read\n  var ended = false, queue = [], _cb\n\n  function drain () {\n    if(!_cb) return\n    var cb = _cb\n    _cb = null\n    if(queue.length)\n      return cb(null, queue.shift())\n    else if(ended && !n)\n      return cb(ended)\n    _cb = cb\n  }\n\n  function pull () {\n    read(null, function (end, data) {\n      if(end) {\n        ended = end\n        return drain()\n      }\n      n++\n      map(data, function (err, data) {\n        n--\n\n        queue.push(data)\n        drain()\n      })\n\n      if(n < width && !ended)\n        pull()\n    })\n  }\n\n  var n = 0\n  return function (end, cb) {\n    if(end) return read(end, cb) //abort\n    //continue to read while there are less than 3 maps in flight\n    _cb = cb\n    if(queue.length || ended)\n      pull(), drain()\n    else pull()\n  }\n  return highWaterMark(asyncMap(read, map), width)\n}\n\nvar filter = exports.filter =\nfunction (read, test) {\n  //regexp\n  test = tester(test)\n  return function next (end, cb) {\n    read(end, function (end, data) {\n      if(!end && !test(data))\n        return next(end, cb)\n      cb(end, data)\n    })\n  }\n}\n\nvar filterNot = exports.filterNot =\nfunction (read, test) {\n  test = tester(test)\n  return filter(read, function (e) {\n    return !test(e)\n  })\n}\n\nvar through = exports.through = \nfunction (read, op, onEnd) {\n  var a = false\n  function once (abort) {\n    if(a || !onEnd) return\n    a = true\n    onEnd(abort === true ? null : abort)\n  }\n\n  return function (end, cb) {\n    if(end) once(end)\n    return read(end, function (end, data) {\n      if(!end) op && op(data)\n      else once(end)\n      cb(end, data)\n    })\n  }\n}\n\nvar take = exports.take =\nfunction (read, test) {\n  var ended = false\n  if('number' === typeof test) {\n    var n = test; test = function () {\n      return n --\n    }\n  }\n\n  return function (end, cb) {\n    if(ended) return cb(ended)\n    if(ended = end) return read(ended, cb)\n\n    read(null, function (end, data) {\n      if(ended = ended || end) return cb(ended)\n      if(!test(data)) {\n        ended = true\n        read(true, function (end, data) {\n          cb(ended, data)\n        })\n      }\n      else\n        cb(null, data)\n    })\n  }\n}\n\nvar unique = exports.unique = function (read, field, invert) {\n  field = prop(field) || id\n  var seen = {}\n  return filter(read, function (data) {\n    var key = field(data)\n    if(seen[key]) return !!invert //false, by default\n    else seen[key] = true\n    return !invert //true by default\n  })\n}\n\nvar nonUnique = exports.nonUnique = function (read, field) {\n  return unique(read, field, true)\n}\n\nvar group = exports.group =\nfunction (read, size) {\n  var ended; size = size || 5\n  var queue = []\n\n  return function (end, cb) {\n    //this means that the upstream is sending an error.\n    if(end) return read(ended = end, cb)\n    //this means that we read an end before.\n    if(ended) return cb(ended)\n\n    read(null, function next(end, data) {\n      if(ended = ended || end) {\n        if(!queue.length)\n          return cb(ended)\n\n        var _queue = queue; queue = []\n        return cb(null, _queue)\n      }\n      queue.push(data)\n      if(queue.length < size)\n        return read(null, next)\n\n      var _queue = queue; queue = []\n      cb(null, _queue)\n    })\n  }\n}\n\nvar flatten = exports.flatten = function (read) {\n  var _read\n  return function (abort, cb) {\n    if(_read) nextChunk()\n    else      nextStream()\n\n    function nextChunk () {\n      _read(null, function (end, data) {\n        if(end) nextStream()\n        else    cb(null, data)\n      })\n    }\n    function nextStream () {\n      read(null, function (end, stream) {\n        if(end)\n          return cb(end)\n        if(Array.isArray(stream))\n          stream = sources.values(stream)\n        else if('function' != typeof stream)\n          throw new Error('expected stream of streams')\n        \n        _read = stream\n        nextChunk()\n      })\n    }\n  }\n}\n\nvar prepend =\nexports.prepend =\nfunction (read, head) {\n\n  return function (abort, cb) {\n    if(head !== null) {\n      if(abort)\n        return read(abort, cb)\n      var _head = head\n      head = null\n      cb(null, _head)\n    } else {\n      read(abort, cb)\n    }\n  }\n\n}\n\n//var drainIf = exports.drainIf = function (op, done) {\n//  sinks.drain(\n//}\n\nvar _reduce = exports._reduce = function (read, reduce, initial) {\n  return function (close, cb) {\n    if(close) return read(close, cb)\n    if(ended) return cb(ended)\n\n    sinks.drain(function (item) {\n      initial = reduce(initial, item)\n    }, function (err, data) {\n      ended = err || true\n      if(!err) cb(null, initial)\n      else     cb(ended)\n    })\n    (read)\n  }\n}\n\nvar nextTick = process.nextTick\n\nvar highWaterMark = exports.highWaterMark = \nfunction (read, highWaterMark) {\n  var buffer = [], waiting = [], ended, reading = false\n  highWaterMark = highWaterMark || 10\n\n  function readAhead () {\n    while(waiting.length && (buffer.length || ended))\n      waiting.shift()(ended, ended ? null : buffer.shift())\n  }\n\n  function next () {\n    if(ended || reading || buffer.length >= highWaterMark)\n      return\n    reading = true\n    return read(ended, function (end, data) {\n      reading = false\n      ended = ended || end\n      if(data != null) buffer.push(data)\n      \n      next(); readAhead()\n    })\n  }\n\n  nextTick(next)\n\n  return function (end, cb) {\n    ended = ended || end\n    waiting.push(cb)\n\n    next(); readAhead()\n  }\n}\n\n\n\n","var sources  = require('./sources')\nvar sinks    = require('./sinks')\nvar throughs = require('./throughs')\nvar u        = require('pull-core')\n\nfunction isFunction (fun) {\n  return 'function' === typeof fun\n}\n\nfunction isReader (fun) {\n  return fun && (fun.type === \"Through\" || fun.length === 1)\n}\nvar exports = module.exports = function pull () {\n  var args = [].slice.call(arguments)\n\n  if(isReader(args[0]))\n    return function (read) {\n      args.unshift(read)\n      return pull.apply(null, args)\n    }\n\n  var read = args.shift()\n\n  //if the first function is a duplex stream,\n  //pipe from the source.\n  if(isFunction(read.source))\n    read = read.source\n\n  function next () {\n    var s = args.shift()\n\n    if(null == s)\n      return next()\n\n    if(isFunction(s)) return s\n\n    return function (read) {\n      s.sink(read)\n      //this supports pipeing through a duplex stream\n      //pull(a, b, a) \"telephone style\".\n      //if this stream is in the a (first & last position)\n      //s.source will have already been used, but this should never be called\n      //so that is okay.\n      return s.source\n    }\n  }\n\n  while(args.length)\n    read = next() (read)\n\n  return read\n}\n\n\nfor(var k in sources)\n  exports[k] = u.Source(sources[k])\n\nfor(var k in throughs)\n  exports[k] = u.Through(throughs[k])\n\nfor(var k in sinks)\n  exports[k] = u.Sink(sinks[k])\n\nvar maybe = require('./maybe')(exports)\n\nfor(var k in maybe)\n  exports[k] = maybe[k]\n\nexports.Duplex  = \nexports.Through = exports.pipeable       = u.Through\nexports.Source  = exports.pipeableSource = u.Source\nexports.Sink    = exports.pipeableSink   = u.Sink\n\n\n","var u = require('pull-core')\nvar prop = u.prop\nvar id   = u.id\nvar maybeSink = u.maybeSink\n\nmodule.exports = function (pull) {\n\n  var exports = {}\n  var drain = pull.drain\n\n  var find =\n  exports.find = function (test, cb) {\n    return maybeSink(function (cb) {\n      var ended = false\n      if(!cb)\n        cb = test, test = id\n      else\n        test = prop(test) || id\n\n      return drain(function (data) {\n        if(test(data)) {\n          ended = true\n          cb(null, data)\n        return false\n        }\n      }, function (err) {\n        if(ended) return //already called back\n        cb(err === true ? null : err, null)\n      })\n\n    }, cb)\n  }\n\n  var reduce = exports.reduce =\n  function (reduce, acc, cb) {\n\n    return maybeSink(function (cb) {\n      return drain(function (data) {\n        acc = reduce(acc, data)\n      }, function (err) {\n        cb(err, acc)\n      })\n\n    }, cb)\n  }\n\n  var collect = exports.collect = exports.writeArray =\n  function (cb) {\n    return reduce(function (arr, item) {\n      arr.push(item)\n      return arr\n    }, [], cb)\n  }\n\n  var concat = exports.concat =\n  function (cb) {\n    return reduce(function (a, b) {\n      return a + b\n    }, '', cb)\n  }\n\n  return exports\n}\n","exports.id = \nfunction (item) {\n  return item\n}\n\nexports.prop = \nfunction (map) {  \n  if('string' == typeof map) {\n    var key = map\n    return function (data) { return data[key] }\n  }\n  return map\n}\n\nexports.tester = function (test) {\n  if(!test) return exports.id\n  if('object' === typeof test\n    && 'function' === typeof test.test)\n      return test.test.bind(test)\n  return exports.prop(test) || exports.id\n}\n\nexports.addPipe = addPipe\n\nfunction addPipe(read) {\n  if('function' !== typeof read)\n    return read\n\n  read.pipe = read.pipe || function (reader) {\n    if('function' != typeof reader && 'function' != typeof reader.sink)\n      throw new Error('must pipe to reader')\n    var pipe = addPipe(reader.sink ? reader.sink(read) : reader(read))\n    return reader.source || pipe;\n  }\n  \n  read.type = 'Source'\n  return read\n}\n\nvar Source =\nexports.Source =\nfunction Source (createRead) {\n  function s() {\n    var args = [].slice.call(arguments)\n    return addPipe(createRead.apply(null, args))\n  }\n  s.type = 'Source'\n  return s\n}\n\n\nvar Through =\nexports.Through = \nfunction (createRead) {\n  return function () {\n    var args = [].slice.call(arguments)\n    var piped = []\n    function reader (read) {\n      args.unshift(read)\n      read = createRead.apply(null, args)\n      while(piped.length)\n        read = piped.shift()(read)\n      return read\n      //pipeing to from this reader should compose...\n    }\n    reader.pipe = function (read) {\n      piped.push(read) \n      if(read.type === 'Source')\n        throw new Error('cannot pipe ' + reader.type + ' to Source')\n      reader.type = read.type === 'Sink' ? 'Sink' : 'Through'\n      return reader\n    }\n    reader.type = 'Through'\n    return reader\n  }\n}\n\nvar Sink =\nexports.Sink = \nfunction Sink(createReader) {\n  return function () {\n    var args = [].slice.call(arguments)\n    if(!createReader)\n      throw new Error('must be createReader function')\n    function s (read) {\n      args.unshift(read)\n      return createReader.apply(null, args)\n    }\n    s.type = 'Sink'\n    return s\n  }\n}\n\n\nexports.maybeSink = \nexports.maybeDrain = \nfunction (createSink, cb) {\n  if(!cb)\n    return Through(function (read) {\n      var ended\n      return function (close, cb) {\n        if(close) return read(close, cb)\n        if(ended) return cb(ended)\n\n        createSink(function (err, data) {\n          ended = err || true\n          if(!err) cb(null, data)\n          else     cb(ended)\n        }) (read)\n      }\n    })()\n\n  return Sink(function (read) {\n    return createSink(cb) (read)\n  })()\n}\n\n","var drain = exports.drain = function (read, op, done) {\n\n  ;(function next() {\n    var loop = true, cbed = false\n    while(loop) {\n      cbed = false\n      read(null, function (end, data) {\n        cbed = true\n        if(end) {\n          loop = false\n          if(done) done(end === true ? null : end)\n          else if(end && end !== true)\n            throw end\n        }\n        else if(op && false === op(data)) {\n          loop = false\n          read(true, done || function () {})\n        }\n        else if(!loop){\n          next()\n        }\n      })\n      if(!cbed) {\n        loop = false\n        return\n      }\n    }\n  })()\n}\n\nvar onEnd = exports.onEnd = function (read, done) {\n  return drain(read, null, done)\n}\n\nvar log = exports.log = function (read, done) {\n  return drain(read, function (data) {\n    console.log(data)\n  }, done)\n}\n\n","\nvar keys = exports.keys =\nfunction (object) {\n  return values(Object.keys(object))\n}\n\nfunction abortCb(cb, abort, onAbort) {\n  cb(abort)\n  onAbort && onAbort(abort === true ? null: abort)\n  return\n}\n\nvar once = exports.once =\nfunction (value, onAbort) {\n  return function (abort, cb) {\n    if(abort)\n      return abortCb(cb, abort, onAbort)\n    if(value != null) {\n      var _value = value; value = null\n      cb(null, _value)\n    } else\n      cb(true)\n  }\n}\n\nvar values = exports.values = exports.readArray =\nfunction (array, onAbort) {\n  if(!array)\n    return function (abort, cb) {\n      if(abort) return abortCb(cb, abort, onAbort)\n      return cb(true)\n    }\n  if(!Array.isArray(array))\n    array = Object.keys(array).map(function (k) {\n      return array[k]\n    })\n  var i = 0\n  return function (abort, cb) {\n    if(abort)\n      return abortCb(cb, abort, onAbort)\n    cb(i >= array.length || null, array[i++])\n  }\n}\n\n\nvar count = exports.count =\nfunction (max) {\n  var i = 0; max = max || Infinity\n  return function (end, cb) {\n    if(end) return cb && cb(end)\n    if(i > max)\n      return cb(true)\n    cb(null, i++)\n  }\n}\n\nvar infinite = exports.infinite =\nfunction (generate) {\n  generate = generate || Math.random\n  return function (end, cb) {\n    if(end) return cb && cb(end)\n    return cb(null, generate())\n  }\n}\n\nvar defer = exports.defer = function () {\n  var _read, cbs = [], _end\n\n  var read = function (end, cb) {\n    if(!_read) {\n      _end = end\n      cbs.push(cb)\n    } \n    else _read(end, cb)\n  }\n  read.resolve = function (read) {\n    if(_read) throw new Error('already resolved')\n    _read = read\n    if(!_read) throw new Error('no read cannot resolve!' + _read)\n    while(cbs.length)\n      _read(_end, cbs.shift())\n  }\n  read.abort = function(err) {\n    read.resolve(function (_, cb) {\n      cb(err || true)\n    })\n  }\n  return read\n}\n\nvar empty = exports.empty = function () {\n  return function (abort, cb) {\n    cb(true)\n  }\n}\n\nvar error = exports.error = function (err) {\n  return function (abort, cb) {\n    cb(err)\n  }\n}\n\nvar depthFirst = exports.depthFirst =\nfunction (start, createStream) {\n  var reads = []\n\n  reads.unshift(once(start))\n\n  return function next (end, cb) {\n    if(!reads.length)\n      return cb(true)\n    reads[0](end, function (end, data) {\n      if(end) {\n        //if this stream has ended, go to the next queue\n        reads.shift()\n        return next(null, cb)\n      }\n      reads.unshift(createStream(data))\n      cb(end, data)\n    })\n  }\n}\n//width first is just like depth first,\n//but push each new stream onto the end of the queue\nvar widthFirst = exports.widthFirst =\nfunction (start, createStream) {\n  var reads = []\n\n  reads.push(once(start))\n\n  return function next (end, cb) {\n    if(!reads.length)\n      return cb(true)\n    reads[0](end, function (end, data) {\n      if(end) {\n        reads.shift()\n        return next(null, cb)\n      }\n      reads.push(createStream(data))\n      cb(end, data)\n    })\n  }\n}\n\n//this came out different to the first (strm)\n//attempt at leafFirst, but it's still a valid\n//topological sort.\nvar leafFirst = exports.leafFirst =\nfunction (start, createStream) {\n  var reads = []\n  var output = []\n  reads.push(once(start))\n\n  return function next (end, cb) {\n    reads[0](end, function (end, data) {\n      if(end) {\n        reads.shift()\n        if(!output.length)\n          return cb(true)\n        return cb(null, output.shift())\n      }\n      reads.unshift(createStream(data))\n      output.unshift(data)\n      next(null, cb)\n    })\n  }\n}\n\n","var u      = require('pull-core')\nvar sources = require('./sources')\nvar sinks = require('./sinks')\n\nvar prop   = u.prop\nvar id     = u.id\nvar tester = u.tester\n\nvar map = exports.map =\nfunction (read, map) {\n  map = prop(map) || id\n  return function (abort, cb) {\n    read(abort, function (end, data) {\n      try {\n      data = !end ? map(data) : null\n      } catch (err) {\n        return read(err, function () {\n          return cb(err)\n        })\n      }\n      cb(end, data)\n    })\n  }\n}\n\nvar asyncMap = exports.asyncMap =\nfunction (read, map) {\n  if(!map) return read\n  return function (end, cb) {\n    if(end) return read(end, cb) //abort\n    read(null, function (end, data) {\n      if(end) return cb(end, data)\n      map(data, cb)\n    })\n  }\n}\n\nvar paraMap = exports.paraMap =\nfunction (read, map, width) {\n  if(!map) return read\n  var ended = false, queue = [], _cb\n\n  function drain () {\n    if(!_cb) return\n    var cb = _cb\n    _cb = null\n    if(queue.length)\n      return cb(null, queue.shift())\n    else if(ended && !n)\n      return cb(ended)\n    _cb = cb\n  }\n\n  function pull () {\n    read(null, function (end, data) {\n      if(end) {\n        ended = end\n        return drain()\n      }\n      n++\n      map(data, function (err, data) {\n        n--\n\n        queue.push(data)\n        drain()\n      })\n\n      if(n < width && !ended)\n        pull()\n    })\n  }\n\n  var n = 0\n  return function (end, cb) {\n    if(end) return read(end, cb) //abort\n    //continue to read while there are less than 3 maps in flight\n    _cb = cb\n    if(queue.length || ended)\n      pull(), drain()\n    else pull()\n  }\n  return highWaterMark(asyncMap(read, map), width)\n}\n\nvar filter = exports.filter =\nfunction (read, test) {\n  //regexp\n  test = tester(test)\n  return function next (end, cb) {\n    var sync, loop = true\n    while(loop) {\n      loop = false\n      sync = true\n      read(end, function (end, data) {\n        if(!end && !test(data))\n          return sync ? loop = true : next(end, cb)\n        cb(end, data)\n      })\n      sync = false\n    }\n  }\n}\n\nvar filterNot = exports.filterNot =\nfunction (read, test) {\n  test = tester(test)\n  return filter(read, function (e) {\n    return !test(e)\n  })\n}\n\nvar through = exports.through =\nfunction (read, op, onEnd) {\n  var a = false\n  function once (abort) {\n    if(a || !onEnd) return\n    a = true\n    onEnd(abort === true ? null : abort)\n  }\n\n  return function (end, cb) {\n    if(end) once(end)\n    return read(end, function (end, data) {\n      if(!end) op && op(data)\n      else once(end)\n      cb(end, data)\n    })\n  }\n}\n\nvar take = exports.take =\nfunction (read, test) {\n  var ended = false\n  if('number' === typeof test) {\n    var n = test; test = function () {\n      return n --\n    }\n  }\n\n  return function (end, cb) {\n    if(ended) return cb(ended)\n    if(ended = end) return read(ended, cb)\n\n    read(null, function (end, data) {\n      if(ended = ended || end) return cb(ended)\n      if(!test(data)) {\n        ended = true\n        read(true, function (end, data) {\n          cb(ended, data)\n        })\n      }\n      else\n        cb(null, data)\n    })\n  }\n}\n\nvar unique = exports.unique = function (read, field, invert) {\n  field = prop(field) || id\n  var seen = {}\n  return filter(read, function (data) {\n    var key = field(data)\n    if(seen[key]) return !!invert //false, by default\n    else seen[key] = true\n    return !invert //true by default\n  })\n}\n\nvar nonUnique = exports.nonUnique = function (read, field) {\n  return unique(read, field, true)\n}\n\nvar group = exports.group =\nfunction (read, size) {\n  var ended; size = size || 5\n  var queue = []\n\n  return function (end, cb) {\n    //this means that the upstream is sending an error.\n    if(end) return read(ended = end, cb)\n    //this means that we read an end before.\n    if(ended) return cb(ended)\n\n    read(null, function next(end, data) {\n      if(ended = ended || end) {\n        if(!queue.length)\n          return cb(ended)\n\n        var _queue = queue; queue = []\n        return cb(null, _queue)\n      }\n      queue.push(data)\n      if(queue.length < size)\n        return read(null, next)\n\n      var _queue = queue; queue = []\n      cb(null, _queue)\n    })\n  }\n}\n\nvar flatten = exports.flatten = function (read) {\n  var _read\n  return function (abort, cb) {\n    if(_read) nextChunk()\n    else      nextStream()\n\n    function nextChunk () {\n      _read(null, function (end, data) {\n        if(end) nextStream()\n        else    cb(null, data)\n      })\n    }\n    function nextStream () {\n      read(null, function (end, stream) {\n        if(end)\n          return cb(end)\n        if(Array.isArray(stream) || stream && 'object' === typeof stream)\n          stream = sources.values(stream)\n        else if('function' != typeof stream)\n          throw new Error('expected stream of streams')\n        _read = stream\n        nextChunk()\n      })\n    }\n  }\n}\n\nvar prepend =\nexports.prepend =\nfunction (read, head) {\n\n  return function (abort, cb) {\n    if(head !== null) {\n      if(abort)\n        return read(abort, cb)\n      var _head = head\n      head = null\n      cb(null, _head)\n    } else {\n      read(abort, cb)\n    }\n  }\n\n}\n\n//var drainIf = exports.drainIf = function (op, done) {\n//  sinks.drain(\n//}\n\nvar _reduce = exports._reduce = function (read, reduce, initial) {\n  return function (close, cb) {\n    if(close) return read(close, cb)\n    if(ended) return cb(ended)\n\n    sinks.drain(function (item) {\n      initial = reduce(initial, item)\n    }, function (err, data) {\n      ended = err || true\n      if(!err) cb(null, initial)\n      else     cb(ended)\n    })\n    (read)\n  }\n}\n\nvar nextTick = process.nextTick\n\nvar highWaterMark = exports.highWaterMark =\nfunction (read, highWaterMark) {\n  var buffer = [], waiting = [], ended, ending, reading = false\n  highWaterMark = highWaterMark || 10\n\n  function readAhead () {\n    while(waiting.length && (buffer.length || ended))\n      waiting.shift()(ended, ended ? null : buffer.shift())\n\n    if (!buffer.length && ending) ended = ending;\n  }\n\n  function next () {\n    if(ended || ending || reading || buffer.length >= highWaterMark)\n      return\n    reading = true\n    return read(ended || ending, function (end, data) {\n      reading = false\n      ending = ending || end\n      if(data != null) buffer.push(data)\n\n      next(); readAhead()\n    })\n  }\n\n  process.nextTick(next)\n\n  return function (end, cb) {\n    ended = ended || end\n    waiting.push(cb)\n\n    next(); readAhead()\n  }\n}\n\nvar flatMap = exports.flatMap =\nfunction (read, mapper) {\n  mapper = mapper || id\n  var queue = [], ended\n\n  return function (abort, cb) {\n    if(queue.length) return cb(null, queue.shift())\n    else if(ended)   return cb(ended)\n\n    read(abort, function next (end, data) {\n      if(end) ended = end\n      else {\n        var add = mapper(data)\n        while(add && add.length)\n          queue.push(add.shift())\n      }\n\n      if(queue.length) cb(null, queue.shift())\n      else if(ended)   cb(ended)\n      else             read(null, next)\n    })\n  }\n}\n\n","var extend = require('cog/extend');\n\nmodule.exports = function(signaller) {\n\n  function dataAllowed(data) {\n    var cloned = extend({ allow: true }, data);\n    signaller('peer:filter', data.id, cloned);\n\n    return cloned.allow;\n  }\n\n  return function(args, messageType, srcData, srcState, isDM) {\n    var data = args[0];\n    var peer;\n\n    // if we have valid data then process\n    if (data && data.id && data.id !== signaller.id) {\n      if (! dataAllowed(data)) {\n        return;\n      }\n      // check to see if this is a known peer\n      peer = signaller.peers.get(data.id);\n\n      // trigger the peer connected event to flag that we know about a\n      // peer connection. The peer has passed the \"filter\" check but may\n      // be announced / updated depending on previous connection status\n      signaller('peer:connected', data.id, data);\n\n      // if the peer is existing, then update the data\n      if (peer) {\n        // update the data\n        extend(peer.data, data);\n\n        // trigger the peer update event\n        return signaller('peer:update', data, srcData);\n      }\n\n      // create a new peer\n      peer = {\n        id: data.id,\n\n        // initialise the local role index\n        roleIdx: [data.id, signaller.id].sort().indexOf(data.id),\n\n        // initialise the peer data\n        data: {}\n      };\n\n      // initialise the peer data\n      extend(peer.data, data);\n\n      // set the peer data\n      signaller.peers.set(data.id, peer);\n\n      // if this is an initial announce message (no vector clock attached)\n      // then send a announce reply\n      if (signaller.autoreply && (! isDM)) {\n        signaller\n          .to(data.id)\n          .send('/announce', signaller.attributes);\n      }\n\n      // emit a new peer announce event\n      return signaller('peer:announce', data, peer);\n    }\n  };\n};\n","/**\n  ### prepare\n\n  ```\n  fn(args) => String\n  ```\n\n  Convert an array of values into a pipe-delimited string.\n\n**/\nmodule.exports = function(args) {\n  return args.map(prepareArg).join('|');\n};\n\nfunction prepareArg(arg) {\n  if (typeof arg == 'object' && (! (arg instanceof String))) {\n    return JSON.stringify(arg);\n  }\n  else if (typeof arg == 'function') {\n    return null;\n  }\n\n  return arg;\n}\n","var jsonparse = require('cog/jsonparse');\n\n/**\n  ### process\n\n  ```\n  fn(signaller, opts) => fn(message)\n  ```\n\n  The core processing logic that is used to respond to incoming signaling\n  messages.\n\n**/\nmodule.exports = function(signaller, opts) {\n  var handlers = {\n    announce: require('./handlers/announce')(signaller, opts)\n  };\n\n  function sendEvent(parts, srcState, data) {\n    // initialise the event name\n    var evtName = 'message:' + parts[0].slice(1);\n\n    // convert any valid json objects to json\n    var args = parts.slice(2).map(jsonparse);\n\n    signaller.apply(\n      signaller,\n      [evtName].concat(args).concat([srcState, data])\n    );\n  }\n\n  return function(originalData) {\n    var data = originalData;\n    var isMatch = true;\n    var parts;\n    var handler;\n    var srcData;\n    var srcState;\n    var isDirectMessage = false;\n\n    // discard primus messages\n    if (data && data.slice(0, 6) === 'primus') {\n      return;\n    }\n\n    // force the id into string format so we can run length and comparison tests on it\n    var id = signaller.id + '';\n\n    // process /to messages\n    if (data.slice(0, 3) === '/to') {\n      isMatch = data.slice(4, id.length + 4) === id;\n      if (isMatch) {\n        parts = data.slice(5 + id.length).split('|').map(jsonparse);\n\n        // get the source data\n        isDirectMessage = true;\n\n        // extract the vector clock and update the parts\n        parts = parts.map(jsonparse);\n      }\n    }\n\n    // if this is not a match, then bail\n    if (! isMatch) {\n      return;\n    }\n\n    // chop the data into parts\n    signaller('rawdata', data);\n    parts = parts || data.split('|').map(jsonparse);\n\n    // if we have a specific handler for the action, then invoke\n    if (typeof parts[0] == 'string') {\n      // extract the metadata from the input data\n      srcData = parts[1];\n\n      // if we got data from ourself, then this is pretty dumb\n      // but if we have then throw it away\n      if (srcData === signaller.id) {\n        return console.warn('got data from ourself, discarding');\n      }\n\n      // get the source state\n      srcState = signaller.peers.get(srcData) || srcData;\n\n      // handle commands\n      if (parts[0].charAt(0) === '/') {\n        // look for a handler for the message type\n        handler = handlers[parts[0].slice(1)];\n\n        if (typeof handler == 'function') {\n          handler(\n            parts.slice(2),\n            parts[0].slice(1),\n            srcData,\n            srcState,\n            isDirectMessage\n          );\n        }\n        else {\n          sendEvent(parts, srcState, originalData);\n        }\n      }\n      // otherwise, emit data\n      else {\n        signaller(\n          'data',\n          parts.slice(0, 1).concat(parts.slice(2)),\n          srcData,\n          srcState,\n          isDirectMessage\n        );\n      }\n    }\n  };\n};\n","var detect = require('rtc-core/detect');\nvar extend = require('cog/extend');\nvar getable = require('cog/getable');\nvar cuid = require('cuid');\nvar mbus = require('mbus');\nvar prepare = require('./prepare');\n\n/**\n  ## `signaller(opts, bufferMessage) => mbus`\n\n  Create a base level signaller which is capable of processing\n  messages from an incoming source.  The signaller is capable of\n  sending messages outbound using the `bufferMessage` function\n  that is supplied to the signaller.\n\n**/\nmodule.exports = function(opts, bufferMessage) {\n  // get the autoreply setting\n  var autoreply = (opts || {}).autoreply;\n\n  // create the signaller mbus\n  var signaller = mbus('', (opts || {}).logger);\n\n  // initialise the peers\n  var peers = signaller.peers = getable({});\n\n  // initialise the signaller attributes\n  var attributes = signaller.attributes = {\n    browser: detect.browser,\n    browserVersion: detect.browserVersion,\n    agent: 'unknown'\n  };\n\n  function createToMessage(header) {\n    return function() {\n      var args = header.concat([].slice.call(arguments));\n\n      // inject the signaller.id\n      args.splice(3, 0, signaller.id);\n      bufferMessage(prepare(args));\n    }\n  }\n\n  // initialise the signaller id\n  signaller.id = (opts || {}).id || cuid();\n\n  /**\n    #### `isMaster(targetId) => Boolean`\n\n    A simple function that indicates whether the local signaller is the master\n    for it's relationship with peer signaller indicated by `targetId`.  Roles\n    are determined at the point at which signalling peers discover each other,\n    and are simply worked out by whichever peer has the lowest signaller id\n    when lexigraphically sorted.\n\n    For example, if we have two signaller peers that have discovered each\n    others with the following ids:\n\n    - `b11f4fd0-feb5-447c-80c8-c51d8c3cced2`\n    - `8a07f82e-49a5-4b9b-a02e-43d911382be6`\n\n    They would be assigned roles:\n\n    - `b11f4fd0-feb5-447c-80c8-c51d8c3cced2`\n    - `8a07f82e-49a5-4b9b-a02e-43d911382be6` (master)\n\n  **/\n  signaller.isMaster = function(targetId) {\n    var peer = peers.get(targetId);\n\n    return peer && peer.roleIdx !== 0;\n  };\n\n  /**\n    #### `send(args*)`\n\n    Prepare a message for sending, e.g.:\n\n    ```js\n    signaller.send('/foo', 'bar');\n    ```\n\n  **/\n  signaller.send = function() {\n    var args = [].slice.call(arguments);\n\n    // inject the metadata\n    args.splice(1, 0, signaller.id);\n\n    // send the message\n    bufferMessage(prepare(args));\n  };\n\n\n  /**\n    #### `to(targetId)`\n\n    Use the `to` function to send a message to the specified target peer.\n    A large parge of negotiating a WebRTC peer connection involves direct\n    communication between two parties which must be done by the signalling\n    server.  The `to` function provides a simple way to provide a logical\n    communication channel between the two parties:\n\n    ```js\n    var send = signaller.to('e95fa05b-9062-45c6-bfa2-5055bf6625f4').send;\n\n    // create an offer on a local peer connection\n    pc.createOffer(\n      function(desc) {\n        // set the local description using the offer sdp\n        // if this occurs successfully send this to our peer\n        pc.setLocalDescription(\n          desc,\n          function() {\n            send('/sdp', desc);\n          },\n          handleFail\n        );\n      },\n      handleFail\n    );\n    ```\n\n  **/\n  signaller.to = function(targetId) {\n    return {\n      send: createToMessage(['/to', targetId])\n    };\n  };\n\n  /**\n    ### Signaller Internals\n\n    The following functions are designed for use by signallers that are built\n    on top of this base signaller.\n  **/\n\n  /**\n    #### `_announce()`\n\n    The internal function that constructs the `/announce` message and triggers\n    the `local:announce` event.\n\n  **/\n  signaller._announce = function() {\n    signaller.send('/announce', attributes);\n    signaller('local:announce', attributes);\n  };\n\n  /**\n    #### `_process(data)`\n\n\n  **/\n  signaller._process = require('./process')(signaller);\n\n  /**\n    #### `_update`\n\n    Internal function that updates core announce attributes with\n    updated data.\n\n**/\n  signaller._update = function(data) {\n    extend(attributes, data, { id: signaller.id });\n  };\n\n  // set the autoreply flag\n  signaller.autoreply = autoreply === undefined || autoreply;\n\n  return signaller;\n};\n","var extend = require('cog/extend');\n\n/**\n  # rtc-switchboard-messenger\n\n  A specialised version of\n  [`messenger-ws`](https://github.com/DamonOehlman/messenger-ws) designed to\n  connect to [`rtc-switchboard`](http://github.com/rtc-io/rtc-switchboard)\n  instances.\n\n**/\nmodule.exports = function(switchboard, opts) {\n  return require('messenger-ws')(switchboard, extend({\n    endpoints: (opts || {}).endpoints || ['/']\n  }, opts));\n};\n","var WebSocket = require('ws');\nvar wsurl = require('wsurl');\nvar ps = require('pull-ws');\nvar defaults = require('cog/defaults');\nvar reTrailingSlash = /\\/$/;\nvar DEFAULT_FAILCODES = [];\n\n/**\n  # messenger-ws\n\n  This is a simple messaging implementation for sending and receiving data\n  via websockets.\n\n  Follows the [messenger-archetype](https://github.com/DamonOehlman/messenger-archetype)\n\n  ## Example Usage\n\n  <<< examples/simple.js\n\n**/\nmodule.exports = function(url, opts) {\n  var timeout = (opts || {}).timeout || 1000;\n  var failcodes = (opts || {}).failcodes || DEFAULT_FAILCODES;\n  var endpoints = ((opts || {}).endpoints || ['/']).map(function(endpoint) {\n    return url.replace(reTrailingSlash, '') + endpoint;\n  });\n\n  function connect(callback) {\n    var queue = [].concat(endpoints);\n    var isConnected = false;\n    var socket;\n    var failTimer;\n    var successTimer;\n    var removeListener;\n    var source;\n\n    function attemptNext() {\n      // if we have already connected, do nothing\n      // NOTE: workaround for websockets/ws#489\n      if (isConnected) {\n        return;\n      }\n\n      // if we have no more valid endpoints, then erorr out\n      if (queue.length === 0) {\n        return callback(new Error('Unable to connect to url: ' + url));\n      }\n\n      socket = new WebSocket(wsurl(queue.shift()));\n      socket.addEventListener('message', connect);\n      socket.addEventListener('error', handleError);\n      socket.addEventListener('close', handleClose);\n      socket.addEventListener('open', handleOpen);\n\n      removeListener = socket.removeEventListener || socket.removeListener;\n      failTimer = setTimeout(attemptNext, timeout);\n    }\n\n    function connect() {\n      // if we are already connected, abort\n      // NOTE: workaround for websockets/ws#489\n      if (isConnected) {\n        return;\n      }\n\n      // clear any monitors\n      clearTimeout(failTimer);\n      clearTimeout(successTimer);\n\n      // remove the close and error listeners as messenger-ws has done\n      // what it set out to do and that is create a connection\n      // NOTE: issue websockets/ws#489 causes means this fails in ws\n      removeListener.call(socket, 'open', handleOpen);\n      removeListener.call(socket, 'close', handleClose);\n      removeListener.call(socket, 'error', handleError);\n      removeListener.call(socket, 'message', connect);\n\n      // trigger the callback\n      isConnected = true;\n      callback(null, source, ps.sink(socket, opts));\n    }\n\n    function handleClose(evt) {\n      var clean = evt.wasClean && (\n        evt.code === undefined || failcodes.indexOf(evt.code) < 0\n      );\n\n      // if this was not a clean close, then handle error\n      if (! clean) {\n        return handleError();\n      }\n\n      clearTimeout(successTimer);\n      clearTimeout(failTimer);\n    }\n\n    function handleError() {\n      clearTimeout(successTimer);\n      clearTimeout(failTimer);\n      attemptNext();\n    }\n\n    function handleOpen() {\n      // create the source immediately to buffer any data\n      source = ps.source(socket, opts);\n\n      // monitor data flowing from the socket\n      successTimer = setTimeout(connect, 100);\n    }\n\n    attemptNext();\n  }\n\n  return connect;\n};\n","exports = module.exports = duplex;\n\nexports.source = require('./source');\nexports.sink = require('./sink');\n\nfunction duplex (ws, opts) {\n  return {\n    source: exports.source(ws),\n    sink: exports.sink(ws, opts)\n  };\n};\n","module.exports = function(socket, callback) {\n  var remove = socket && (socket.removeEventListener || socket.removeListener);\n\n  function cleanup () {\n    if (typeof remove == 'function') {\n      remove.call(socket, 'open', handleOpen);\n      remove.call(socket, 'error', handleErr);\n    }\n  }\n\n  function handleOpen(evt) {\n    cleanup(); callback();\n  }\n\n  function handleErr (evt) {\n    cleanup(); callback(evt);\n  }\n\n  // if the socket is closing or closed, return end\n  if (socket.readyState >= 2) {\n    return callback(true);\n  }\n\n  // if open, trigger the callback\n  if (socket.readyState === 1) {\n    return callback();\n  }\n\n  socket.addEventListener('open', handleOpen);\n  socket.addEventListener('error', handleErr);\n};\n","var pull = require('pull-core');\nvar ready = require('./ready');\n\n/**\n  ### `sink(socket, opts?)`\n\n  Create a pull-stream `Sink` that will write data to the `socket`.\n\n  <<< examples/write.js\n\n**/\nmodule.exports = pull.Sink(function(read, socket, opts) {\n  opts = opts || {}\n  var closeOnEnd = opts.closeOnEnd !== false;\n  var onClose = 'function' === typeof opts ? opts : opts.onClose;\n\n  function next(end, data) {\n    // if the stream has ended, simply return\n    if (end) {\n      if (closeOnEnd && socket.readyState <= 1) {\n        if(onClose)\n          socket.addEventListener('close', function (ev) {\n            if(ev.wasClean) onClose()\n            else {\n              var err = new Error('ws error')\n              err.event = ev\n              onClose(err)\n            }\n          });\n\n        socket.close();\n      }\n\n      return;\n    }\n\n    // socket ready?\n    ready(socket, function(end) {\n      if (end) {\n        return read(end, function () {});\n      }\n\n      socket.send(data);\n      process.nextTick(function() {\n        read(null, next);\n      });\n    });\n  }\n\n  read(null, next);\n});\n","var pull = require('pull-core');\nvar ready = require('./ready');\n\n/**\n  ### `source(socket)`\n\n  Create a pull-stream `Source` that will read data from the `socket`.\n\n  <<< examples/read.js\n\n**/\nmodule.exports = pull.Source(function(socket) {\n  var buffer = [];\n  var receiver;\n  var ended;\n\n  socket.addEventListener('message', function(evt) {\n    if (receiver) {\n      return receiver(null, evt.data);\n    }\n\n    buffer.push(evt.data);\n  });\n\n  socket.addEventListener('close', function(evt) {\n    if (ended) return;\n    if (receiver) {\n      return receiver(ended = true);\n    }\n  });\n\n  socket.addEventListener('error', function (evt) {\n    if (ended) return;\n    ended = evt;\n    if (receiver) {\n      receiver(ended);\n    }\n  });\n\n  function read(abort, cb) {\n    receiver = null;\n\n    //if stream has already ended.\n    if (ended)\n      return cb(ended)\n\n    // if ended, abort\n    if (abort) {\n      //this will callback when socket closes\n      receiver = cb\n      return socket.close()\n    }\n\n    ready(socket, function(end) {\n      if (end) {\n        return cb(ended = end);\n      }\n\n      // read from the socket\n      if (ended && ended !== true) {\n        return cb(ended);\n      }\n      else if (buffer.length > 0) {\n        return cb(null, buffer.shift());\n      }\n      else if (ended) {\n        return cb(true);\n      }\n\n      receiver = cb;\n    });\n  };\n\n  return read;\n});\n","\n/**\n * Module dependencies.\n */\n\nvar global = (function() { return this; })();\n\n/**\n * WebSocket constructor.\n */\n\nvar WebSocket = global.WebSocket || global.MozWebSocket;\n\n/**\n * Module exports.\n */\n\nmodule.exports = WebSocket ? ws : null;\n\n/**\n * WebSocket constructor.\n *\n * The third `opts` options object gets ignored in web browsers, since it's\n * non-standard, and throws a TypeError if passed to the constructor.\n * See: https://github.com/einaros/ws/issues/227\n *\n * @param {String} uri\n * @param {Array} protocols (optional)\n * @param {Object) opts (optional)\n * @api public\n */\n\nfunction ws(uri, protocols, opts) {\n  var instance;\n  if (protocols) {\n    instance = new WebSocket(uri, protocols);\n  } else {\n    instance = new WebSocket(uri);\n  }\n  return instance;\n}\n\nif (WebSocket) ws.prototype = WebSocket.prototype;\n","var reHttpUrl = /^http(.*)$/;\n\n/**\n  # wsurl\n\n  Given a url (including protocol relative urls - i.e. `//`), generate an appropriate\n  url for a WebSocket endpoint (`ws` or `wss`).\n\n  ## Example Usage\n\n  <<< examples/relative.js\n\n**/\n\nmodule.exports = function(url, opts) {\n  var current = (opts || {}).current || (typeof location != 'undefined' && location.href);\n  var currentProtocol = current && current.slice(0, current.indexOf(':'));\n  var insecure = (opts || {}).insecure;\n  var isRelative = url.slice(0, 2) == '//';\n  var forceWS = (! currentProtocol) || currentProtocol === 'file:';\n\n  if (isRelative) {\n    return forceWS ?\n      ((insecure ? 'ws:' : 'wss:') + url) :\n      (currentProtocol.replace(reHttpUrl, 'ws$1') + ':' + url);\n  }\n\n  return url.replace(reHttpUrl, 'ws$1');\n};\n","/* jshint node: true */\n'use strict';\n\nvar debug = require('cog/logger')('rtc/cleanup');\n\nvar CANNOT_CLOSE_STATES = [\n  'closed'\n];\n\nvar EVENTS_DECOUPLE_BC = [\n  'addstream',\n  'datachannel',\n  'icecandidate',\n  'negotiationneeded',\n  'removestream',\n  'signalingstatechange'\n];\n\nvar EVENTS_DECOUPLE_AC = [\n  'iceconnectionstatechange'\n];\n\n/**\n  ### rtc-tools/cleanup\n\n  ```\n  cleanup(pc)\n  ```\n\n  The `cleanup` function is used to ensure that a peer connection is properly\n  closed and ready to be cleaned up by the browser.\n\n**/\nmodule.exports = function(pc) {\n  // see if we can close the connection\n  var currentState = pc.iceConnectionState;\n  var canClose = CANNOT_CLOSE_STATES.indexOf(currentState) < 0;\n\n  function decouple(events) {\n    events.forEach(function(evtName) {\n      if (pc['on' + evtName]) {\n        pc['on' + evtName] = null;\n      }\n    });\n  }\n\n  // decouple \"before close\" events\n  decouple(EVENTS_DECOUPLE_BC);\n\n  if (canClose) {\n    debug('attempting connection close, current state: '+ pc.iceConnectionState);\n    pc.close();\n  }\n\n  // remove the event listeners\n  // after a short delay giving the connection time to trigger\n  // close and iceconnectionstatechange events\n  setTimeout(function() {\n    decouple(EVENTS_DECOUPLE_AC);\n  }, 100);\n};\n","/* jshint node: true */\n'use strict';\n\nvar mbus = require('mbus');\nvar queue = require('rtc-taskqueue');\nvar cleanup = require('./cleanup');\nvar monitor = require('./monitor');\nvar throttle = require('cog/throttle');\nvar pluck = require('whisk/pluck');\nvar pluckCandidate = pluck('candidate', 'sdpMid', 'sdpMLineIndex');\nvar CLOSED_STATES = [ 'closed', 'failed' ];\nvar CHECKING_STATES = [ 'checking' ];\n\n/**\n  ### rtc-tools/couple\n\n  #### couple(pc, targetId, signaller, opts?)\n\n  Couple a WebRTC connection with another webrtc connection identified by\n  `targetId` via the signaller.\n\n  The following options can be provided in the `opts` argument:\n\n  - `sdpfilter` (default: null)\n\n    A simple function for filtering SDP as part of the peer\n    connection handshake (see the Using Filters details below).\n\n  ##### Example Usage\n\n  ```js\n  var couple = require('rtc/couple');\n\n  couple(pc, '54879965-ce43-426e-a8ef-09ac1e39a16d', signaller);\n  ```\n\n  ##### Using Filters\n\n  In certain instances you may wish to modify the raw SDP that is provided\n  by the `createOffer` and `createAnswer` calls.  This can be done by passing\n  a `sdpfilter` function (or array) in the options.  For example:\n\n  ```js\n  // run the sdp from through a local tweakSdp function.\n  couple(pc, '54879965-ce43-426e-a8ef-09ac1e39a16d', signaller, {\n    sdpfilter: tweakSdp\n  });\n  ```\n\n**/\nfunction couple(pc, targetId, signaller, opts) {\n  var debugLabel = (opts || {}).debugLabel || 'rtc';\n  var debug = require('cog/logger')(debugLabel + '/couple');\n\n  // create a monitor for the connection\n  var mon = monitor(pc, targetId, signaller, (opts || {}).logger);\n  var emit = mbus('', mon);\n  var reactive = (opts || {}).reactive;\n  var endOfCandidates = true;\n\n  // configure the time to wait between receiving a 'disconnect'\n  // iceConnectionState and determining that we are closed\n  var disconnectTimeout = (opts || {}).disconnectTimeout || 10000;\n  var disconnectTimer;\n\n  // initilaise the negotiation helpers\n  var isMaster = signaller.isMaster(targetId);\n\n  // initialise the processing queue (one at a time please)\n  var q = queue(pc, opts);\n\n  var createOrRequestOffer = throttle(function() {\n    if (! isMaster) {\n      return signaller.to(targetId).send('/negotiate');\n    }\n\n    q.createOffer();\n  }, 100, { leading: false });\n\n  var debounceOffer = throttle(q.createOffer, 100, { leading: false });\n\n  function decouple() {\n    debug('decoupling ' + signaller.id + ' from ' + targetId);\n\n    // stop the monitor\n//     mon.removeAllListeners();\n    mon.stop();\n\n    // cleanup the peerconnection\n    cleanup(pc);\n\n    // remove listeners\n    signaller.removeListener('sdp', handleSdp);\n    signaller.removeListener('candidate', handleCandidate);\n    signaller.removeListener('negotiate', handleNegotiateRequest);\n\n    // remove listeners (version >= 5)\n    signaller.removeListener('message:sdp', handleSdp);\n    signaller.removeListener('message:candidate', handleCandidate);\n    signaller.removeListener('message:negotiate', handleNegotiateRequest);\n  }\n\n  function handleCandidate(data) {\n    q.addIceCandidate(data);\n  }\n\n  function handleSdp(sdp, src) {\n    emit('sdp.remote', sdp);\n\n    // if the source is unknown or not a match, then don't process\n    if ((! src) || (src.id !== targetId)) {\n      return;\n    }\n\n    q.setRemoteDescription(sdp);\n  }\n\n  function handleConnectionClose() {\n    debug('captured pc close, iceConnectionState = ' + pc.iceConnectionState);\n    decouple();\n  }\n\n  function handleDisconnect() {\n    debug('captured pc disconnect, monitoring connection status');\n\n    // start the disconnect timer\n    disconnectTimer = setTimeout(function() {\n      debug('manually closing connection after disconnect timeout');\n      cleanup(pc);\n    }, disconnectTimeout);\n\n    mon.on('statechange', handleDisconnectAbort);\n  }\n\n  function handleDisconnectAbort() {\n    debug('connection state changed to: ' + pc.iceConnectionState);\n\n    // if the state is checking, then do not reset the disconnect timer as\n    // we are doing our own checking\n    if (CHECKING_STATES.indexOf(pc.iceConnectionState) >= 0) {\n      return;\n    }\n\n    resetDisconnectTimer();\n\n    // if we have a closed or failed status, then close the connection\n    if (CLOSED_STATES.indexOf(pc.iceConnectionState) >= 0) {\n      return mon('closed');\n    }\n\n    mon.once('disconnect', handleDisconnect);\n  }\n\n  function handleLocalCandidate(evt) {\n    var data = evt.candidate && pluckCandidate(evt.candidate);\n\n    if (evt.candidate) {\n      resetDisconnectTimer();\n      emit('ice.local', data);\n      signaller.to(targetId).send('/candidate', data);\n      endOfCandidates = false;\n    }\n    else if (! endOfCandidates) {\n      endOfCandidates = true;\n      emit('ice.gathercomplete');\n      signaller.to(targetId).send('/endofcandidates', {});\n    }\n  }\n\n  function handleNegotiateRequest(src) {\n    if (src.id === targetId) {\n      emit('negotiate.request', src.id);\n      debounceOffer();\n    }\n  }\n\n  function resetDisconnectTimer() {\n    mon.off('statechange', handleDisconnectAbort);\n\n    // clear the disconnect timer\n    debug('reset disconnect timer, state: ' + pc.iceConnectionState);\n    clearTimeout(disconnectTimer);\n  }\n\n  // when regotiation is needed look for the peer\n  if (reactive) {\n    pc.onnegotiationneeded = function() {\n      emit('negotiate.renegotiate');\n      createOrRequestOffer();\n    };\n  }\n\n  pc.onicecandidate = handleLocalCandidate;\n\n  // when the task queue tells us we have sdp available, send that over the wire\n  q.on('sdp.local', function(desc) {\n    signaller.to(targetId).send('/sdp', desc);\n  });\n\n  // when we receive sdp, then\n  signaller.on('sdp', handleSdp);\n  signaller.on('candidate', handleCandidate);\n\n  // listeners (signaller >= 5)\n  signaller.on('message:sdp', handleSdp);\n  signaller.on('message:candidate', handleCandidate);\n\n  // if this is a master connection, listen for negotiate events\n  if (isMaster) {\n    signaller.on('negotiate', handleNegotiateRequest);\n    signaller.on('message:negotiate', handleNegotiateRequest); // signaller >= 5\n  }\n\n  // when the connection closes, remove event handlers\n  mon.once('closed', handleConnectionClose);\n  mon.once('disconnected', handleDisconnect);\n\n  // patch in the create offer functions\n  mon.createOffer = createOrRequestOffer;\n\n  return mon;\n}\n\nmodule.exports = couple;\n","/* jshint node: true */\n'use strict';\n\n/**\n  ### rtc-tools/detect\n\n  Provide the [rtc-core/detect](https://github.com/rtc-io/rtc-core#detect)\n  functionality.\n**/\nmodule.exports = require('rtc-core/detect');\n","/* jshint node: true */\n'use strict';\n\nvar debug = require('cog/logger')('generators');\nvar detect = require('./detect');\nvar defaults = require('cog/defaults');\n\nvar mappings = {\n  create: {\n    dtls: function(c) {\n      if (! detect.moz) {\n        c.optional = (c.optional || []).concat({ DtlsSrtpKeyAgreement: true });\n      }\n    }\n  }\n};\n\n/**\n  ### rtc-tools/generators\n\n  The generators package provides some utility methods for generating\n  constraint objects and similar constructs.\n\n  ```js\n  var generators = require('rtc/generators');\n  ```\n\n**/\n\n/**\n  #### generators.config(config)\n\n  Generate a configuration object suitable for passing into an W3C\n  RTCPeerConnection constructor first argument, based on our custom config.\n\n  In the event that you use short term authentication for TURN, and you want\n  to generate new `iceServers` regularly, you can specify an iceServerGenerator\n  that will be used prior to coupling. This generator should return a fully\n  compliant W3C (RTCIceServer dictionary)[http://www.w3.org/TR/webrtc/#idl-def-RTCIceServer].\n\n  If you pass in both a generator and iceServers, the iceServers _will be\n  ignored and the generator used instead.\n**/\n\nexports.config = function(config) {\n  var iceServerGenerator = (config || {}).iceServerGenerator;\n\n  return defaults({}, config, {\n    iceServers: typeof iceServerGenerator == 'function' ? iceServerGenerator() : []\n  });\n};\n\n/**\n  #### generators.connectionConstraints(flags, constraints)\n\n  This is a helper function that will generate appropriate connection\n  constraints for a new `RTCPeerConnection` object which is constructed\n  in the following way:\n\n  ```js\n  var conn = new RTCPeerConnection(flags, constraints);\n  ```\n\n  In most cases the constraints object can be left empty, but when creating\n  data channels some additional options are required.  This function\n  can generate those additional options and intelligently combine any\n  user defined constraints (in `constraints`) with shorthand flags that\n  might be passed while using the `rtc.createConnection` helper.\n**/\nexports.connectionConstraints = function(flags, constraints) {\n  var generated = {};\n  var m = mappings.create;\n  var out;\n\n  // iterate through the flags and apply the create mappings\n  Object.keys(flags || {}).forEach(function(key) {\n    if (m[key]) {\n      m[key](generated);\n    }\n  });\n\n  // generate the connection constraints\n  out = defaults({}, constraints, generated);\n  debug('generated connection constraints: ', out);\n\n  return out;\n};\n","/* jshint node: true */\n\n'use strict';\n\n/**\n  # rtc-tools\n\n  The `rtc-tools` module does most of the heavy lifting within the\n  [rtc.io](http://rtc.io) suite.  Primarily it handles the logic of coupling\n  a local `RTCPeerConnection` with it's remote counterpart via an\n  [rtc-signaller](https://github.com/rtc-io/rtc-signaller) signalling\n  channel.\n\n  ## Getting Started\n\n  If you decide that the `rtc-tools` module is a better fit for you than either\n  [rtc-quickconnect](https://github.com/rtc-io/rtc-quickconnect) or\n  [rtc](https://github.com/rtc-io/rtc) then the code snippet below\n  will provide you a guide on how to get started using it in conjunction with\n  the [rtc-signaller](https://github.com/rtc-io/rtc-signaller) (version 5.0 and above)\n  and [rtc-media](https://github.com/rtc-io/rtc-media) modules:\n\n  <<< examples/getting-started.js\n\n  This code definitely doesn't cover all the cases that you need to consider\n  (i.e. peers leaving, etc) but it should demonstrate how to:\n\n  1. Capture video and add it to a peer connection\n  2. Couple a local peer connection with a remote peer connection\n  3. Deal with the remote steam being discovered and how to render\n     that to the local interface.\n\n  ## Reference\n\n**/\n\nvar gen = require('./generators');\n\n// export detect\nvar detect = exports.detect = require('./detect');\nvar findPlugin = require('rtc-core/plugin');\n\n// export cog logger for convenience\nexports.logger = require('cog/logger');\n\n// export peer connection\nvar RTCPeerConnection =\nexports.RTCPeerConnection = detect('RTCPeerConnection');\n\n// add the couple utility\nexports.couple = require('./couple');\n\n/**\n  ### createConnection\n\n  ```\n  createConnection(opts?, constraints?) => RTCPeerConnection\n  ```\n\n  Create a new `RTCPeerConnection` auto generating default opts as required.\n\n  ```js\n  var conn;\n\n  // this is ok\n  conn = rtc.createConnection();\n\n  // and so is this\n  conn = rtc.createConnection({\n    iceServers: []\n  });\n  ```\n**/\nexports.createConnection = function(opts, constraints) {\n  var plugin = findPlugin((opts || {}).plugins);\n  var PeerConnection = (opts || {}).RTCPeerConnection || RTCPeerConnection;\n\n  // generate the config based on options provided\n  var config = gen.config(opts);\n\n  // generate appropriate connection constraints\n  constraints = gen.connectionConstraints(opts, constraints);\n\n  if (plugin && typeof plugin.createConnection == 'function') {\n    return plugin.createConnection(config, constraints);\n  }\n\n  return new PeerConnection(config, constraints);\n};\n","/* jshint node: true */\n'use strict';\n\nvar mbus = require('mbus');\n\n// define some state mappings to simplify the events we generate\nvar stateMappings = {\n  completed: 'connected'\n};\n\n// define the events that we need to watch for peer connection\n// state changes\nvar peerStateEvents = [\n  'signalingstatechange',\n  'iceconnectionstatechange',\n];\n\n/**\n  ### rtc-tools/monitor\n\n  ```\n  monitor(pc, targetId, signaller, parentBus) => mbus\n  ```\n\n  The monitor is a useful tool for determining the state of `pc` (an\n  `RTCPeerConnection`) instance in the context of your application. The\n  monitor uses both the `iceConnectionState` information of the peer\n  connection and also the various\n  [signaller events](https://github.com/rtc-io/rtc-signaller#signaller-events)\n  to determine when the connection has been `connected` and when it has\n  been `disconnected`.\n\n  A monitor created `mbus` is returned as the result of a\n  [couple](https://github.com/rtc-io/rtc#rtccouple) between a local peer\n  connection and it's remote counterpart.\n\n**/\nmodule.exports = function(pc, targetId, signaller, parentBus) {\n  var monitor = mbus('', parentBus);\n  var state;\n\n  function checkState() {\n    var newState = getMappedState(pc.iceConnectionState);\n\n    // flag the we had a state change\n    monitor('statechange', pc, newState);\n\n    // if the active state has changed, then send the appopriate message\n    if (state !== newState) {\n      monitor(newState);\n      state = newState;\n    }\n  }\n\n  function handleClose() {\n    monitor('closed');\n  }\n\n  pc.onclose = handleClose;\n  peerStateEvents.forEach(function(evtName) {\n    pc['on' + evtName] = checkState;\n  });\n\n  monitor.stop = function() {\n    pc.onclose = null;\n    peerStateEvents.forEach(function(evtName) {\n      pc['on' + evtName] = null;\n    });\n  };\n\n  monitor.checkState = checkState;\n\n  // if we haven't been provided a valid peer connection, abort\n  if (! pc) {\n    return monitor;\n  }\n\n  // determine the initial is active state\n  state = getMappedState(pc.iceConnectionState);\n\n  return monitor;\n};\n\n/* internal helpers */\n\nfunction getMappedState(state) {\n  return stateMappings[state] || state;\n}\n","var detect = require('rtc-core/detect');\nvar findPlugin = require('rtc-core/plugin');\nvar PriorityQueue = require('priorityqueuejs');\nvar pluck = require('whisk/pluck');\nvar pluckSessionDesc = pluck('sdp', 'type');\n\n// some validation routines\nvar checkCandidate = require('rtc-validator/candidate');\n\n// the sdp cleaner\nvar sdpclean = require('rtc-sdpclean');\nvar parseSdp = require('rtc-sdp');\n\nvar PRIORITY_LOW = 100;\nvar PRIORITY_WAIT = 1000;\n\n// priority order (lower is better)\nvar DEFAULT_PRIORITIES = [\n  'addIceCandidate',\n  'setLocalDescription',\n  'setRemoteDescription',\n  'createAnswer',\n  'createOffer'\n];\n\n// define event mappings\nvar METHOD_EVENTS = {\n  setLocalDescription: 'setlocaldesc',\n  setRemoteDescription: 'setremotedesc',\n  createOffer: 'offer',\n  createAnswer: 'answer'\n};\n\nvar MEDIA_MAPPINGS = {\n  data: 'application'\n};\n\n// define states in which we will attempt to finalize a connection on receiving a remote offer\nvar VALID_RESPONSE_STATES = ['have-remote-offer', 'have-local-pranswer'];\n\n/**\n  # rtc-taskqueue\n\n  This is a package that assists with applying actions to an `RTCPeerConnection`\n  in as reliable order as possible. It is primarily used by the coupling logic\n  of the [`rtc-tools`](https://github.com/rtc-io/rtc-tools).\n\n  ## Example Usage\n\n  For the moment, refer to the simple coupling test as an example of how to use\n  this package (see below):\n\n  <<< test/couple.js\n\n**/\nmodule.exports = function(pc, opts) {\n  opts = opts || {};\n  // create the task queue\n  var queue = new PriorityQueue(orderTasks);\n  var tq = require('mbus')('', (opts || {}).logger);\n\n  // initialise task importance\n  var priorities = (opts || {}).priorities || DEFAULT_PRIORITIES;\n  var queueInterval = (opts || {}).interval || 50;\n\n  // check for plugin usage\n  var plugin = findPlugin((opts || {}).plugins);\n\n  // initialise state tracking\n  var checkQueueTimer = 0;\n  var defaultFail = tq.bind(tq, 'fail');\n\n  // look for an sdpfilter function (allow slight mis-spellings)\n  var sdpFilter = (opts || {}).sdpfilter || (opts || {}).sdpFilter;\n  var alwaysParse = (opts.sdpParseMode === 'always');\n\n  // initialise session description and icecandidate objects\n  var RTCSessionDescription = (opts || {}).RTCSessionDescription ||\n    detect('RTCSessionDescription');\n\n  var RTCIceCandidate = (opts || {}).RTCIceCandidate ||\n    detect('RTCIceCandidate');\n\n  function abortQueue(err) {\n    console.error(err);\n  }\n\n  function applyCandidate(task, next) {\n    var data = task.args[0];\n    // Allow selective filtering of ICE candidates\n    if (opts && opts.filterCandidate && !opts.filterCandidate(data)) {\n      tq('ice.remote.filtered', candidate);\n      return next();\n    }\n    var candidate = data && data.candidate && createIceCandidate(data);\n\n    function handleOk() {\n      tq('ice.remote.applied', candidate);\n      next();\n    }\n\n    function handleFail(err) {\n      tq('ice.remote.invalid', candidate);\n      next(err);\n    }\n\n    // we have a null candidate, we have finished gathering candidates\n    if (! candidate) {\n      return next();\n    }\n\n    pc.addIceCandidate(candidate, handleOk, handleFail);\n  }\n\n  function checkQueue() {\n    // peek at the next item on the queue\n    var next = (! queue.isEmpty()) && queue.peek();\n    var ready = next && testReady(next);\n\n    // reset the queue timer\n    checkQueueTimer = 0;\n\n    // if we don't have a task ready, then abort\n    if (! ready) {\n      // if we have a task and it has expired then dequeue it\n      if (next && expired(next)) {\n        tq('task.expire', next);\n        queue.deq();\n      }\n\n      return (! queue.isEmpty()) && isNotClosed(pc) && triggerQueueCheck();\n    }\n\n    // properly dequeue task\n    next = queue.deq();\n\n    // process the task\n    next.fn(next, function(err) {\n      var fail = next.fail || defaultFail;\n      var pass = next.pass;\n      var taskName = next.name;\n\n      // if errored, fail\n      if (err) {\n        console.error(taskName + ' task failed: ', err);\n        return fail(err);\n      }\n\n      if (typeof pass == 'function') {\n        pass.apply(next, [].slice.call(arguments, 1));\n      }\n\n      triggerQueueCheck();\n    });\n  }\n\n  function cleansdp(desc) {\n    // ensure we have clean sdp\n    var sdpErrors = [];\n    var sdp = desc && sdpclean(desc.sdp, { collector: sdpErrors });\n\n    // if we don't have a match, log some info\n    if (desc && sdp !== desc.sdp) {\n      console.info('invalid lines removed from sdp: ', sdpErrors);\n      desc.sdp = sdp;\n    }\n\n    // if a filter has been specified, then apply the filter\n    if (typeof sdpFilter == 'function') {\n      desc.sdp = sdpFilter(desc.sdp, pc);\n    }\n\n    return desc;\n  }\n\n  function completeConnection() {\n    if (VALID_RESPONSE_STATES.indexOf(pc.signalingState) >= 0) {\n      return tq.createAnswer();\n    }\n  }\n\n  function createIceCandidate(data) {\n    if (plugin && typeof plugin.createIceCandidate == 'function') {\n      return plugin.createIceCandidate(data);\n    }\n\n    return new RTCIceCandidate(data);\n  }\n\n  function createSessionDescription(data) {\n    if (plugin && typeof plugin.createSessionDescription == 'function') {\n      return plugin.createSessionDescription(data);\n    }\n\n    return new RTCSessionDescription(data);\n  }\n\n  function emitSdp() {\n    tq('sdp.local', pluckSessionDesc(this.args[0]));\n  }\n\n  function enqueue(name, handler, opts) {\n    return function() {\n      var args = [].slice.call(arguments);\n\n      if (opts && typeof opts.processArgs == 'function') {\n        args = args.map(opts.processArgs);\n      }\n\n      var priority = priorities.indexOf(name);\n\n      queue.enq({\n        args: args,\n        name: name,\n        fn: handler,\n        priority: priority >= 0 ? priority : PRIORITY_LOW,\n\n        // record the time at which the task was queued\n        start: Date.now(),\n\n        // initilaise any checks that need to be done prior\n        // to the task executing\n        checks: [ isNotClosed ].concat((opts || {}).checks || []),\n\n        // initialise the pass and fail handlers\n        pass: (opts || {}).pass,\n        fail: (opts || {}).fail\n      });\n\n      triggerQueueCheck();\n    };\n  }\n\n  function execMethod(task, next) {\n    var fn = pc[task.name];\n    var eventName = METHOD_EVENTS[task.name] || (task.name || '').toLowerCase();\n    var cbArgs = [ success, fail ];\n    var isOffer = task.name === 'createOffer';\n\n    function fail(err) {\n      tq.apply(tq, [ 'negotiate.error', task.name, err ].concat(task.args));\n      next(err);\n    }\n\n    function success() {\n      tq.apply(tq, [ ['negotiate', eventName, 'ok'], task.name ].concat(task.args));\n      next.apply(null, [null].concat([].slice.call(arguments)));\n    }\n\n    if (! fn) {\n      return next(new Error('cannot call \"' + task.name + '\" on RTCPeerConnection'));\n    }\n\n    // invoke the function\n    tq.apply(tq, ['negotiate.' + eventName].concat(task.args));\n    fn.apply(\n      pc,\n      task.args.concat(cbArgs).concat(isOffer ? generateConstraints() : [])\n    );\n  }\n\n  function expired(task) {\n    return (typeof task.ttl == 'number') && (task.start + task.ttl < Date.now());\n  }\n\n  function extractCandidateEventData(data) {\n    // extract nested candidate data (like we will see in an event being passed to this function)\n    while (data && data.candidate && data.candidate.candidate) {\n      data = data.candidate;\n    }\n\n    return data;\n  }\n\n  function generateConstraints() {\n    var allowedKeys = {\n      offertoreceivevideo: 'OfferToReceiveVideo',\n      offertoreceiveaudio: 'OfferToReceiveAudio',\n      icerestart: 'IceRestart',\n      voiceactivitydetection: 'VoiceActivityDetection'\n    };\n\n    var constraints = {\n      OfferToReceiveVideo: true,\n      OfferToReceiveAudio: true\n    };\n\n    // update known keys to match\n    Object.keys(opts || {}).forEach(function(key) {\n      if (allowedKeys[key.toLowerCase()]) {\n        constraints[allowedKeys[key.toLowerCase()]] = opts[key];\n      }\n    });\n\n    return { mandatory: constraints };\n  }\n\n  function hasLocalOrRemoteDesc(pc, task) {\n    return pc.__hasDesc || (pc.__hasDesc = !!pc.remoteDescription);\n  }\n\n  function isNotNegotiating(pc) {\n    return pc.signalingState !== 'have-local-offer';\n  }\n\n  function isNotClosed(pc) {\n    return pc.signalingState !== 'closed';\n  }\n\n  function isStable(pc) {\n    return pc.signalingState === 'stable';\n  }\n\n  function isValidCandidate(pc, data) {\n    return data.__valid ||\n      (data.__valid = checkCandidate(data.args[0]).length === 0);\n  }\n\n  function isConnReadyForCandidate(pc, data) {\n    var sdpMid = data.args[0] && data.args[0].sdpMid;\n\n    // remap media types as appropriate\n    sdpMid = MEDIA_MAPPINGS[sdpMid] || sdpMid;\n\n    if (sdpMid === '')\n      return true;\n\n    // Allow parsing of SDP always if required\n    if (alwaysParse || !pc.__mediaTypes) {\n      var sdp = parseSdp(pc.remoteDescription && pc.remoteDescription.sdp);\n      // We only want to cache the SDP media types if we've received them, otherwise\n      // bad things can happen\n      var mediaTypes = sdp.getMediaTypes();\n      if (mediaTypes && mediaTypes.length > 0) {\n        pc.__mediaTypes = sdp.getMediaTypes();\n      }\n    }\n\n    // the candidate is valid if we know about the media type\n    return pc.__mediaTypes && pc.__mediaTypes.indexOf(sdpMid) >= 0;\n  }\n\n  function orderTasks(a, b) {\n    // apply each of the checks for each task\n    var tasks = [a,b];\n    var readiness = tasks.map(testReady);\n    var taskPriorities = tasks.map(function(task, idx) {\n      var ready = readiness[idx];\n      return ready ? task.priority : PRIORITY_WAIT;\n    });\n\n    return taskPriorities[1] - taskPriorities[0];\n  }\n\n  // check whether a task is ready (does it pass all the checks)\n  function testReady(task) {\n    return (task.checks || []).reduce(function(memo, check) {\n      return memo && check(pc, task);\n    }, true);\n  }\n\n  function triggerQueueCheck() {\n    if (checkQueueTimer) return;\n    checkQueueTimer = setTimeout(checkQueue, queueInterval);\n  }\n\n  // patch in the queue helper methods\n  tq.addIceCandidate = enqueue('addIceCandidate', applyCandidate, {\n    processArgs: extractCandidateEventData,\n    checks: [hasLocalOrRemoteDesc, isValidCandidate, isConnReadyForCandidate ],\n\n    // set ttl to 5s\n    ttl: 5000\n  });\n\n  tq.setLocalDescription = enqueue('setLocalDescription', execMethod, {\n    processArgs: cleansdp,\n    pass: emitSdp\n  });\n\n  tq.setRemoteDescription = enqueue('setRemoteDescription', execMethod, {\n    processArgs: createSessionDescription,\n    pass: completeConnection\n  });\n\n  tq.createOffer = enqueue('createOffer', execMethod, {\n    checks: [ isNotNegotiating ],\n    pass: tq.setLocalDescription\n  });\n\n  tq.createAnswer = enqueue('createAnswer', execMethod, {\n    pass: tq.setLocalDescription\n  });\n\n  return tq;\n};\n","/**\n * Expose `PriorityQueue`.\n */\nmodule.exports = PriorityQueue;\n\n/**\n * Initializes a new empty `PriorityQueue` with the given `comparator(a, b)`\n * function, uses `.DEFAULT_COMPARATOR()` when no function is provided.\n *\n * The comparator function must return a positive number when `a > b`, 0 when\n * `a == b` and a negative number when `a < b`.\n *\n * @param {Function}\n * @return {PriorityQueue}\n * @api public\n */\nfunction PriorityQueue(comparator) {\n  this._comparator = comparator || PriorityQueue.DEFAULT_COMPARATOR;\n  this._elements = [];\n}\n\n/**\n * Compares `a` and `b`, when `a > b` it returns a positive number, when\n * it returns 0 and when `a < b` it returns a negative number.\n *\n * @param {String|Number} a\n * @param {String|Number} b\n * @return {Number}\n * @api public\n */\nPriorityQueue.DEFAULT_COMPARATOR = function(a, b) {\n  if (typeof a === 'number' && typeof b === 'number') {\n    return a - b;\n  } else {\n    a = a.toString();\n    b = b.toString();\n\n    if (a == b) return 0;\n\n    return (a > b) ? 1 : -1;\n  }\n};\n\n/**\n * Returns whether the priority queue is empty or not.\n *\n * @return {Boolean}\n * @api public\n */\nPriorityQueue.prototype.isEmpty = function() {\n  return this.size() === 0;\n};\n\n/**\n * Peeks at the top element of the priority queue.\n *\n * @return {Object}\n * @throws {Error} when the queue is empty.\n * @api public\n */\nPriorityQueue.prototype.peek = function() {\n  if (this.isEmpty()) throw new Error('PriorityQueue is empty');\n\n  return this._elements[0];\n};\n\n/**\n * Dequeues the top element of the priority queue.\n *\n * @return {Object}\n * @throws {Error} when the queue is empty.\n * @api public\n */\nPriorityQueue.prototype.deq = function() {\n  var first = this.peek();\n  var last = this._elements.pop();\n  var size = this.size();\n\n  if (size === 0) return first;\n\n  this._elements[0] = last;\n  var current = 0;\n\n  while (current < size) {\n    var largest = current;\n    var left = (2 * current) + 1;\n    var right = (2 * current) + 2;\n\n    if (left < size && this._compare(left, largest) >= 0) {\n      largest = left;\n    }\n\n    if (right < size && this._compare(right, largest) >= 0) {\n      largest = right;\n    }\n\n    if (largest === current) break;\n\n    this._swap(largest, current);\n    current = largest;\n  }\n\n  return first;\n};\n\n/**\n * Enqueues the `element` at the priority queue and returns its new size.\n *\n * @param {Object} element\n * @return {Number}\n * @api public\n */\nPriorityQueue.prototype.enq = function(element) {\n  var size = this._elements.push(element);\n  var current = size - 1;\n\n  while (current > 0) {\n    var parent = Math.floor((current - 1) / 2);\n\n    if (this._compare(current, parent) <= 0) break;\n\n    this._swap(parent, current);\n    current = parent;\n  }\n\n  return size;\n};\n\n/**\n * Returns the size of the priority queue.\n *\n * @return {Number}\n * @api public\n */\nPriorityQueue.prototype.size = function() {\n  return this._elements.length;\n};\n\n/**\n *  Iterates over queue elements\n *\n *  @param {Function} fn\n */\nPriorityQueue.prototype.forEach = function(fn) {\n  return this._elements.forEach(fn);\n};\n\n/**\n * Compares the values at position `a` and `b` in the priority queue using its\n * comparator function.\n *\n * @param {Number} a\n * @param {Number} b\n * @return {Number}\n * @api private\n */\nPriorityQueue.prototype._compare = function(a, b) {\n  return this._comparator(this._elements[a], this._elements[b]);\n};\n\n/**\n * Swaps the values at position `a` and `b` in the priority queue.\n *\n * @param {Number} a\n * @param {Number} b\n * @api private\n */\nPriorityQueue.prototype._swap = function(a, b) {\n  var aux = this._elements[a];\n  this._elements[a] = this._elements[b];\n  this._elements[b] = aux;\n};\n","/* jshint node: true */\n'use strict';\n\nvar nub = require('whisk/nub');\nvar pluck = require('whisk/pluck');\nvar flatten = require('whisk/flatten');\nvar reLineBreak = /\\r?\\n/;\nvar reTrailingNewlines = /\\r?\\n$/;\n\n// list sdp line types that are not \"significant\"\nvar nonHeaderLines = [ 'a', 'c', 'b', 'k' ];\nvar parsers = require('./parsers');\n\n/**\n  # rtc-sdp\n\n  This is a utility module for intepreting and patching sdp.\n\n  ## Usage\n\n  The `rtc-sdp` main module exposes a single function that is capable of\n  parsing lines of SDP, and providing an object allowing you to perform\n  operations on those parsed lines:\n\n  ```js\n  var sdp = require('rtc-sdp')(lines);\n  ```\n\n  The currently supported operations are listed below:\n\n**/\nmodule.exports = function(sdp) {\n  var ops = {};\n  var parsed = [];\n  var activeCollector;\n\n  // initialise the lines\n  var lines = sdp.split(reLineBreak).filter(Boolean).map(function(line) {\n    return line.split('=');\n  });\n\n  var inputOrder = nub(lines.filter(function(line) {\n    return line[0] && nonHeaderLines.indexOf(line[0]) < 0;\n  }).map(pluck(0)));\n\n  var findLine = ops.findLine = function(type, index) {\n    var lineData = parsed.filter(function(line) {\n      return line[0] === type;\n    })[index || 0];\n\n    return lineData && lineData[1];\n  };\n\n  // push into parsed sections\n  lines.forEach(function(line) {\n    var customParser = parsers[line[0]];\n\n    if (customParser) {\n      activeCollector = customParser(parsed, line);\n    }\n    else if (activeCollector) {\n      activeCollector = activeCollector(line);\n    }\n    else {\n      parsed.push(line);\n    }\n  });\n\n  /**\n    ### `sdp.addIceCandidate(data)`\n\n    Modify the sdp to include candidates as denoted by the data.\n\n**/\n  ops.addIceCandidate = function(data) {\n    var lineIndex = (data || {}).lineIndex || (data || {}).sdpMLineIndex;\n    var mLine = typeof lineIndex != 'undefined' && findLine('m', lineIndex);\n    var candidate = (data || {}).candidate;\n\n    // if we have the mLine add the new candidate\n    if (mLine && candidate) {\n      mLine.childlines.push(candidate.replace(reTrailingNewlines, '').split('='));\n    }\n  };\n\n  /**\n    ### `sdp.getMediaTypes() => []`\n\n    Retrieve the list of media types that have been defined in the sdp via\n    `m=` lines.\n  **/\n  ops.getMediaTypes = function() {\n    function getMediaType(data) {\n      return data[1].def.split(/\\s/)[0];\n    }\n\n    return parsed.filter(function(parts) {\n      return parts[0] === 'm' && parts[1] && parts[1].def;\n    }).map(getMediaType);\n  };\n\n  /**\n    ### `sdp.toString()`\n\n    Convert the SDP structure that is currently retained in memory, into a string\n    that can be provided to a `setLocalDescription` (or `setRemoteDescription`)\n    WebRTC call.\n\n  **/\n  ops.toString = function() {\n    return parsed.map(function(line) {\n      return typeof line[1].toArray == 'function' ? line[1].toArray() : [ line ];\n    }).reduce(flatten).map(function(line) {\n      return line.join('=');\n    }).join('\\n');\n  };\n\n  /**\n    ## SDP Filtering / Munging Functions\n\n    There are additional functions included in the module to assign with\n    performing \"single-shot\" SDP filtering (or munging) operations:\n\n  **/\n\n  return ops;\n};\n","/* jshint node: true */\n'use strict';\n\nexports.m = function(parsed, line) {\n  var media = {\n    def: line[1],\n    childlines: [],\n\n    toArray: function() {\n      return [\n        ['m', media.def ]\n      ].concat(media.childlines);\n    }\n  };\n\n  function addChildLine(childLine) {\n    media.childlines.push(childLine);\n    return addChildLine;\n  }\n\n  parsed.push([ 'm', media ]);\n\n  return addChildLine;\n};","var validators = [\n  [ /^(a\\=candidate.*)$/, require('rtc-validator/candidate') ]\n];\n\nvar reSdpLineBreak = /(\\r?\\n|\\\\r\\\\n)/;\n\n/**\n  # rtc-sdpclean\n\n  Remove invalid lines from your SDP.\n\n  ## Why?\n\n  This module removes the occasional \"bad egg\" that will slip into SDP when it\n  is generated by the browser.  In particular these situations are catered for:\n\n  - invalid ICE candidates\n\n**/\nmodule.exports = function(input, opts) {\n  var lineBreak = detectLineBreak(input);\n  var lines = input.split(lineBreak);\n  var collector = (opts || {}).collector;\n\n  // filter out invalid lines\n  lines = lines.filter(function(line) {\n    // iterate through the validators and use the one that matches\n    var validator = validators.reduce(function(memo, data, idx) {\n      return typeof memo != 'undefined' ? memo : (data[0].exec(line) && {\n        line: line.replace(data[0], '$1'),\n        fn: data[1]\n      });\n    }, undefined);\n\n    // if we have a validator, ensure we have no errors\n    var errors = validator ? validator.fn(validator.line) : [];\n\n    // if we have errors and an error collector, then add to the collector\n    if (collector) {\n      errors.forEach(function(err) {\n        collector.push(err);\n      });\n    }\n\n    return errors.length === 0;\n  });\n\n  return lines.join(lineBreak);\n};\n\nfunction detectLineBreak(input) {\n  var match = reSdpLineBreak.exec(input);\n\n  return match && match[0];\n}\n","var debug = require('cog/logger')('rtc-validator');\nvar rePrefix = /^(?:a=)?candidate:/;\n\n/*\n\nvalidation rules as per:\nhttp://tools.ietf.org/html/draft-ietf-mmusic-ice-sip-sdp-03#section-8.1\n\n   candidate-attribute   = \"candidate\" \":\" foundation SP component-id SP\n                           transport SP\n                           priority SP\n                           connection-address SP     ;from RFC 4566\n                           port         ;port from RFC 4566\n                           SP cand-type\n                           [SP rel-addr]\n                           [SP rel-port]\n                           *(SP extension-att-name SP\n                                extension-att-value)\n\n   foundation            = 1*32ice-char\n   component-id          = 1*5DIGIT\n   transport             = \"UDP\" / transport-extension\n   transport-extension   = token              ; from RFC 3261\n   priority              = 1*10DIGIT\n   cand-type             = \"typ\" SP candidate-types\n   candidate-types       = \"host\" / \"srflx\" / \"prflx\" / \"relay\" / token\n   rel-addr              = \"raddr\" SP connection-address\n   rel-port              = \"rport\" SP port\n   extension-att-name    = token\n   extension-att-value   = *VCHAR\n   ice-char              = ALPHA / DIGIT / \"+\" / \"/\"\n*/\nvar partValidation = [\n  [ /.+/, 'invalid foundation component', 'foundation' ],\n  [ /\\d+/, 'invalid component id', 'component-id' ],\n  [ /(UDP|TCP)/i, 'transport must be TCP or UDP', 'transport' ],\n  [ /\\d+/, 'numeric priority expected', 'priority' ],\n  [ require('reu/ip'), 'invalid connection address', 'connection-address' ],\n  [ /\\d+/, 'invalid connection port', 'connection-port' ],\n  [ /typ/, 'Expected \"typ\" identifier', 'type classifier' ],\n  [ /.+/, 'Invalid candidate type specified', 'candidate-type' ]\n];\n\n/**\n  ### `rtc-validator/candidate`\n\n  Validate that an `RTCIceCandidate` (or plain old object with data, sdpMid,\n  etc attributes) is a valid ice candidate.\n\n  Specs reviewed as part of the validation implementation:\n\n  - <http://tools.ietf.org/html/draft-ietf-mmusic-ice-sip-sdp-03#section-8.1>\n  - <http://tools.ietf.org/html/rfc5245>\n\n**/\nmodule.exports = function(data) {\n  var errors = [];\n  var candidate = data && (data.candidate || data);\n  var prefixMatch = candidate && rePrefix.exec(candidate);\n  var parts = prefixMatch && candidate.slice(prefixMatch[0].length).split(/\\s/);\n\n  if (! candidate) {\n    return [ new Error('empty candidate') ];\n  }\n\n  // check that the prefix matches expected\n  if (! prefixMatch) {\n    return [ new Error('candidate did not match expected sdp line format') ];\n  }\n\n  // perform the part validation\n  errors = errors.concat(parts.map(validateParts)).filter(Boolean);\n\n  return errors;\n};\n\nfunction validateParts(part, idx) {\n  var validator = partValidation[idx];\n\n  if (validator && (! validator[0].test(part))) {\n    debug(validator[2] + ' part failed validation: ' + part);\n    return new Error(validator[1]);\n  }\n}\n","/**\n  ### `reu/ip`\n\n  A regular expression that will match both IPv4 and IPv6 addresses.  This is a modified\n  regex (remove hostname matching) that was implemented by @Mikulas in\n  [this stackoverflow answer](http://stackoverflow.com/a/9209720/96656).\n\n**/\nmodule.exports = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(?:(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){6})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:::(?:(?:(?:[0-9a-fA-F]{1,4})):){5})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})))?::(?:(?:(?:[0-9a-fA-F]{1,4})):){4})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,1}(?:(?:[0-9a-fA-F]{1,4})))?::(?:(?:(?:[0-9a-fA-F]{1,4})):){3})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,2}(?:(?:[0-9a-fA-F]{1,4})))?::(?:(?:(?:[0-9a-fA-F]{1,4})):){2})(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,3}(?:(?:[0-9a-fA-F]{1,4})))?::(?:(?:[0-9a-fA-F]{1,4})):)(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,4}(?:(?:[0-9a-fA-F]{1,4})))?::)(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9]))\\.){3}(?:(?:25[0-5]|(?:[1-9]|1[0-9]|2[0-4])?[0-9])))))))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,5}(?:(?:[0-9a-fA-F]{1,4})))?::)(?:(?:[0-9a-fA-F]{1,4})))|(?:(?:(?:(?:(?:(?:[0-9a-fA-F]{1,4})):){0,6}(?:(?:[0-9a-fA-F]{1,4})))?::))))$/;\n","module.exports = function(a, b) {\n  return arguments.length > 1 ? a === b : function(b) {\n    return a === b;\n  };\n};\n","/**\n  ## flatten\n\n  Flatten an array using `[].reduce`\n\n  <<< examples/flatten.js\n\n**/\n\nmodule.exports = function(a, b) {\n  // if a is not already an array, make it one\n  a = Array.isArray(a) ? a : [a];\n\n  // concat b with a\n  return a.concat(b);\n};","module.exports = function(comparator) {\n  return function(input) {\n    var output = [];\n    for (var ii = 0, count = input.length; ii < count; ii++) {\n      var found = false;\n      for (var jj = output.length; jj--; ) {\n        found = found || comparator(input[ii], output[jj]);\n      }\n\n      if (found) {\n        continue;\n      }\n\n      output[output.length] = input[ii];\n    }\n\n    return output;\n  };\n}","/**\n  ## nub\n\n  Return only the unique elements of the list.\n\n  <<< examples/nub.js\n\n**/\n\nmodule.exports = require('./nub-by')(require('./equality'));","/**\n  ## pluck\n\n  Extract targeted properties from a source object. When a single property\n  value is requested, then just that value is returned.\n\n  In the case where multiple properties are requested (in a varargs calling\n  style) a new object will be created with the requested properties copied\n  across.\n\n  __NOTE:__ In the second form extraction of nested properties is\n  not supported.\n\n  <<< examples/pluck.js\n\n**/\nmodule.exports = function() {\n  var fields = [];\n\n  function extractor(parts, maxIdx) {\n    return function(item) {\n      var partIdx = 0;\n      var val = item;\n\n      do {\n        val = val && val[parts[partIdx++]];\n      } while (val && partIdx <= maxIdx);\n\n      return val;\n    };\n  }\n\n  [].slice.call(arguments).forEach(function(path) {\n    var parts = typeof path == 'number' ? [ path ] : (path || '').split('.');\n\n    fields[fields.length] = {\n      name: parts[0],\n      parts: parts,\n      maxIdx: parts.length - 1\n    };\n  });\n\n  if (fields.length <= 1) {\n    return extractor(fields[0].parts, fields[0].maxIdx);\n  }\n  else {\n    return function(item) {\n      var data = {};\n\n      for (var ii = 0, len = fields.length; ii < len; ii++) {\n        data[fields[ii].name] = extractor([fields[ii].parts[0]], 0)(item);\n      }\n\n      return data;\n    };\n  }\n};","/**\n * Tween.js - Licensed under the MIT license\n * https://github.com/sole/tween.js\n * ----------------------------------------------\n *\n * See https://github.com/sole/tween.js/graphs/contributors for the full list of contributors.\n * Thank you all, you're awesome!\n */\n\n// Date.now shim for (ahem) Internet Explo(d|r)er\nif ( Date.now === undefined ) {\n\n\tDate.now = function () {\n\n\t\treturn new Date().valueOf();\n\n\t};\n\n}\n\nvar TWEEN = TWEEN || ( function () {\n\n\tvar _tweens = [];\n\n\treturn {\n\n\t\tREVISION: '14',\n\n\t\tgetAll: function () {\n\n\t\t\treturn _tweens;\n\n\t\t},\n\n\t\tremoveAll: function () {\n\n\t\t\t_tweens = [];\n\n\t\t},\n\n\t\tadd: function ( tween ) {\n\n\t\t\t_tweens.push( tween );\n\n\t\t},\n\n\t\tremove: function ( tween ) {\n\n\t\t\tvar i = _tweens.indexOf( tween );\n\n\t\t\tif ( i !== -1 ) {\n\n\t\t\t\t_tweens.splice( i, 1 );\n\n\t\t\t}\n\n\t\t},\n\n\t\tupdate: function ( time ) {\n\n\t\t\tif ( _tweens.length === 0 ) return false;\n\n\t\t\tvar i = 0;\n\n\t\t\ttime = time !== undefined ? time : ( typeof window !== 'undefined' && window.performance !== undefined && window.performance.now !== undefined ? window.performance.now() : Date.now() );\n\n\t\t\twhile ( i < _tweens.length ) {\n\n\t\t\t\tif ( _tweens[ i ].update( time ) ) {\n\n\t\t\t\t\ti++;\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_tweens.splice( i, 1 );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn true;\n\n\t\t}\n\t};\n\n} )();\n\nTWEEN.Tween = function ( object ) {\n\n\tvar _object = object;\n\tvar _valuesStart = {};\n\tvar _valuesEnd = {};\n\tvar _valuesStartRepeat = {};\n\tvar _duration = 1000;\n\tvar _repeat = 0;\n\tvar _yoyo = false;\n\tvar _isPlaying = false;\n\tvar _reversed = false;\n\tvar _delayTime = 0;\n\tvar _startTime = null;\n\tvar _easingFunction = TWEEN.Easing.Linear.None;\n\tvar _interpolationFunction = TWEEN.Interpolation.Linear;\n\tvar _chainedTweens = [];\n\tvar _onStartCallback = null;\n\tvar _onStartCallbackFired = false;\n\tvar _onUpdateCallback = null;\n\tvar _onCompleteCallback = null;\n\tvar _onStopCallback = null;\n\n\t// Set all starting values present on the target object\n\tfor ( var field in object ) {\n\n\t\t_valuesStart[ field ] = parseFloat(object[field], 10);\n\n\t}\n\n\tthis.to = function ( properties, duration ) {\n\n\t\tif ( duration !== undefined ) {\n\n\t\t\t_duration = duration;\n\n\t\t}\n\n\t\t_valuesEnd = properties;\n\n\t\treturn this;\n\n\t};\n\n\tthis.start = function ( time ) {\n\n\t\tTWEEN.add( this );\n\n\t\t_isPlaying = true;\n\n\t\t_onStartCallbackFired = false;\n\n\t\t_startTime = time !== undefined ? time : ( typeof window !== 'undefined' && window.performance !== undefined && window.performance.now !== undefined ? window.performance.now() : Date.now() );\n\t\t_startTime += _delayTime;\n\n\t\tfor ( var property in _valuesEnd ) {\n\n\t\t\t// check if an Array was provided as property value\n\t\t\tif ( _valuesEnd[ property ] instanceof Array ) {\n\n\t\t\t\tif ( _valuesEnd[ property ].length === 0 ) {\n\n\t\t\t\t\tcontinue;\n\n\t\t\t\t}\n\n\t\t\t\t// create a local copy of the Array with the start value at the front\n\t\t\t\t_valuesEnd[ property ] = [ _object[ property ] ].concat( _valuesEnd[ property ] );\n\n\t\t\t}\n\n\t\t\t_valuesStart[ property ] = _object[ property ];\n\n\t\t\tif( ( _valuesStart[ property ] instanceof Array ) === false ) {\n\t\t\t\t_valuesStart[ property ] *= 1.0; // Ensures we're using numbers, not strings\n\t\t\t}\n\n\t\t\t_valuesStartRepeat[ property ] = _valuesStart[ property ] || 0;\n\n\t\t}\n\n\t\treturn this;\n\n\t};\n\n\tthis.stop = function () {\n\n\t\tif ( !_isPlaying ) {\n\t\t\treturn this;\n\t\t}\n\n\t\tTWEEN.remove( this );\n\t\t_isPlaying = false;\n\n\t\tif ( _onStopCallback !== null ) {\n\n\t\t\t_onStopCallback.call( _object );\n\n\t\t}\n\n\t\tthis.stopChainedTweens();\n\t\treturn this;\n\n\t};\n\n\tthis.stopChainedTweens = function () {\n\n\t\tfor ( var i = 0, numChainedTweens = _chainedTweens.length; i < numChainedTweens; i++ ) {\n\n\t\t\t_chainedTweens[ i ].stop();\n\n\t\t}\n\n\t};\n\n\tthis.delay = function ( amount ) {\n\n\t\t_delayTime = amount;\n\t\treturn this;\n\n\t};\n\n\tthis.repeat = function ( times ) {\n\n\t\t_repeat = times;\n\t\treturn this;\n\n\t};\n\n\tthis.yoyo = function( yoyo ) {\n\n\t\t_yoyo = yoyo;\n\t\treturn this;\n\n\t};\n\n\n\tthis.easing = function ( easing ) {\n\n\t\t_easingFunction = easing;\n\t\treturn this;\n\n\t};\n\n\tthis.interpolation = function ( interpolation ) {\n\n\t\t_interpolationFunction = interpolation;\n\t\treturn this;\n\n\t};\n\n\tthis.chain = function () {\n\n\t\t_chainedTweens = arguments;\n\t\treturn this;\n\n\t};\n\n\tthis.onStart = function ( callback ) {\n\n\t\t_onStartCallback = callback;\n\t\treturn this;\n\n\t};\n\n\tthis.onUpdate = function ( callback ) {\n\n\t\t_onUpdateCallback = callback;\n\t\treturn this;\n\n\t};\n\n\tthis.onComplete = function ( callback ) {\n\n\t\t_onCompleteCallback = callback;\n\t\treturn this;\n\n\t};\n\n\tthis.onStop = function ( callback ) {\n\n\t\t_onStopCallback = callback;\n\t\treturn this;\n\n\t};\n\n\tthis.update = function ( time ) {\n\n\t\tvar property;\n\n\t\tif ( time < _startTime ) {\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\tif ( _onStartCallbackFired === false ) {\n\n\t\t\tif ( _onStartCallback !== null ) {\n\n\t\t\t\t_onStartCallback.call( _object );\n\n\t\t\t}\n\n\t\t\t_onStartCallbackFired = true;\n\n\t\t}\n\n\t\tvar elapsed = ( time - _startTime ) / _duration;\n\t\telapsed = elapsed > 1 ? 1 : elapsed;\n\n\t\tvar value = _easingFunction( elapsed );\n\n\t\tfor ( property in _valuesEnd ) {\n\n\t\t\tvar start = _valuesStart[ property ] || 0;\n\t\t\tvar end = _valuesEnd[ property ];\n\n\t\t\tif ( end instanceof Array ) {\n\n\t\t\t\t_object[ property ] = _interpolationFunction( end, value );\n\n\t\t\t} else {\n\n\t\t\t\t// Parses relative end values with start as base (e.g.: +10, -3)\n\t\t\t\tif ( typeof(end) === \"string\" ) {\n\t\t\t\t\tend = start + parseFloat(end, 10);\n\t\t\t\t}\n\n\t\t\t\t// protect against non numeric properties.\n\t\t\t\tif ( typeof(end) === \"number\" ) {\n\t\t\t\t\t_object[ property ] = start + ( end - start ) * value;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( _onUpdateCallback !== null ) {\n\n\t\t\t_onUpdateCallback.call( _object, value );\n\n\t\t}\n\n\t\tif ( elapsed == 1 ) {\n\n\t\t\tif ( _repeat > 0 ) {\n\n\t\t\t\tif( isFinite( _repeat ) ) {\n\t\t\t\t\t_repeat--;\n\t\t\t\t}\n\n\t\t\t\t// reassign starting values, restart by making startTime = now\n\t\t\t\tfor( property in _valuesStartRepeat ) {\n\n\t\t\t\t\tif ( typeof( _valuesEnd[ property ] ) === \"string\" ) {\n\t\t\t\t\t\t_valuesStartRepeat[ property ] = _valuesStartRepeat[ property ] + parseFloat(_valuesEnd[ property ], 10);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (_yoyo) {\n\t\t\t\t\t\tvar tmp = _valuesStartRepeat[ property ];\n\t\t\t\t\t\t_valuesStartRepeat[ property ] = _valuesEnd[ property ];\n\t\t\t\t\t\t_valuesEnd[ property ] = tmp;\n\t\t\t\t\t}\n\n\t\t\t\t\t_valuesStart[ property ] = _valuesStartRepeat[ property ];\n\n\t\t\t\t}\n\n\t\t\t\tif (_yoyo) {\n\t\t\t\t\t_reversed = !_reversed;\n\t\t\t\t}\n\n\t\t\t\t_startTime = time + _delayTime;\n\n\t\t\t\treturn true;\n\n\t\t\t} else {\n\n\t\t\t\tif ( _onCompleteCallback !== null ) {\n\n\t\t\t\t\t_onCompleteCallback.call( _object );\n\n\t\t\t\t}\n\n\t\t\t\tfor ( var i = 0, numChainedTweens = _chainedTweens.length; i < numChainedTweens; i++ ) {\n\n\t\t\t\t\t_chainedTweens[ i ].start( time );\n\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t};\n\n};\n\n\nTWEEN.Easing = {\n\n\tLinear: {\n\n\t\tNone: function ( k ) {\n\n\t\t\treturn k;\n\n\t\t}\n\n\t},\n\n\tQuadratic: {\n\n\t\tIn: function ( k ) {\n\n\t\t\treturn k * k;\n\n\t\t},\n\n\t\tOut: function ( k ) {\n\n\t\t\treturn k * ( 2 - k );\n\n\t\t},\n\n\t\tInOut: function ( k ) {\n\n\t\t\tif ( ( k *= 2 ) < 1 ) return 0.5 * k * k;\n\t\t\treturn - 0.5 * ( --k * ( k - 2 ) - 1 );\n\n\t\t}\n\n\t},\n\n\tCubic: {\n\n\t\tIn: function ( k ) {\n\n\t\t\treturn k * k * k;\n\n\t\t},\n\n\t\tOut: function ( k ) {\n\n\t\t\treturn --k * k * k + 1;\n\n\t\t},\n\n\t\tInOut: function ( k ) {\n\n\t\t\tif ( ( k *= 2 ) < 1 ) return 0.5 * k * k * k;\n\t\t\treturn 0.5 * ( ( k -= 2 ) * k * k + 2 );\n\n\t\t}\n\n\t},\n\n\tQuartic: {\n\n\t\tIn: function ( k ) {\n\n\t\t\treturn k * k * k * k;\n\n\t\t},\n\n\t\tOut: function ( k ) {\n\n\t\t\treturn 1 - ( --k * k * k * k );\n\n\t\t},\n\n\t\tInOut: function ( k ) {\n\n\t\t\tif ( ( k *= 2 ) < 1) return 0.5 * k * k * k * k;\n\t\t\treturn - 0.5 * ( ( k -= 2 ) * k * k * k - 2 );\n\n\t\t}\n\n\t},\n\n\tQuintic: {\n\n\t\tIn: function ( k ) {\n\n\t\t\treturn k * k * k * k * k;\n\n\t\t},\n\n\t\tOut: function ( k ) {\n\n\t\t\treturn --k * k * k * k * k + 1;\n\n\t\t},\n\n\t\tInOut: function ( k ) {\n\n\t\t\tif ( ( k *= 2 ) < 1 ) return 0.5 * k * k * k * k * k;\n\t\t\treturn 0.5 * ( ( k -= 2 ) * k * k * k * k + 2 );\n\n\t\t}\n\n\t},\n\n\tSinusoidal: {\n\n\t\tIn: function ( k ) {\n\n\t\t\treturn 1 - Math.cos( k * Math.PI / 2 );\n\n\t\t},\n\n\t\tOut: function ( k ) {\n\n\t\t\treturn Math.sin( k * Math.PI / 2 );\n\n\t\t},\n\n\t\tInOut: function ( k ) {\n\n\t\t\treturn 0.5 * ( 1 - Math.cos( Math.PI * k ) );\n\n\t\t}\n\n\t},\n\n\tExponential: {\n\n\t\tIn: function ( k ) {\n\n\t\t\treturn k === 0 ? 0 : Math.pow( 1024, k - 1 );\n\n\t\t},\n\n\t\tOut: function ( k ) {\n\n\t\t\treturn k === 1 ? 1 : 1 - Math.pow( 2, - 10 * k );\n\n\t\t},\n\n\t\tInOut: function ( k ) {\n\n\t\t\tif ( k === 0 ) return 0;\n\t\t\tif ( k === 1 ) return 1;\n\t\t\tif ( ( k *= 2 ) < 1 ) return 0.5 * Math.pow( 1024, k - 1 );\n\t\t\treturn 0.5 * ( - Math.pow( 2, - 10 * ( k - 1 ) ) + 2 );\n\n\t\t}\n\n\t},\n\n\tCircular: {\n\n\t\tIn: function ( k ) {\n\n\t\t\treturn 1 - Math.sqrt( 1 - k * k );\n\n\t\t},\n\n\t\tOut: function ( k ) {\n\n\t\t\treturn Math.sqrt( 1 - ( --k * k ) );\n\n\t\t},\n\n\t\tInOut: function ( k ) {\n\n\t\t\tif ( ( k *= 2 ) < 1) return - 0.5 * ( Math.sqrt( 1 - k * k) - 1);\n\t\t\treturn 0.5 * ( Math.sqrt( 1 - ( k -= 2) * k) + 1);\n\n\t\t}\n\n\t},\n\n\tElastic: {\n\n\t\tIn: function ( k ) {\n\n\t\t\tvar s, a = 0.1, p = 0.4;\n\t\t\tif ( k === 0 ) return 0;\n\t\t\tif ( k === 1 ) return 1;\n\t\t\tif ( !a || a < 1 ) { a = 1; s = p / 4; }\n\t\t\telse s = p * Math.asin( 1 / a ) / ( 2 * Math.PI );\n\t\t\treturn - ( a * Math.pow( 2, 10 * ( k -= 1 ) ) * Math.sin( ( k - s ) * ( 2 * Math.PI ) / p ) );\n\n\t\t},\n\n\t\tOut: function ( k ) {\n\n\t\t\tvar s, a = 0.1, p = 0.4;\n\t\t\tif ( k === 0 ) return 0;\n\t\t\tif ( k === 1 ) return 1;\n\t\t\tif ( !a || a < 1 ) { a = 1; s = p / 4; }\n\t\t\telse s = p * Math.asin( 1 / a ) / ( 2 * Math.PI );\n\t\t\treturn ( a * Math.pow( 2, - 10 * k) * Math.sin( ( k - s ) * ( 2 * Math.PI ) / p ) + 1 );\n\n\t\t},\n\n\t\tInOut: function ( k ) {\n\n\t\t\tvar s, a = 0.1, p = 0.4;\n\t\t\tif ( k === 0 ) return 0;\n\t\t\tif ( k === 1 ) return 1;\n\t\t\tif ( !a || a < 1 ) { a = 1; s = p / 4; }\n\t\t\telse s = p * Math.asin( 1 / a ) / ( 2 * Math.PI );\n\t\t\tif ( ( k *= 2 ) < 1 ) return - 0.5 * ( a * Math.pow( 2, 10 * ( k -= 1 ) ) * Math.sin( ( k - s ) * ( 2 * Math.PI ) / p ) );\n\t\t\treturn a * Math.pow( 2, -10 * ( k -= 1 ) ) * Math.sin( ( k - s ) * ( 2 * Math.PI ) / p ) * 0.5 + 1;\n\n\t\t}\n\n\t},\n\n\tBack: {\n\n\t\tIn: function ( k ) {\n\n\t\t\tvar s = 1.70158;\n\t\t\treturn k * k * ( ( s + 1 ) * k - s );\n\n\t\t},\n\n\t\tOut: function ( k ) {\n\n\t\t\tvar s = 1.70158;\n\t\t\treturn --k * k * ( ( s + 1 ) * k + s ) + 1;\n\n\t\t},\n\n\t\tInOut: function ( k ) {\n\n\t\t\tvar s = 1.70158 * 1.525;\n\t\t\tif ( ( k *= 2 ) < 1 ) return 0.5 * ( k * k * ( ( s + 1 ) * k - s ) );\n\t\t\treturn 0.5 * ( ( k -= 2 ) * k * ( ( s + 1 ) * k + s ) + 2 );\n\n\t\t}\n\n\t},\n\n\tBounce: {\n\n\t\tIn: function ( k ) {\n\n\t\t\treturn 1 - TWEEN.Easing.Bounce.Out( 1 - k );\n\n\t\t},\n\n\t\tOut: function ( k ) {\n\n\t\t\tif ( k < ( 1 / 2.75 ) ) {\n\n\t\t\t\treturn 7.5625 * k * k;\n\n\t\t\t} else if ( k < ( 2 / 2.75 ) ) {\n\n\t\t\t\treturn 7.5625 * ( k -= ( 1.5 / 2.75 ) ) * k + 0.75;\n\n\t\t\t} else if ( k < ( 2.5 / 2.75 ) ) {\n\n\t\t\t\treturn 7.5625 * ( k -= ( 2.25 / 2.75 ) ) * k + 0.9375;\n\n\t\t\t} else {\n\n\t\t\t\treturn 7.5625 * ( k -= ( 2.625 / 2.75 ) ) * k + 0.984375;\n\n\t\t\t}\n\n\t\t},\n\n\t\tInOut: function ( k ) {\n\n\t\t\tif ( k < 0.5 ) return TWEEN.Easing.Bounce.In( k * 2 ) * 0.5;\n\t\t\treturn TWEEN.Easing.Bounce.Out( k * 2 - 1 ) * 0.5 + 0.5;\n\n\t\t}\n\n\t}\n\n};\n\nTWEEN.Interpolation = {\n\n\tLinear: function ( v, k ) {\n\n\t\tvar m = v.length - 1, f = m * k, i = Math.floor( f ), fn = TWEEN.Interpolation.Utils.Linear;\n\n\t\tif ( k < 0 ) return fn( v[ 0 ], v[ 1 ], f );\n\t\tif ( k > 1 ) return fn( v[ m ], v[ m - 1 ], m - f );\n\n\t\treturn fn( v[ i ], v[ i + 1 > m ? m : i + 1 ], f - i );\n\n\t},\n\n\tBezier: function ( v, k ) {\n\n\t\tvar b = 0, n = v.length - 1, pw = Math.pow, bn = TWEEN.Interpolation.Utils.Bernstein, i;\n\n\t\tfor ( i = 0; i <= n; i++ ) {\n\t\t\tb += pw( 1 - k, n - i ) * pw( k, i ) * v[ i ] * bn( n, i );\n\t\t}\n\n\t\treturn b;\n\n\t},\n\n\tCatmullRom: function ( v, k ) {\n\n\t\tvar m = v.length - 1, f = m * k, i = Math.floor( f ), fn = TWEEN.Interpolation.Utils.CatmullRom;\n\n\t\tif ( v[ 0 ] === v[ m ] ) {\n\n\t\t\tif ( k < 0 ) i = Math.floor( f = m * ( 1 + k ) );\n\n\t\t\treturn fn( v[ ( i - 1 + m ) % m ], v[ i ], v[ ( i + 1 ) % m ], v[ ( i + 2 ) % m ], f - i );\n\n\t\t} else {\n\n\t\t\tif ( k < 0 ) return v[ 0 ] - ( fn( v[ 0 ], v[ 0 ], v[ 1 ], v[ 1 ], -f ) - v[ 0 ] );\n\t\t\tif ( k > 1 ) return v[ m ] - ( fn( v[ m ], v[ m ], v[ m - 1 ], v[ m - 1 ], f - m ) - v[ m ] );\n\n\t\t\treturn fn( v[ i ? i - 1 : 0 ], v[ i ], v[ m < i + 1 ? m : i + 1 ], v[ m < i + 2 ? m : i + 2 ], f - i );\n\n\t\t}\n\n\t},\n\n\tUtils: {\n\n\t\tLinear: function ( p0, p1, t ) {\n\n\t\t\treturn ( p1 - p0 ) * t + p0;\n\n\t\t},\n\n\t\tBernstein: function ( n , i ) {\n\n\t\t\tvar fc = TWEEN.Interpolation.Utils.Factorial;\n\t\t\treturn fc( n ) / fc( i ) / fc( n - i );\n\n\t\t},\n\n\t\tFactorial: ( function () {\n\n\t\t\tvar a = [ 1 ];\n\n\t\t\treturn function ( n ) {\n\n\t\t\t\tvar s = 1, i;\n\t\t\t\tif ( a[ n ] ) return a[ n ];\n\t\t\t\tfor ( i = n; i > 1; i-- ) s *= i;\n\t\t\t\treturn a[ n ] = s;\n\n\t\t\t};\n\n\t\t} )(),\n\n\t\tCatmullRom: function ( p0, p1, p2, p3, t ) {\n\n\t\t\tvar v0 = ( p2 - p0 ) * 0.5, v1 = ( p3 - p1 ) * 0.5, t2 = t * t, t3 = t * t2;\n\t\t\treturn ( 2 * p1 - 2 * p2 + v0 + v1 ) * t3 + ( - 3 * p1 + 3 * p2 - 2 * v0 - v1 ) * t2 + v0 * t + p1;\n\n\t\t}\n\n\t}\n\n};\n\nmodule.exports=TWEEN;","\nlet $ = (typeof window !== \"undefined\" ? window.$ : typeof global !== \"undefined\" ? global.$ : null)\nlet page = require('page')\n\n// script loader\nlet toast = require('pyrsmk-toast')\nlet threeLoaded = false\n\nlet view = require('./viewer.js')\nlet viewTpl = require('./templates/view.tpl.html')\n\nlet stream = require('./streamer.js')\nlet streamTpl = require('./templates/stream.tpl.html')\n\nlet mainTpl = require('./templates/main.tpl.html')\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  page.base((window.location.pathname === '/' ? '' : window.location.pathname))\n  page('/view/:id', loadThree, renderTpl(viewTpl), view)\n\n  page('/stream', stream.create, (ctx) => { page.redirect('/stream/' + ctx.params.id) })\n  page('/stream/:id', renderTpl(streamTpl), stream.join)\n\n  page('/', renderTpl(mainTpl), home)\n  // page('*', () => { console.error('Oops fall through!'); page('/') })\n  page({hashbang: true})\n})\n\nfunction renderTpl (tpl) {\n  return (ctx, next) => {\n    $('#app').html(tpl)\n    next()\n  }\n}\n\n// Only load three+friends when needed\nfunction loadThree (ctx, next) {\n  if (!threeLoaded) {\n    threeLoaded = true\n    toast(\n      ['scripts/three.js', () => { return window.THREE }],\n      'scripts/webvr-polyfill.js',\n      'scripts/VRControls.js',\n      'scripts/VREffect.js',\n      'scripts/webvr-manager.js',\n      () => {\n        next()\n      }\n    )\n  } else {\n    next()\n  }\n}\n\nfunction home () {\n  let streamBtn = document.getElementById('stream')\n\n  streamBtn.addEventListener('click', (e) => {\n    page('/stream')\n    e.preventDefault()\n  })\n}\n","'use strict'\n\nlet $ = (typeof window !== \"undefined\" ? window.$ : typeof global !== \"undefined\" ? global.$ : null)\nlet QRCode = (typeof window !== \"undefined\" ? window.QRCode : typeof global !== \"undefined\" ? global.QRCode : null)\n\nmodule.exports = class LinkShare {\n  constructor (link) {\n    this.link = link\n    this.element = $('<div></div>')\n    this.qrcode = $('<div></div>')\n    this.twitter = $('<div></div>')\n    this.linkElement = $('<a>' + link + '</a>', {href: link})\n\n    this.element\n      .append(this.qrcode)\n      .append(this.linkElement)\n      .append(this.twitter)\n  }\n\n  appendTo (elem) {\n    this.element.appendTo(elem)\n\n    // generate a QRCode for easy sharing\n    new QRCode(this.qrcode[0], { // eslint-disable-line\n      text: this.link,\n      width: 512,\n      height: 512,\n      colorDark: '#000000',\n      colorLight: '#ffffff',\n      correctLevel: QRCode.CorrectLevel.H\n    })\n\n    window.twttr.ready(() => {\n      window.twttr.widgets.createShareButton(this.link, this.twitter[0], {\n        text: 'Live on #WebVR:',\n        hashtags: 'cardboard',\n        size: 'large',\n        count: 'none'\n      })\n    })\n  }\n}\n","'use strict'\n\n/*\n * Handles creation of new screen inside WebGL space\n */\n\nlet TWEEN = require('tween.js');\n\nmodule.exports = class Screen {\n  constructor (stream) {\n    // neew to require here so it will have been loaded\n    let THREE = (typeof window !== \"undefined\" ? window.THREE : typeof global !== \"undefined\" ? global.THREE : null)\n\n    this.id = stream.id // stream ID\n    this.stream = stream\n\n    // automatically remove stream from scene when ended\n    this.stream.onended = () => {\n      console.log('stream removed onended')\n      this.remove()\n    }\n\n    // set screen to have 16:9 aspect ratio with width === 1 meter\n    this.width = 1\n    this.height = 9 / 16\n\n    this.screenDistance = 1 // distance in meters between screen and camera\n\n    const eyeLevel = 1.8 // corresponds to height of camera\n\n    this.theta = 0\n\n    this.video = document.createElement('video')\n    this.video.width = this.width\n    this.video.height = this.height\n    this.video.autoplay = true\n\n    this.video.src = window.URL.createObjectURL(stream)\n\n    this.geometry = new THREE.PlaneBufferGeometry(this.width, this.height)\n\n    // translate geometry away from the origin to allow rotation\n    this.geometry.applyMatrix(new THREE.Matrix4().makeTranslation(0, 0, -this.screenDistance))\n\n    this.videoTexture = new THREE.Texture(this.video)\n    this.videoTexture.minFilter = THREE.NearestFilter\n\n    this.material = new THREE.MeshBasicMaterial({\n      map: this.videoTexture,\n      side: THREE.DoubleSide\n    })\n\n    this.mesh = new THREE.Mesh(this.geometry, this.material)\n    this.mesh.position.y = eyeLevel\n  }\n\n  add (scene) {\n    this.scene = scene\n    this.scene.add(this.mesh)\n  }\n\n  remove () {\n    if (this.scene) {\n      this.scene.remove(this.mesh)\n    }\n  }\n\n  update () {\n    // update to most recent camera frame\n    if (this.video.readyState === this.video.HAVE_ENOUGH_DATA) {\n      this.videoTexture.needsUpdate = true\n    }\n  }\n\n  rotate (newTheta) {\n    let self = this\n\n    const MOVE = 0.1\n\n    if (this.theta === newTheta) {\n      return\n    }\n\n    this.mesh.position.z += MOVE\n\n    let tween = new TWEEN.Tween({theta: this.theta})\n      .to({theta: newTheta}, 1500)\n      .easing(TWEEN.Easing.Quadratic.InOut)\n      .onUpdate(function () {\n        self.mesh.rotation.y = this.theta\n      })\n      .onComplete(function () {\n        self.mesh.position.z -= MOVE\n        self.theta = newTheta\n      })\n      .start()\n  }\n\n}\n\n","'use strict'\n\nlet $ = (typeof window !== \"undefined\" ? window.$ : typeof global !== \"undefined\" ? global.$ : null)\n\nfunction openVideoStream (options) {\n  return new Promise((resolve, reject) => {\n    navigator.getUserMedia(options, resolve, reject)\n  })\n}\n\nmodule.exports = class VideoControlPanel {\n  constructor (device, rtcStream) {\n    this.element = $('<div class=\"video-control\"></div>')\n    this.device = device\n    this.rtcStream = rtcStream\n\n    // create various HTML elements\n    this.startButton = $('<button>Start Feed</button>')\n    this.stopButton = $('<button>Stop Feed</button>')\n    this.streamingStatusIndicator = $('<div class=\"streaming-indicator\" style=\"color:red;\">not streaming</div>')\n    this.video = $('<video></video>')\n    this.video[0].autoplay = true\n\n    this.startButton.on('click', (e) => {\n      this.startFeed()\n    })\n\n    this.stopButton.on('click', (e) => {\n      this.stopFeed()\n    })\n\n    this.element\n      .append($('<div class=\"streaming-buttons\"></div>').append(this.startButton).append(this.stopButton))\n      .append(this.streamingStatusIndicator)\n      .append(this.video)\n  }\n\n  // Start streaming a camera feed over WebRTC\n  startFeed () {\n    if (!this.stream) {\n      let options\n      if (this.device.id) {\n        options = {\n          video: {\n            optional: [{\n              sourceId: this.device.id\n            }]\n          }\n        }\n      } else {\n        options = {video: true}\n      }\n\n      openVideoStream(options)\n        .then((stream) => {\n          this.stream = stream\n          this.video[0].src = window.URL.createObjectURL(stream)\n\n          // add stream to the rtc Stream\n          this.rtcStream.addStream(stream)\n          this.streamingStatusIndicator.text('streaming!')\n          this.streamingStatusIndicator.css('color', 'green')\n        })\n    } else {\n      this.rtcStream.addStream(this.stream)\n      this.streamingStatusIndicator.text('streaming!')\n      this.streamingStatusIndicator.css('color', 'green')\n    }\n  }\n\n  // Stop streaming a camera feed\n  stopFeed () {\n    this.rtcStream.removeStream(this.stream)\n    this.streamingStatusIndicator.text('not streaming')\n    this.streamingStatusIndicator.css('color', 'red')\n  }\n}\n","'use strict'\n\nlet $ = (typeof window !== \"undefined\" ? window.$ : typeof global !== \"undefined\" ? global.$ : null)\nlet quickconnect = require('rtc-quickconnect')\nlet freeice = require('freeice')\n\nlet LinkShare = require('./classes/LinkShare.js')\nlet VideoControlPanel = require('./classes/VideoControlPanel.js')\n\nnavigator.getUserMedia = (navigator.getUserMedia ||\n                          navigator.webkitGetUserMedia ||\n                          navigator.mozGetUserMedia ||\n                          navigator.msGetUserMedia)\n\nwindow.URL = (window.URL ||\n             window.webkitURL ||\n             window.mozURL ||\n             window.msURL)\n\n/*\n * Get an array of streams from various webcams. Only certain browsers support multiple streams\n */\nfunction getVideoDevices () {\n  return new Promise((resolve, reject) => {\n\n    if (window.MediaStreamTrack && window.MediaStreamTrack.getSources) {\n      window.MediaStreamTrack.getSources((sources) => {\n        // filter out non-video streams\n        let videoSources = sources.filter((source) => { return source.kind === 'video' })\n        console.log(videoSources)\n\n        resolve(videoSources)\n      })\n    } else {\n      resolve([{}])\n    }\n\n  })\n}\n\nexports.create = function createStream (ctx, next) {\n  const HASH_LENGTH = 5\n  const POSSIBLE = 'abcdefghigklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890'\n\n  let id = ''\n\n  for (let i = 0; i < HASH_LENGTH; i++) {\n    id += POSSIBLE[Math.floor(Math.random() * POSSIBLE.length)]\n  }\n\n  ctx.params.id = id\n  next()\n}\n\nexports.join = function stream (ctx) {\n  const room = ctx.params.id\n  const viewLink = window.location.href.replace('stream', 'view')\n\n  $('#roomId').text(room)\n\n  var streamerLink = new LinkShare(window.location.href)\n  var viewerLink = new LinkShare(viewLink)\n\n  streamerLink.appendTo($('#stream-box'))\n  viewerLink.appendTo($('#view-box'))\n\n  if (navigator.getUserMedia) {\n    let usersConnected = 0\n    $('#user-count').text(usersConnected)\n\n    let rtcStream = quickconnect('https://switchboard.rtc.io/', {\n      room: room,\n      iceServers: freeice()\n    })\n      .reactive()\n      .on('call:started', (id, pc, data) => {\n        console.log('started streaming!')\n        usersConnected++\n        $('#user-count').text(usersConnected)\n      })\n      .on('call:ended', (id) => {\n        usersConnected--\n        $('#user-count').text(usersConnected)\n      })\n\n    // get list of possible video devices to stream\n    getVideoDevices()\n      .then((devices) => {\n        console.log(devices)\n        devices.forEach((device) => {\n          let controls = new VideoControlPanel(device, rtcStream)\n          controls.element.appendTo($('#app'))\n        })\n      })\n\n  } else {\n    console.error('no webcam')\n  }\n}\n","module.exports = \"<h1>WebVR Camera Stream</h1><a href=# id=stream>stream</a>\";\n","module.exports = \"<h1>Room: <span id=roomId></span> <span class=subtitle>USERS CONNECTED: <span id=user-count></span></span></h1><div id=stream-box class=link-share><h2>Stream Link</h2></div><div id=view-box class=link-share><h2>View Link</h2></div>\";\n","module.exports = \"<style>body {\\n  padding: 0;\\n  margin: 0;\\n}\\n#viewer {\\n  background-color: #000;\\n  color: #fff;\\n  margin: 0px;\\n  padding: 0;\\n  overflow: hidden;\\n}</style><div id=viewer></div>\";\n","let $ = (typeof window !== \"undefined\" ? window.$ : typeof global !== \"undefined\" ? global.$ : null)\nlet quickconnect = require('rtc-quickconnect')\nlet freeice = require('freeice')\nlet TWEEN = require('tween.js');\n\nlet Screen = require('./classes/Screen.js')\n\nmodule.exports = function view (ctx) {\n  let THREE = (typeof window !== \"undefined\" ? window.THREE : typeof global !== \"undefined\" ? global.THREE : null)\n  let WebVRManager = (typeof window !== \"undefined\" ? window.WebVRManager : typeof global !== \"undefined\" ? global.WebVRManager : null)\n\n  const room = ctx.params.id\n\n  // const width = 640\n  // const height = 480\n  const width = window.innerWidth\n  const height = window.innerHeight\n\n  /**\n   * create RTC connection\n   */\n  // Array to Maintain connected screens\n  let screens = []\n\n  let rtcStream = quickconnect('https://switchboard.rtc.io/', {\n      room: room,\n      iceServers: freeice()\n    })\n    .on('call:started', (id, pc, data) => {\n      console.log('call started with', id, data)\n    })\n    .on('call:ended', (id) => {\n      console.log('call ended with', id)\n    })\n\n  /**\n   * Begin VR scene\n   */\n\n  // configure camera\n  let scene = new THREE.Scene()\n  let camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.3, 10000)\n  camera.position.y = 1.8 // set height in meters\n\n  // create floor texture\n  let floorTexture = THREE.ImageUtils.loadTexture('assets/grid.png')\n  floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping\n  floorTexture.repeat.set(100, 100)\n  let floorMaterial = new THREE.MeshBasicMaterial({\n    map: floorTexture,\n    side: THREE.DoubleSide\n  })\n  let floorGeometry = new THREE.PlaneBufferGeometry(100, 100, 1, 1)\n  let floor = new THREE.Mesh(floorGeometry, floorMaterial)\n  floor.rotation.x = Math.PI / 2\n  scene.add(floor)\n\n  let controls = new THREE.VRControls(camera, (err) => { console.log(err) })\n\n  // create renderer\n  let renderer = new THREE.WebGLRenderer({antialias: true})\n  renderer.setPixelRatio(window.devicePixelRatio)\n  // renderer.setSize(width, height)\n  document.body.appendChild(renderer.domElement)\n\n  // create VR effect\n  let effect = new THREE.VREffect(renderer)\n  effect.setSize(width, height)\n\n  // create WebVR manager\n  let manager = new WebVRManager(renderer, effect, {hideButton: false})\n\n  rtcStream\n    .on('stream:added', (clientId, stream, data) => {\n      console.log('stream added from', clientId, stream)\n      // only create a new screen for streaming connections\n      if (stream.label !== 'default') {\n        let screen = new Screen(stream)\n        screens.push(screen)\n        screen.add(scene)\n\n        resetScreens(screens)\n      }\n    })\n    .on('stream:removed', (clientId, stream) => {\n      for (let i = 0; i < screens.length; i++) {\n        if (screens[i].id === stream.id) {\n          screens.splice(i, 1)\n          break\n        }\n      }\n\n      resetScreens(screens)\n    })\n\n  function animate (time) {\n    for (let i = 0; i < screens.length; i++) {\n      screens[i].update()\n    }\n\n    controls.update()\n    TWEEN.update(time)\n\n    // renderer.render(scene, camera)\n    manager.render(scene, camera)\n\n    window.requestAnimationFrame(animate)\n  }\n\n  animate()\n\n  // Reset the position sensor when 'z' pressed.\n  function onKey (event) {\n    switch (event.keyCode) {\n      case 90: // z\n        console.log('reseting sensor')\n        controls.resetSensor()\n        break\n    }\n  }\n  window.addEventListener('keydown', onKey, true)\n  // Handle window resizes\n  function onWindowResize () {\n    camera.aspect = window.innerWidth / window.innerHeight\n    camera.updateProjectionMatrix()\n    effect.setSize(window.innerWidth, window.innerHeight)\n  }\n  window.addEventListener('resize', onWindowResize, false)\n}\n\n// Layout screen rotations\nfunction resetScreens (screens) {\n  screens.forEach((screen, i) => {\n    screens[i].rotate(i * Math.PI / 3)\n  })\n}\n\n"]}